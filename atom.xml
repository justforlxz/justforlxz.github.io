<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å°ç«¹&#39;s blog</title>
  
  <subtitle>æ°¸è¿œä¸è¦åœæ­¢æ€è€ƒ</subtitle>
  <link href="https://blog.justforlxz.com/atom.xml" rel="self"/>
  
  <link href="https://blog.justforlxz.com/"/>
  <updated>2024-12-31T07:12:35.112Z</updated>
  <id>https://blog.justforlxz.com/</id>
  
  <author>
    <name>å°ç«¹</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä½¿ç”¨ VK-GL-CTS å¯¹ wayland æ‰§è¡Œä¸€è‡´æ€§æµ‹è¯•</title>
    <link href="https://blog.justforlxz.com/2024/12/27/vk-gl-cts-test-wayland/"/>
    <id>https://blog.justforlxz.com/2024/12/27/vk-gl-cts-test-wayland/</id>
    <published>2024-12-26T16:00:00.000Z</published>
    <updated>2024-12-31T07:12:35.112Z</updated>
    
    <content type="html"><![CDATA[<aside>ğŸ˜­ åä¸ºé‚£è¾¹ä½¿ç”¨ deqp-vk ä½œä¸ºæµ‹è¯•é¡¹ï¼Œç»“æœ kwin_wayland æœ‰ä¸ªæµ‹è¯•æ²¡é€šè¿‡ï¼Œæ²Ÿé€šäº†ä¸€æ˜ŸæœŸæ‰çŸ¥é“æ˜¯å…¬å¼€çš„æµ‹è¯•å¥—ä»¶ï¼Œä½†æ˜¯åœ¨ uos 1070 ä¸Šæ„å»ºé‡åˆ°äº†ç‚¹é—®é¢˜ï¼Œæˆ‘æŠŠå‘è®°å½•ä¸€ä¸‹ã€‚</aside><p>uos 1070 é‡Œçš„ gcc å¤ªæ—§äº†ï¼Œéœ€è¦å®‰è£… clang-13ï¼Œç„¶åæ›´æ–°è½¯é“¾ã€‚è¿˜éœ€è¦å®‰è£… libc++abi-13ï¼Œä¸èƒ½ç¢°ä»»ä½• gcc çš„ä¸œè¥¿ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install libwayland-dev wayland-protocols cmake ninja-build clang-13 libc++1-13 libc++-13-dev libc++abi1-13 libc++abi-13-dev </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/clang clang /usr/bin/clang-13 100</span><br><span class="line"><span class="built_in">sudo</span> update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-13 100</span><br></pre></td></tr></table></figure><p>æ‹‰å–ä»£ç  <a href="https://github.com/KhronosGroup/VK-GL-CTS/">https://github.com/KhronosGroup/VK-GL-CTS/</a> </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/KhronosGroup/VK-GL-CTS/</span><br></pre></td></tr></table></figure><p>æ‹‰å®Œä»£ç ä»¥åï¼Œè¿˜éœ€è¦æ‰§è¡Œè„šæœ¬æŠŠä¾èµ–é¡¹éƒ½æ‹‰å»äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 external/fetch_sources.py</span><br></pre></td></tr></table></figure><p>åŒæ—¶è¿˜éœ€è¦åœ¨ç³»ç»Ÿé‡Œå®‰è£… python3-lxmlã€‚</p><p>æ›´æ–°å®Œæ‰€æœ‰ä¾èµ–åï¼Œæˆ‘åªéœ€è¦ deqp-vk è¿™ä¸€ä¸ª targetï¼Œè€Œ khronosGroup ç»™ VK-GL-CTS æä¾›äº† SELECTED_BUILD_TARGETS å˜é‡ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -B build -GNinja \</span><br><span class="line">      -DSELECTED_BUILD_TARGETS=deqp-vk \</span><br><span class="line">      -DCMAKE_BUILD_TYPE=Debug \</span><br><span class="line">      -DCMAKE_CXX_STANDARD=17 \</span><br><span class="line">      -DCMAKE_CXX_STANDARD_REQUIRED=ON \</span><br><span class="line">      -DCMAKE_CXX_EXTENSIONS=OFF \</span><br><span class="line">      -DCMAKE_CXX_FLAGS=<span class="string">&quot;-stdlib=libc++&quot;</span> \</span><br><span class="line">      -DCMAKE_EXE_LINKER_FLAGS=<span class="string">&quot;-lstdc++fs&quot;</span> \</span><br><span class="line">      -DCMAKE_SHARED_LINKER_FLAGS=<span class="string">&quot;-lstdc++fs&quot;</span> \</span><br><span class="line">      -DCMAKE_C_COMPILER=clang \</span><br><span class="line">      -DCMAKE_CXX_COMPILER=clang++</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥å®Œæˆæ„å»ºç³»ç»Ÿçš„å‡†å¤‡ã€‚ä¹‹åå°±å¯ä»¥æ­£å¸¸æ„å»ºäº†ï¼Œå¤§æ¦‚éœ€è¦ç¼–è¯‘ 1331 ä¸ªå•å…ƒï¼Œ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake --build build --target deqp-vk</span><br></pre></td></tr></table></figure><p>ç­‰æ„å»ºå®Œæˆåï¼Œä½¿ç”¨åä¸ºæä¾›çš„æµ‹è¯•å‘½ä»¤æ‰§è¡Œæµ‹è¯•ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./build/external/vulkancts/modules/vulkan/deqp-vk --deqp-case=dEQP-VK.wsi.wayland.swapchain.render.10swapchains</span><br></pre></td></tr></table></figure><p>è¿è¡Œå‰æœ€å¥½ä½¿ç”¨ vulkaninfo æµ‹è¯•ä¸€ä¸‹ vulkan ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰æˆåŠŸè¿è¡Œï¼Œå®‰è£…ä¸€ä¸‹ mesa-vulkan-driversã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install mesa-vulkan-drivers</span><br></pre></td></tr></table></figure><p>ä¼šçœ‹åˆ°é€šè¿‡äº† caseã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">â¯ ./build/external/vulkancts/modules/vulkan/deqp-vk --deqp-case=dEQP-VK.wsi.wayland.swapchain.render.10swapchains</span><br><span class="line">Writing <span class="built_in">test</span> <span class="built_in">log</span> into TestResults.qpa</span><br><span class="line">dEQP Core vulkan-cts-1.4.1.0-93-g7655439d7333848a59d3114ee6227a26259b2b4b (0x7655439d) starting..</span><br><span class="line">  target implementation = <span class="string">&#x27;Default&#x27;</span></span><br><span class="line">B%&lt;-------- Process name: deqp-vk. Logging ended at: Fri Dec 27 15:52:34 2024</span><br><span class="line"></span><br><span class="line">Test <span class="keyword">case</span> <span class="string">&#x27;dEQP-VK.wsi.wayland.swapchain.render.10swapchains&#x27;</span>..</span><br><span class="line">?%&lt;-------- Process name: deqp-vk. Logging ended at: Fri Dec 27 15:52:37 2024</span><br><span class="line"></span><br><span class="line">  Pass (Rendering tests succeeded)</span><br><span class="line">&lt;-------- Process name: deqp-vk. Logging ended at: Fri Dec 27 15:52:37 2024</span><br><span class="line"></span><br><span class="line">DONE!</span><br><span class="line"></span><br><span class="line">Test run totals:</span><br><span class="line">  Passed:        1/1 (100.0%)</span><br><span class="line">  Failed:        0/1 (0.0%)</span><br><span class="line">  Not supported: 0/1 (0.0%)</span><br><span class="line">  Warnings:      0/1 (0.0%)</span><br><span class="line">  Waived:        0/1 (0.0%)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;aside&gt;
ğŸ˜­ åä¸ºé‚£è¾¹ä½¿ç”¨ deqp-vk ä½œä¸ºæµ‹è¯•é¡¹ï¼Œç»“æœ kwin_wayland æœ‰ä¸ªæµ‹è¯•æ²¡é€šè¿‡ï¼Œæ²Ÿé€šäº†ä¸€æ˜ŸæœŸæ‰çŸ¥é“æ˜¯å…¬å¼€çš„æµ‹è¯•å¥—ä»¶ï¼Œä½†æ˜¯åœ¨ uos 1070 ä¸Šæ„å»ºé‡åˆ°äº†ç‚¹é—®é¢˜ï¼Œæˆ‘æŠŠå‘è®°å½•ä¸€ä¸‹ã€‚

&lt;/aside&gt;

&lt;p&gt;uos 1070 é‡Œçš„ gcc å¤ªæ—§äº†ï¼Œ</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.justforlxz.com/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="UOS, Vulkan, å›¾å½¢å­¦, å¼€å‘" scheme="https://blog.justforlxz.com/tags/UOS-Vulkan-%E5%9B%BE%E5%BD%A2%E5%AD%A6-%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>Nix home-manager ä½¿ç”¨ç¬”è®°</title>
    <link href="https://blog.justforlxz.com/2024/12/25/nix-home-manager/"/>
    <id>https://blog.justforlxz.com/2024/12/25/nix-home-manager/</id>
    <published>2024-12-24T16:00:00.000Z</published>
    <updated>2024-12-31T07:11:18.575Z</updated>
    
    <content type="html"><![CDATA[<aside>ğŸ˜µâ€ğŸ’« æ¯æ¬¡éƒ½å¿˜äº†è¦è¿è¡Œå•¥</aside><h2 id="å®‰è£…-nix"><a href="#å®‰è£…-nix" class="headerlink" title="å®‰è£… nix"></a>å®‰è£… nix</h2><p><code>sh &lt;(curl -L https://nixos.org/nix/install) --no-daemon</code></p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>åˆ›å»ºæ–‡ä»¶ <code>~/.config/nix/nix.conf</code>,å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">e<span class="attr">xperimental-features</span> <span class="operator">=</span> nix-command flakes</span><br></pre></td></tr></table></figure><p>åˆ›å»ºç›®å½• <code>~/.config/home-manager/</code>,éœ€è¦ä¸¤ä¸ªæ–‡ä»¶ï¼Œæˆ‘çš„é…ç½®é‡Œä½¿ç”¨ flake ä½œä¸ºè¾…åŠ©ï¼Œæ‰€ä»¥å…ˆåˆ›å»º <code>flake.nix</code> æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">description</span> <span class="operator">=</span> <span class="string">&quot;Home Manager configuration for Me QwQ&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">inputs</span> <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="attr">nixpkgs.url</span> <span class="operator">=</span> <span class="string">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span>;</span><br><span class="line">    <span class="attr">home-manager</span> <span class="operator">=</span> &#123;</span><br><span class="line">      <span class="attr">url</span> <span class="operator">=</span> <span class="string">&quot;github:nix-community/home-manager&quot;</span>;</span><br><span class="line">      <span class="attr">inputs.nixpkgs.follows</span> <span class="operator">=</span> <span class="string">&quot;nixpkgs&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="attr">flake-utils.url</span> <span class="operator">=</span> <span class="string">&quot;github:numtide/flake-utils&quot;</span>;</span><br><span class="line">    <span class="attr">neovim-nightly-overlay</span> <span class="operator">=</span> &#123;</span><br><span class="line">      <span class="attr">url</span> <span class="operator">=</span> <span class="string">&quot;github:nix-community/neovim-nightly-overlay&quot;</span>;</span><br><span class="line">      <span class="attr">inputs.nixpkgs.follows</span> <span class="operator">=</span> <span class="string">&quot;nixpkgs&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="attr">outputs</span> <span class="operator">=</span> &#123; self, flake-utils, nixpkgs, home-manager, neovim-nightly-overlay, ... &#125;@<span class="params">inputs:</span></span><br><span class="line">    flake-utils.lib.eachDefaultSystemPassThrough (<span class="params">system:</span></span><br><span class="line">      <span class="keyword">let</span></span><br><span class="line">        <span class="attr">pkgs</span> <span class="operator">=</span> nixpkgs.legacyPackages.$&#123;system&#125;;</span><br><span class="line">      <span class="keyword">in</span> &#123;</span><br><span class="line">        <span class="attr">homeConfigurations.lxz</span> <span class="operator">=</span> home-manager.lib.homeManagerConfiguration &#123;</span><br><span class="line">          <span class="keyword">inherit</span> pkgs;</span><br><span class="line"></span><br><span class="line">          <span class="comment"># Specify your home configuration modules here, for example,</span></span><br><span class="line">          <span class="comment"># the path to your home.nix.</span></span><br><span class="line">          <span class="attr">modules</span> <span class="operator">=</span> [</span><br><span class="line">            <span class="symbol">./home.nix</span></span><br><span class="line">          ];</span><br><span class="line"></span><br><span class="line">          <span class="comment"># Optionally use extraSpecialArgs</span></span><br><span class="line">          <span class="comment"># to pass through arguments to home.nix</span></span><br><span class="line">          <span class="attr">extraSpecialArgs</span> <span class="operator">=</span> &#123; <span class="keyword">inherit</span> inputs; &#125;;</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nix çš„è¯­æ³•å°±ä¸åœ¨è¿™é‡Œä»‹ç»äº†ï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª <code>home.nix</code>ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight nix"><table><tr><td class="code"><pre><span class="line">&#123; inputs, config, pkgs, ... &#125;:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment"># Home Manager needs a bit of information about you and the</span></span><br><span class="line">  <span class="comment"># paths it should manage.</span></span><br><span class="line">  <span class="attr">home.username</span> <span class="operator">=</span> <span class="string">&quot;lxz&quot;</span>;</span><br><span class="line">  <span class="attr">home.homeDirectory</span> <span class="operator">=</span> <span class="string">&quot;/home/lxz&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attr">home.packages</span> <span class="operator">=</span> <span class="keyword">with</span> pkgs; [</span><br><span class="line">    git-lfs</span><br><span class="line">    neofetch</span><br><span class="line">    htop</span><br><span class="line">    ripgrep</span><br><span class="line">    lazygit</span><br><span class="line">    gh</span><br><span class="line">    go</span><br><span class="line">    cargo</span><br><span class="line">    lemonade</span><br><span class="line">    nix-index</span><br><span class="line">    nix-update</span><br><span class="line"></span><br><span class="line">    <span class="comment"># font</span></span><br><span class="line">    noto-fonts</span><br><span class="line">    noto-fonts-cjk</span><br><span class="line">    noto-fonts-emoji</span><br><span class="line">    liberation_ttf</span><br><span class="line">    fira-code</span><br><span class="line">    fira-code-symbols</span><br><span class="line">    fira-code-nerdfont</span><br><span class="line">    sarasa-gothic</span><br><span class="line">    (nerdfonts.override &#123; <span class="attr">fonts</span> <span class="operator">=</span> [ <span class="string">&quot;FiraCode&quot;</span> <span class="string">&quot;DroidSansMono&quot;</span> ]; &#125;)</span><br><span class="line"></span><br><span class="line">    nodejs</span><br><span class="line"></span><br><span class="line">    <span class="comment"># neovim nightly</span></span><br><span class="line">    neovim</span><br><span class="line">    <span class="comment"># neovim-nightly</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="attr">nixpkgs.overlays</span> <span class="operator">=</span> [</span><br><span class="line">    inputs.neovim-nightly-overlay.overlays.default</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="attr">fonts.fontconfig.enable</span> <span class="operator">=</span> <span class="literal">true</span>; <span class="comment"># Allow fontconfig to discover fonts in home.packages</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">programs.fzf</span> <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="attr">enable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="attr">enableBashIntegration</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="attr">enableZshIntegration</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="attr">services.gpg-agent</span> <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="attr">enable</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="attr">defaultCacheTtl</span> <span class="operator">=</span> <span class="number">1800</span>;</span><br><span class="line">    <span class="attr">enableSshSupport</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="attr">home.shellAliases</span> <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="string">&quot;...&quot;</span> <span class="operator">=</span> <span class="string">&quot;cd ../..&quot;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="attr">home.stateVersion</span> <span class="operator">=</span> <span class="string">&quot;24.05&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Let Home Manager install and manage itself.</span></span><br><span class="line">  <span class="attr">programs.home-manager.enable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–‡ä»¶çš„é…ç½®å°±æ˜¯å®‰è£…å’Œé…ç½®è½¯ä»¶äº†ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å®šä¹‰äº†ä¸€äº›è·¯å¾„å’Œè½¯ä»¶åŒ…ï¼Œä»¥åŠå­—ä½“çš„ override ç­‰ï¼Œå¯ä»¥æŒ‰éœ€ä¿®æ”¹ã€‚</p><h2 id="å®‰è£…å’Œæ›´æ–°"><a href="#å®‰è£…å’Œæ›´æ–°" class="headerlink" title="å®‰è£…å’Œæ›´æ–°"></a>å®‰è£…å’Œæ›´æ–°</h2><p><code>nix flake update</code> æ›´æ–°ä¸‹ä»“åº“</p><p><code>nix-shell -p home-manager</code> å®‰è£…ä¸€ä¸ª home-managerã€‚</p><p><code>home-manager switch --flake .</code> ä½¿ç”¨å½“å‰é…ç½®å®‰è£… nix è½¯ä»¶åŒ…ï¼Œå…¶ä¸­åŒ…æ‹¬äº† home-managerã€‚</p>]]></content>
    
    
    <summary type="html">æ¯æ¬¡éƒ½å¿˜äº†è¦è¿è¡Œå•¥ï¼Œè®°ä¸‹æ¥</summary>
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.justforlxz.com/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="dotfile" scheme="https://blog.justforlxz.com/tags/dotfile/"/>
    
  </entry>
  
  <entry>
    <title>å¼‚ä¸–ç›¸é‡ï¼Œå°½äº«ç¾å‘³</title>
    <link href="https://blog.justforlxz.com/2024/11/23/have-a-nice-day/"/>
    <id>https://blog.justforlxz.com/2024/11/23/have-a-nice-day/</id>
    <published>2024-11-22T16:00:00.000Z</published>
    <updated>2024-12-31T07:21:03.715Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©å‘¨äº”ï¼Œä¸‹ç­å»æ¥è€å©†ä¸‹ç­å›å®¶ï¼Œå¿«åˆ°å®¶çš„æ—¶å€™çªç„¶æœ‰ç‚¹å˜´é¦‹ï¼Œæƒ³åƒçƒ§çƒ¤ã€‚</p><p>æˆ‘ï¼šä»¥å‰å»çš„é‚£å®¶éŸ©å›½çƒ¤è‚‰åº—èŠ±äº†å¤šå°‘é’±ï¼Ÿ</p><p>è€å©†ï¼šä¸‰ç™¾å¤šã€‚</p><p>æˆ‘ï¼šä¸‰ç™¾å¤šå¤ªè´µäº†ï¼Œä¸å»ï¼ï¼ˆæ‹å¤§è…¿ï¼‰</p><p>æˆ‘ï¼šä¸‰ç™¾å—éƒ½å¤Ÿä¹°å¤šå°‘è‚‰äº†ã€‚</p><p>è€å©†ï¼šé‚£åœ¨å®¶è‡ªå·±åšï¼Ÿä¹°ç‚¹äº”èŠ±ï¼Œä¹°ç‚¹æ³¡èœï¼Œç”Ÿèœï¼Œå®¶é‡Œè¿˜æœ‰ç‰›è‚‰ã€‚</p><p>æˆ‘ï¼šå¯ä»¥ï¼Œè‡ªå·±åšä¸‹ä¹Ÿè´¹ä¸äº†å¤šå°‘åŠŸå¤«ï¼Œè¿˜èƒ½åƒåˆ°é¥±ã€‚</p><p>è€å©†ï¼šç”¨ç”µé¥¼é“›ç›´æ¥çƒ¤ã€‚</p><p>æˆ‘ï¼šç”µé¥¼é“›ç«åŠ›ä¸å¤Ÿå§ã€‚</p><p>è€å©†ï¼šå¤Ÿï¼Œä¸è¡Œè¿˜æœ‰å°çƒ¤ç›˜ï¼Œä¸“é—¨çƒ¤è‚‰çš„ã€‚</p><p>æˆ‘ï¼šå¥½ï¼Œç°åœ¨è¿‡å»ä¹°è‚‰ã€‚</p><p>æœ€ç»ˆèŠ±äº†ä¸åˆ°ä¸€ç™¾å—é’±ï¼Œä¸¤ä¸ªäººåƒåˆ°æ’‘ï¼Œè¿˜æ²¡åƒå®Œã€‚ ğŸ˜€</p><p>äº”èŠ±è‚‰ 23å…ƒ æ¥¼ä¸‹è¶…å¸‚</p><p>ç‰›è‚‰ 10å…ƒ   æ°¸æ—ºå¤œé—´æ‰“æŠ˜</p><p>ç”Ÿèœ 2å…ƒ    æ¥¼ä¸‹èœå¸‚åœºé€çš„</p><p>é”…åœˆ 40å…ƒ   åªèƒ½è‡ªå·±èŠ±é’±äº†</p><p>ğŸ˜­ æƒ³æƒ³ä»¥å‰å››äº”ç™¾å»å¤–è¾¹åƒï¼Œè¿˜åƒä¸é¥±ã€‚</p><img src="/2024/11/23/have-a-nice-day/image.png" class="" title="image.png"><img src="/2024/11/23/have-a-nice-day/IMG_5439.jpeg" class="" title="IMG_5439.jpeg"><img src="/2024/11/23/have-a-nice-day/IMG_5437.jpeg" class="" title="IMG_5437.jpeg"><img src="/2024/11/23/have-a-nice-day/IMG_5441.jpeg" class="" title="IMG_5441.jpeg"><img src="/2024/11/23/have-a-nice-day/IMG_5440.jpeg" class="" title="IMG_5440.jpeg"><img src="/2024/11/23/have-a-nice-day/IMG_5434.jpeg" class="" title="IMG_5434.jpeg"><img src="/2024/11/23/have-a-nice-day/IMG_5442.jpeg" class="" title="IMG_5442.jpeg"><img src="/2024/11/23/have-a-nice-day/IMG_5435.jpeg" class="" title="IMG_5435.jpeg"><img src="/2024/11/23/have-a-nice-day/IMG_5438.jpeg" class="" title="IMG_5438.jpeg">]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»Šå¤©å‘¨äº”ï¼Œä¸‹ç­å»æ¥è€å©†ä¸‹ç­å›å®¶ï¼Œå¿«åˆ°å®¶çš„æ—¶å€™çªç„¶æœ‰ç‚¹å˜´é¦‹ï¼Œæƒ³åƒçƒ§çƒ¤ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ï¼šä»¥å‰å»çš„é‚£å®¶éŸ©å›½çƒ¤è‚‰åº—èŠ±äº†å¤šå°‘é’±ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è€å©†ï¼šä¸‰ç™¾å¤šã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ï¼šä¸‰ç™¾å¤šå¤ªè´µäº†ï¼Œä¸å»ï¼ï¼ˆæ‹å¤§è…¿ï¼‰&lt;/p&gt;
&lt;p&gt;æˆ‘ï¼šä¸‰ç™¾å—éƒ½å¤Ÿä¹°å¤šå°‘è‚‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;è€å©†ï¼šé‚£åœ¨å®¶è‡ª</summary>
      
    
    
    
    <category term="å¿ƒæƒ…éšç¬”" scheme="https://blog.justforlxz.com/categories/%E5%BF%83%E6%83%85%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="å¥åº·, æ€è€ƒ" scheme="https://blog.justforlxz.com/tags/%E5%81%A5%E5%BA%B7-%E6%80%9D%E8%80%83/"/>
    
  </entry>
  
  <entry>
    <title>Treeland Part.1 å¦‚ä½•å®ç°ä¸€ä¸ªåŸºäº wlroots çš„åˆæˆå™¨</title>
    <link href="https://blog.justforlxz.com/2024/11/09/treeland-part1-how-to-implement-a-wlroots-based-compositor/"/>
    <id>https://blog.justforlxz.com/2024/11/09/treeland-part1-how-to-implement-a-wlroots-based-compositor/</id>
    <published>2024-11-08T16:00:00.000Z</published>
    <updated>2024-12-31T07:15:08.125Z</updated>
    
    <content type="html"><![CDATA[<aside>ğŸ˜€ Treeland æ˜¯ä¸€ä¸ªåŸºäº wlroots å’Œ Qt çš„ Wayland åˆæˆå™¨å¹¶ä¸”æ”¯æŒå¤šç”¨æˆ·å…±ç”¨åˆæˆå™¨ã€‚</aside><h2 id="åè¯æ¦‚å¿µ"><a href="#åè¯æ¦‚å¿µ" class="headerlink" title="åè¯æ¦‚å¿µ"></a>åè¯æ¦‚å¿µ</h2><h3 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h3><p>Qtï¼ˆ&#x2F;ËˆkjuËt&#x2F;ï¼Œå‘éŸ³åŒâ€œcuteâ€ï¼‰æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„C++åº”ç”¨ç¨‹åºå¼€å‘æ¡†æ¶ã€‚å¹¿æ³›ç”¨äºå¼€å‘GUIç¨‹åºï¼Œè¿™ç§æƒ…å†µä¸‹åˆè¢«ç§°ä¸ºéƒ¨ä»¶å·¥å…·ç®±ã€‚ä¹Ÿå¯ç”¨äºå¼€å‘éGUIç¨‹åºï¼Œä¾‹å¦‚æ§åˆ¶å°å·¥å…·å’ŒæœåŠ¡å™¨ã€‚</p><h3 id="wlroots"><a href="#wlroots" class="headerlink" title="wlroots"></a>wlroots</h3><p>ç”¨äºæ„å»º <a href="https://wayland.freedesktop.org/">Wayland</a> åˆæˆå™¨çš„æ¨¡å—åŒ–å·¥å…·é›†ï¼Œç®€åŒ–äº†çº¦ 60,000 è¡Œä»£ç çš„å¼€å‘å·¥ä½œã€‚</p><ul><li>æä¾›æŠ½è±¡åº•å±‚æ˜¾ç¤ºå’Œè¾“å…¥çš„åç«¯ï¼Œæ”¯æŒ KMS&#x2F;DRMã€libinputã€Waylandã€X11 ç­‰ï¼Œå¯åŠ¨æ€åˆ›å»ºå’Œé”€æ¯ã€‚</li><li>å®ç°å¤šç§ Wayland æ¥å£ï¼Œæ”¯æŒåè®®æ‰©å±•ï¼Œä¿ƒè¿›åˆæˆå™¨æ ‡å‡†åŒ–ã€‚</li><li>æä¾›é€šç”¨åˆæˆå™¨ç»„ä»¶ï¼Œå¦‚ç‰©ç†ç©ºé—´è¾“å‡ºç®¡ç†ã€‚</li><li>é›†æˆ Xwayland æŠ½è±¡ï¼Œç®€åŒ– X11 çª—å£ç®¡ç†ã€‚</li><li>æä¾›æ¸²æŸ“å™¨æŠ½è±¡ï¼Œæ”¯æŒç®€å•å’Œè‡ªå®šä¹‰æ¸²æŸ“éœ€æ±‚ã€‚</li></ul><h3 id="seat"><a href="#seat" class="headerlink" title="seat"></a>seat</h3><p>ç”±åˆ†é…ç»™ç‰¹å®šå·¥ä½œåœºæ™¯çš„æ‰€æœ‰ç¡¬ä»¶è®¾å¤‡ç»„æˆã€‚å®ƒè‡³å°‘åŒ…å«ä¸€ä¸ªå›¾å½¢è®¾å¤‡ï¼Œé€šå¸¸è¿˜æœ‰é”®ç›˜å’Œé¼ æ ‡ã€‚æ­¤å¤–ï¼Œå®ƒå¯èƒ½åŒ…æ‹¬æ‘„åƒå¤´ã€å£°å¡ç­‰è®¾å¤‡ã€‚åº§ä½ç”±åº§ä½åç§°æ ‡è¯†ï¼Œè¿™æ˜¯ä¸€ä¸ªçŸ­å­—ç¬¦ä¸²ï¼ˆä¸è¶…è¿‡64ä¸ªå­—ç¬¦ï¼‰ï¼Œä»¥â€seatâ€å››ä¸ªå­—ç¬¦å¼€å¤´ï¼Œåè·Ÿè‡³å°‘ä¸€ä¸ªa-zA-Z0-9èŒƒå›´å†…çš„å­—ç¬¦ï¼Œæˆ–â€_â€å’Œâ€-â€œã€‚è¿™ç§å‘½åæ–¹å¼é€‚åˆç”¨äºæ–‡ä»¶åã€‚åº§ä½åç§°å¯èƒ½æ˜¯ç¨³å®šçš„ï¼Œä¹Ÿå¯èƒ½ä¸ç¨³å®šï¼Œå¦‚æœåº§ä½å†æ¬¡å¯ç”¨ï¼Œå…¶åç§°å¯ä»¥é‡å¤ä½¿ç”¨ã€‚</p><h3 id="RHI"><a href="#RHI" class="headerlink" title="RHI"></a>RHI</h3><p>RHI æ˜¯ <code>Renderer Hardware Interface</code>ï¼ˆæ¸²æŸ“ç¡¬ä»¶æ¥å£ï¼‰çš„ç¼©å†™ï¼Œæ˜¯ä¸€å¥—å¯¹ç¡¬ä»¶çš„æŠ½è±¡ï¼Œåœ¨ä¸Šå±‚åªéœ€è¦è®¾ç½®å‚æ•°ï¼Œåº•å±‚å…·ä½“ä½¿ç”¨çš„æ˜¯ OpenGLã€Vulkanã€DX12 è¿˜æ˜¯ Metal å“ªå¥—æ¥å£ï¼Œæˆ‘ä»¬æ˜¯ä¸å¿…å…³å¿ƒçš„ã€‚</p><p>Qt6 æä¾›äº† QRHIï¼Œä¸º Qt ç¨‹åºæä¾›äº†åº•å±‚çš„ç¡¬ä»¶æŠ½è±¡ï¼Œè¿™æ ·ä¸Šå±‚çš„ QtQuick ç»„ä»¶åœ¨æ‰§è¡Œ GPU æ¸²æŸ“æ—¶ï¼Œå°±å¯ä»¥è‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„é©±åŠ¨æ¥å£ã€‚</p><h3 id="QPA"><a href="#QPA" class="headerlink" title="QPA"></a>QPA</h3><p>Qt å¹³å°æŠ½è±¡ï¼ˆQPAï¼‰æ˜¯ Qt ä¸­çš„æ ¸å¿ƒå¹³å°æŠ½è±¡å±‚ã€‚</p><p>QPA çš„ API å¯é€šè¿‡ç±»å‰ç¼€â€QPlatform*â€è¯†åˆ«ï¼Œç”¨äºå®ç° <a href="https://doc.qt.io/qt-6/qtgui-index.html">Qt GUI</a> ä¸­çš„é«˜çº§ç±»ã€‚ä¾‹å¦‚ï¼Œ<code>QPlatformWindow</code> ç”¨äºçª—å£ç³»ç»Ÿé›†æˆï¼Œè€Œ <code>QPlatformTheme</code> å’Œ <code>QStyleHint</code> åˆ™ç”¨äºæ·±å±‚æ¬¡çš„å¹³å°ä¸»é¢˜å’Œé›†æˆã€‚</p><h2 id="åŸºæœ¬å·¥ä½œæµç¨‹"><a href="#åŸºæœ¬å·¥ä½œæµç¨‹" class="headerlink" title="åŸºæœ¬å·¥ä½œæµç¨‹"></a>åŸºæœ¬å·¥ä½œæµç¨‹</h2><p><code>Treeland</code> ä½¿ç”¨ <code>QQuickWindow</code> ä½œä¸ºæ¸²æŸ“çš„æ ¹ï¼Œè¿™æ ·åœ¨ <code>Treeland</code> é‡Œå¼€å‘æ—¶ï¼Œå°±å¦‚åŒå¼€å‘ä¸€ä¸ªæ™®é€š Qt ç¨‹åºä¸€æ ·ï¼Œå…ˆåˆ›å»ºä¸€ä¸ª Windowï¼Œåœ¨ Window å†…åˆ›å»º Qt æ§ä»¶ï¼Œä½¿ç”¨ QEvent å¤„ç†å„ç§äº‹ä»¶ã€‚</p><p>é‚£ä¹ˆ Treeland æ˜¯å¦‚ä½•å®ç°è¿™ä»¶äº‹çš„å‘¢ï¼Ÿ</p><p><code>QQuickWindow</code> çš„ç§æœ‰ç±»æä¾›äº†è‡ªå®šä¹‰ <code>QQuickGraphicsDevice</code> å¯¹è±¡çš„æ¥å£ï¼Œè€Œ <code>QQuickGraphicsDevice</code> å¯ä»¥ä½¿ç”¨ <code>fromOpenGLContext</code> å’Œ <code>fromPhyicalDevice</code> åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œé‚£ä¹ˆ <code>Treeland</code> åªéœ€è¦ç»§æ‰¿ <code>QQuickWindow</code>ï¼Œå¹¶ä» <code>wlroots</code> è·å– OpenGL context å’Œ phyical deviceï¼Œå°±å¯ä»¥å°† Qt QuickWindow çš„æ¸²æŸ“ï¼Œå«æ¥åˆ° <code>wlroots</code> ä¸Šã€‚</p><p>é€šè¿‡å°† <code>wlroots</code> çš„æ¸²æŸ“ä¸Šä¸‹æ–‡ä¸ Qt çš„æ¸²æŸ“ä¸Šä¸‹æ–‡è¿›è¡Œç»“åˆï¼Œå¯ä»¥å°† <code>wlroots</code> æ¸²æŸ“çš„å›¾å½¢ç»“æœåµŒå…¥åˆ° Qt åº”ç”¨ç¨‹åºçš„æ¸²æŸ“æµç¨‹ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>wlroots</code> æä¾›çš„å›¾å½¢èµ„æºå’Œè®¾å¤‡å¯¹è±¡ï¼Œå¦‚ç‰©ç†è®¾å¤‡ï¼ˆ<code>phdev</code>ï¼‰ã€é€»è¾‘è®¾å¤‡ï¼ˆ<code>dev</code>ï¼‰å’Œé˜Ÿåˆ—æ—ï¼ˆ<code>queue_family</code>ï¼‰ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œèµ„æºæ‹·è´ã€‚è¿™æ ·ï¼ŒQt å°±å¯ä»¥åˆ©ç”¨ <code>wlroots</code> æä¾›çš„æ¸²æŸ“èƒ½åŠ›ï¼ŒåŒæ—¶èƒ½å¤Ÿç»§ç»­ä½¿ç”¨ Qt çš„æ¸²æŸ“æ¡†æ¶å’Œ APIã€‚</p><p>ä¹‹ååœ¨ Qt QPA ä¸­å°†å±å¹•ä¿¡æ¯ï¼Œä»¥åŠè¾“å…¥ä¿¡æ¯è½¬æ¢æˆ Qt å†…éƒ¨å¯¹è±¡ï¼Œä»è€Œåˆ©ç”¨ Qt è‡ªèº«çš„äº‹ä»¶å¾ªç¯ç­‰æœºåˆ¶ç»§ç»­å¤„ç†ã€‚</p><h2 id="Qt-QPA"><a href="#Qt-QPA" class="headerlink" title="Qt QPA"></a>Qt QPA</h2><p>QPA ä¸º Qt æä¾›äº†è·¨å¹³å°çš„æ¥å£æŠ½è±¡èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›è‡ªå·±çš„ QPA æ’ä»¶æ¥ä¸º Qt ç¨‹åºæä¾›æ–°çš„èƒ½åŠ›ï¼Œä¾‹å¦‚å°† <code>wlroots</code> çš„è¾“å…¥äº‹ä»¶è½¬æ¢æˆ Qt å†…éƒ¨äº‹ä»¶ã€‚</p><h3 id="è¾“å…¥äº‹ä»¶å¤„ç†"><a href="#è¾“å…¥äº‹ä»¶å¤„ç†" class="headerlink" title="è¾“å…¥äº‹ä»¶å¤„ç†"></a>è¾“å…¥äº‹ä»¶å¤„ç†</h3><img src="/2024/11/09/treeland-part1-how-to-implement-a-wlroots-based-compositor/waylib.png" class="" title="Treeland å¤„ç†åº•å±‚äº‹ä»¶ä¸ä¸Šå±‚äº‹ä»¶çš„æµç¨‹"><p>Treeland å¤„ç†åº•å±‚äº‹ä»¶ä¸ä¸Šå±‚äº‹ä»¶çš„æµç¨‹</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">WOutputRenderWindow::event</span><span class="params">(QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_D</span>(WOutputRenderWindow);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == doRenderEventType) &#123;</span><br><span class="line">        QCoreApplication::<span class="built_in">removePostedEvents</span>(<span class="keyword">this</span>, doRenderEventType);</span><br><span class="line">        <span class="built_in">d_func</span>()-&gt;<span class="built_in">doRender</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (QW::RenderWindow::<span class="built_in">beforeDisposeEventFilter</span>(<span class="keyword">this</span>, event)) &#123;</span><br><span class="line">        event-&gt;<span class="built_in">accept</span>();</span><br><span class="line">        QW::RenderWindow::<span class="built_in">afterDisposeEventFilter</span>(<span class="keyword">this</span>, event);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> isAccepted = QQuickWindow::<span class="built_in">event</span>(event);</span><br><span class="line">    <span class="keyword">if</span> (QW::RenderWindow::<span class="built_in">afterDisposeEventFilter</span>(<span class="keyword">this</span>, event))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isAccepted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>WOutputRenderWindow</code> çš„äº‹ä»¶å¤„ç†ä¸­ï¼Œä¼šé¢å¤–è°ƒç”¨ä¸‹ seat çš„äº‹ä»¶è¿‡æ»¤å™¨ï¼Œç¡®ä¿åˆæˆå™¨å¯ä»¥æ‹¦æˆªæ‰ä¸€éƒ¨åˆ†äº‹ä»¶ï¼Œä¾‹å¦‚å°†ä¸€éƒ¨åˆ†æŒ‰é”®æ‹¦æˆªä¸‹æ¥ï¼Œä¸å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QWlrootsRenderWindow::beforeDisposeEventFilter</span><span class="params">(QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">isInputEvent</span>()) &#123;</span><br><span class="line">        <span class="keyword">auto</span> ie = <span class="built_in">static_cast</span>&lt;QInputEvent*&gt;(event);</span><br><span class="line">        <span class="keyword">auto</span> device = WInputDevice::<span class="built_in">from</span>(ie-&gt;<span class="built_in">device</span>());</span><br><span class="line">        <span class="built_in">Q_ASSERT</span>(device);</span><br><span class="line">        <span class="built_in">Q_ASSERT</span>(device-&gt;<span class="built_in">seat</span>());</span><br><span class="line">        lastActiveCursor = device-&gt;<span class="built_in">seat</span>()-&gt;<span class="built_in">cursor</span>();</span><br><span class="line">        <span class="keyword">return</span> device-&gt;<span class="built_in">seat</span>()-&gt;<span class="built_in">filterEventBeforeDisposeStage</span>(<span class="built_in">window</span>(), ie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å±•ç¤ºäº†è½¬æ¢è¾“å…¥è®¾å¤‡çš„åŠŸèƒ½ï¼Œåˆ¤æ–­è¾“å…¥è®¾å¤‡çš„ç±»å‹ï¼Œåˆ›å»ºå¯¹åº”çš„ <code>QInputDevice</code> å¯¹è±¡ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">QPointer&lt;QInputDevice&gt; <span class="title">QWlrootsIntegration::addInputDevice</span><span class="params">(WInputDevice *device, <span class="type">const</span> QString &amp;seatName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPointer&lt;QInputDevice&gt; qtdev;</span><br><span class="line">    <span class="keyword">auto</span> qwDevice = device-&gt;<span class="built_in">handle</span>();</span><br><span class="line">    <span class="type">const</span> QString name = QString::<span class="built_in">fromUtf8</span>(qwDevice-&gt;<span class="built_in">handle</span>()-&gt;name);</span><br><span class="line">    qint64 systemId = <span class="built_in">reinterpret_cast</span>&lt;qint64&gt;(device);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (qwDevice-&gt;<span class="built_in">handle</span>()-&gt;type) &#123;</span><br><span class="line">    <span class="keyword">case</span> WLR_INPUT_DEVICE_KEYBOARD: &#123;</span><br><span class="line">        qtdev = <span class="keyword">new</span> <span class="built_in">QInputDevice</span>(name, systemId, QInputDevice::DeviceType::Keyboard, seatName);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> WLR_INPUT_DEVICE_POINTER: &#123;</span><br><span class="line">        qtdev = <span class="keyword">new</span> <span class="built_in">QPointingDevice</span>(name, systemId, QInputDevice::DeviceType::TouchPad, QPointingDevice::PointerType::Generic,</span><br><span class="line">                                    QInputDevice::Capability::Position | QInputDevice::Capability::Hover</span><br><span class="line">                                        | QInputDevice::Capability::Scroll | QInputDevice::Capability::MouseEmulation,</span><br><span class="line">                                    <span class="number">10</span>, <span class="number">32</span>, seatName, <span class="built_in">QPointingDeviceUniqueId</span>());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> WLR_INPUT_DEVICE_TOUCH: &#123;</span><br><span class="line">        qtdev = <span class="keyword">new</span> <span class="built_in">QPointingDevice</span>(name, systemId, QInputDevice::DeviceType::TouchScreen, QPointingDevice::PointerType::Finger,</span><br><span class="line">                                    QInputDevice::Capability::Position | QInputDevice::Capability::Area | QInputDevice::Capability::MouseEmulation,</span><br><span class="line">                                    <span class="number">10</span>, <span class="number">32</span>, seatName, <span class="built_in">QPointingDeviceUniqueId</span>());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> WLR_INPUT_DEVICE_TABLET_TOOL: &#123;</span><br><span class="line">        qtdev = <span class="keyword">new</span> <span class="built_in">QPointingDevice</span>(name, systemId, QInputDevice::DeviceType::Stylus, QPointingDevice::PointerType::Pen,</span><br><span class="line">                                    QInputDevice::Capability::XTilt | QInputDevice::Capability::YTilt | QInputDevice::Capability::Pressure,</span><br><span class="line">                                    <span class="number">1</span>, <span class="number">32</span>, seatName, <span class="built_in">QPointingDeviceUniqueId</span>());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> WLR_INPUT_DEVICE_TABLET_PAD: &#123;</span><br><span class="line">        <span class="keyword">auto</span> pad = <span class="built_in">wlr_tablet_pad_from_input_device</span>(qwDevice-&gt;<span class="built_in">handle</span>());</span><br><span class="line">        qtdev = <span class="keyword">new</span> <span class="built_in">QPointingDevice</span>(name, systemId, QInputDevice::DeviceType::TouchPad, QPointingDevice::PointerType::Pen,</span><br><span class="line">                                    QInputDevice::Capability::Position | QInputDevice::Capability::Hover | QInputDevice::Capability::Pressure,</span><br><span class="line">                                    <span class="number">1</span>, pad-&gt;button_count, seatName, <span class="built_in">QPointingDeviceUniqueId</span>());</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> WLR_INPUT_DEVICE_SWITCH: &#123;</span><br><span class="line">        qtdev = <span class="keyword">new</span> <span class="built_in">QInputDevice</span>(name, systemId, QInputDevice::DeviceType::Keyboard, seatName);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (qtdev) &#123;</span><br><span class="line">        device-&gt;<span class="built_in">setQtDevice</span>(qtdev);</span><br><span class="line">        QWindowSystemInterface::<span class="built_in">registerInputDevice</span>(qtdev);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (qtdev-&gt;<span class="built_in">type</span>() == QInputDevice::DeviceType::Mouse || qtdev-&gt;<span class="built_in">type</span>() == QInputDevice::DeviceType::TouchPad) &#123;</span><br><span class="line">            <span class="keyword">auto</span> primaryQtDevice = QPointingDevice::<span class="built_in">primaryPointingDevice</span>();</span><br><span class="line">            <span class="keyword">if</span> (!WInputDevice::<span class="built_in">from</span>(primaryQtDevice)) &#123;</span><br><span class="line">                <span class="comment">// Ensure the primary pointing device is the WInputDevice</span></span><br><span class="line">                <span class="keyword">auto</span> pd = <span class="built_in">const_cast</span>&lt;QPointingDevice*&gt;(primaryQtDevice);</span><br><span class="line">                pd-&gt;<span class="built_in">setParent</span>(<span class="literal">nullptr</span>);</span><br><span class="line">                <span class="keyword">delete</span> pd;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">Q_ASSERT</span>(WInputDevice::<span class="built_in">from</span>(QPointingDevice::<span class="built_in">primaryPointingDevice</span>()));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (qtdev-&gt;<span class="built_in">type</span>() == QInputDevice::DeviceType::Keyboard) &#123;</span><br><span class="line">            <span class="keyword">auto</span> primaryQtDevice = QInputDevice::<span class="built_in">primaryKeyboard</span>();</span><br><span class="line">            <span class="keyword">if</span> (!WInputDevice::<span class="built_in">from</span>(primaryQtDevice)) &#123;</span><br><span class="line">                <span class="comment">// Ensure the primary keyboard device is the WInputDevice</span></span><br><span class="line">                <span class="keyword">auto</span> pd = <span class="built_in">const_cast</span>&lt;QInputDevice*&gt;(primaryQtDevice);</span><br><span class="line">                pd-&gt;<span class="built_in">setParent</span>(<span class="literal">nullptr</span>);</span><br><span class="line">                <span class="keyword">delete</span> pd;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">Q_ASSERT</span>(WInputDevice::<span class="built_in">from</span>(QInputDevice::<span class="built_in">primaryKeyboard</span>()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> qtdev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯äº‹ä»¶"><a href="#å®¢æˆ·ç«¯äº‹ä»¶" class="headerlink" title="å®¢æˆ·ç«¯äº‹ä»¶"></a>å®¢æˆ·ç«¯äº‹ä»¶</h3><p>åœ¨ Treeland è¿˜æœ‰ä¸€ç§äº‹ä»¶éœ€è¦å¤„ç†ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªçª—å£ï¼Œåˆæˆå™¨éœ€è¦å‘ŠçŸ¥å®¢æˆ·ç«¯å“ªä¸ªåæ ‡ç‚¹å‡»äº†ã€‚æˆ–è€…ä½¿ç”¨é”®ç›˜è¿›è¡Œè¾“å…¥æ—¶ï¼Œéœ€è¦å‘ŠçŸ¥å®¢æˆ·ç«¯è¾“å…¥çš„å†…å®¹ã€‚</p><p>é¦–å…ˆï¼ŒTreeland ä¼šæ ‡è®°ä¸€ä¸ªçª—å£æˆä¸ºæ¿€æ´»çª—å£ï¼Œè®¾ç½®ç»™ seatï¼Œè¿™æ · <code>wlroots</code> å°±çŸ¥é“å“ªä¸ªçª—å£æ­¤æ—¶æ‹¥æœ‰ç„¦ç‚¹ã€‚</p><p>ä¹‹åå½“é”®ç›˜å‘ç”Ÿè¾“å…¥äº‹ä»¶æ—¶ï¼ŒTreeland æ²¡æœ‰è¿‡æ»¤æ‰æŒ‰é”®äº‹ä»¶ï¼Œæˆ–è€…æ˜¯æ”¾è¡ŒæŸäº›æŒ‰é”®ï¼Œè¿™äº›å‰©ä½™çš„è¾“å…¥äº‹ä»¶å°±ä¼šåœ¨ wseat çš„ sendEvent ä¸­ï¼Œå‘é€ç»™æ¿€æ´»çš„å®¢æˆ·ç«¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// for keyboard event</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">doNotifyKey</span><span class="params">(WInputDevice *device, <span class="type">uint32_t</span> keycode, <span class="type">uint32_t</span> state, <span class="type">uint32_t</span> timestamp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">keyboardFocusSurface</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">q_func</span>()-&gt;<span class="built_in">setKeyboard</span>(device);</span><br><span class="line">    <span class="comment">/* Send modifiers to the client. */</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">handle</span>()-&gt;<span class="built_in">keyboard_notify_key</span>(timestamp, keycode, state);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å±å¹•ä¿¡æ¯"><a href="#å±å¹•ä¿¡æ¯" class="headerlink" title="å±å¹•ä¿¡æ¯"></a>å±å¹•ä¿¡æ¯</h3><p>åœ¨ QPA ä¸­è¿˜å¯¹ <code>WOutput</code> è¿›è¡Œäº†å°è£… <code>QWlrootsScreen</code>ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">QWlrootsScreen *<span class="title">QWlrootsIntegration::addScreen</span><span class="params">(WOutput *output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_screens &lt;&lt; <span class="keyword">new</span> <span class="built_in">QWlrootsScreen</span>(output);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isMaster</span>()) &#123;</span><br><span class="line">        QWindowSystemInterface::<span class="built_in">handleScreenAdded</span>(m_screens.<span class="built_in">last</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (m_placeholderScreen) &#123;</span><br><span class="line">            QWindowSystemInterface::<span class="built_in">handleScreenRemoved</span>(m_placeholderScreen.<span class="built_in">release</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Q_UNUSED</span>(<span class="keyword">new</span> <span class="built_in">QScreen</span>(m_screens.<span class="built_in">last</span>()))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m_screens.<span class="built_in">last</span>()-&gt;<span class="built_in">initialize</span>();</span><br><span class="line">    output-&gt;<span class="built_in">setScreen</span>(m_screens.<span class="built_in">last</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m_screens.<span class="built_in">last</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>QWlrootsScreen</code> ç»§æ‰¿è‡ª <code>QPlatformScreen</code>ï¼Œåšçš„äº‹æƒ…æ˜¯å°†éƒ¨åˆ†å‚æ•°è¿›è¡Œè½¬æ¢ï¼Œä¾‹å¦‚physicalSizeã€devicePixelRatioã€DPIç­‰ï¼Œä¹‹åé€šè¿‡ <code>QWindowSystemInterface::handleScreenAdded</code> å°†åˆ›å»ºå¥½çš„ <code>QWlrootsScreen</code> æ·»åŠ è¿› Qt å†…ã€‚</p><h2 id="Qt-RHI"><a href="#Qt-RHI" class="headerlink" title="Qt RHI"></a>Qt RHI</h2><p>æ‘˜æŠ„ä¸€æ®µæ¥è‡ª waylib ä¸­åˆå§‹åŒ– Qt RHI çš„ä»£ç </p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">WOutputRenderWindowPrivate::initRCWithRhi</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">W_Q</span>(WOutputRenderWindow);</span><br><span class="line"></span><br><span class="line">    QQuickRenderControlPrivate *rcd = QQuickRenderControlPrivate::<span class="built_in">get</span>(<span class="built_in">rc</span>());</span><br><span class="line">    QSGRhiSupport *rhiSupport = QSGRhiSupport::<span class="built_in">instance</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// sanity check for Vulkan</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> ENABLE_VULKAN_RENDER</span></span><br><span class="line">    <span class="keyword">if</span> (rhiSupport-&gt;<span class="built_in">rhiBackend</span>() == QRhi::Vulkan) &#123;</span><br><span class="line">        vkInstance.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">QVulkanInstance</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> phdev = <span class="built_in">wlr_vk_renderer_get_physical_device</span>(m_renderer-&gt;<span class="built_in">handle</span>());</span><br><span class="line">        <span class="keyword">auto</span> dev = <span class="built_in">wlr_vk_renderer_get_device</span>(m_renderer-&gt;<span class="built_in">handle</span>());</span><br><span class="line">        <span class="keyword">auto</span> queue_family = <span class="built_in">wlr_vk_renderer_get_queue_family</span>(m_renderer-&gt;<span class="built_in">handle</span>());</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> QT_VERSION &gt; QT_VERSION_CHECK(6, 6, 0)</span></span><br><span class="line">        <span class="keyword">auto</span> instance = <span class="built_in">wlr_vk_renderer_get_instance</span>(m_renderer-&gt;<span class="built_in">handle</span>());</span><br><span class="line">        vkInstance-&gt;<span class="built_in">setVkInstance</span>(instance);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="comment">//        vkInstance-&gt;setExtensions(fromCStyleList(vkRendererAttribs.extension_count, vkRendererAttribs.extensions));</span></span><br><span class="line">        <span class="comment">//        vkInstance-&gt;setLayers(fromCStyleList(vkRendererAttribs.layer_count, vkRendererAttribs.layers));</span></span><br><span class="line">        vkInstance-&gt;<span class="built_in">setApiVersion</span>(&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>&#125;);</span><br><span class="line">        vkInstance-&gt;<span class="built_in">create</span>();</span><br><span class="line">        q-&gt;<span class="built_in">setVulkanInstance</span>(vkInstance.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> gd = QQuickGraphicsDevice::<span class="built_in">fromDeviceObjects</span>(phdev, dev, queue_family);</span><br><span class="line">        q-&gt;<span class="built_in">setGraphicsDevice</span>(gd);</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> (rhiSupport-&gt;<span class="built_in">rhiBackend</span>() == QRhi::OpenGLES2) &#123;</span><br><span class="line">        <span class="built_in">Q_ASSERT</span>(<span class="built_in">wlr_renderer_is_gles2</span>(m_renderer-&gt;<span class="built_in">handle</span>()));</span><br><span class="line">        <span class="keyword">auto</span> egl = <span class="built_in">wlr_gles2_renderer_get_egl</span>(m_renderer-&gt;<span class="built_in">handle</span>());</span><br><span class="line">        <span class="keyword">auto</span> display = <span class="built_in">wlr_egl_get_display</span>(egl);</span><br><span class="line">        <span class="keyword">auto</span> context = <span class="built_in">wlr_egl_get_context</span>(egl);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>-&gt;glContext = <span class="keyword">new</span> QW::<span class="built_in">OpenGLContext</span>(display, context, <span class="built_in">rc</span>());</span><br><span class="line">        <span class="type">bool</span> ok = <span class="keyword">this</span>-&gt;glContext-&gt;<span class="built_in">create</span>();</span><br><span class="line">        <span class="keyword">if</span> (!ok)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        q-&gt;<span class="built_in">setGraphicsDevice</span>(QQuickGraphicsDevice::<span class="built_in">fromOpenGLContext</span>(<span class="keyword">this</span>-&gt;glContext));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    QOffscreenSurface *offscreenSurface = <span class="keyword">new</span> QW::<span class="built_in">OffscreenSurface</span>(<span class="literal">nullptr</span>, q);</span><br><span class="line">    offscreenSurface-&gt;<span class="built_in">create</span>();</span><br><span class="line"></span><br><span class="line">    QSGRhiSupport::RhiCreateResult result = rhiSupport-&gt;<span class="built_in">createRhi</span>(q, offscreenSurface);</span><br><span class="line">    <span class="keyword">if</span> (!result.rhi) &#123;</span><br><span class="line">        <span class="built_in">qWarning</span>(<span class="string">&quot;WOutput::initRhi: Failed to initialize QRhi&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rcd-&gt;rhi = result.rhi;</span><br><span class="line">    <span class="comment">// Ensure the QQuickRenderControl don&#x27;t reinit the RHI</span></span><br><span class="line">    rcd-&gt;ownRhi = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">rc</span>()-&gt;<span class="built_in">initialize</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    rcd-&gt;ownRhi = result.own;</span><br><span class="line">    <span class="built_in">Q_ASSERT</span>(rcd-&gt;rhi == result.rhi);</span><br><span class="line">    <span class="built_in">Q_ASSERT</span>(!swapchain);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆè·å– <code>QSGRhiSupport</code> åŠç›¸å…³æ§åˆ¶å¯¹è±¡ã€‚</p><p>åˆ¤æ–­ RHI backend çš„ç±»å‹ï¼Œéœ€è¦é€‚é… <code>vulkan</code>ã€<code>gles</code>ç­‰ã€‚</p><p>ä» <code>wlroots</code> è·å–ç‰©ç†è®¾å¤‡ç­‰å‚æ•°ï¼Œä½¿ç”¨ <code>QQuickGraphicsDevice::fromDeviceObjects</code> åˆ›å»º Qt çš„ <code>QQuickGraphicsDevice</code>ã€‚</p><p>render windowçš„ç§æœ‰ç±»æ˜¯ç»§æ‰¿è‡ª <code>QQuickWindowPrivate</code>ï¼Œåªéœ€è¦å°†è·å–åˆ°çš„ <code>QQuickGraphicsDevice</code> è®¾ç½®ç»™ <code>QQuickWindowPrivate::setGraphicsDevice</code> å³å¯ã€‚</p><p>ä¹‹ååˆ›å»ºä¸€ä¸ªç¦»å±æ¸²æŸ“è¡¨é¢ï¼Œç”¨äº RHI çš„åˆå§‹åŒ–ã€‚</p><h2 id="Qt-Viewport"><a href="#Qt-Viewport" class="headerlink" title="Qt Viewport"></a>Qt Viewport</h2><p>åœ¨ Qt ä¸­ï¼Œæƒ³è¦æŸ¥çœ‹æˆ–è€…æ¸²æŸ“ä¸€ä¸ªç»„ä»¶ï¼Œéœ€è¦ä½¿ç”¨ Viewport ç»„ä»¶ï¼Œä¿—ç§°ç…§ç›¸æœºã€‚</p><p>è§†å£ï¼ˆViewportï¼‰æ˜¯ä¸€ä¸ªå¯è§‚å¯Ÿçš„å¤šè¾¹å½¢åŒºåŸŸï¼Œåªæœ‰ Viewport èŒƒå›´å†…çš„ç”»é¢æ‰èƒ½æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚</p><p><code>wlroots</code> ä¸­çš„ <strong>Viewport</strong> æ˜¯ä¸€ä¸ªä¸ <code>Wayland</code> æ˜¾ç¤ºåè®®ç›¸å…³çš„æ¦‚å¿µï¼Œä¸»è¦ç”¨äºå®šä¹‰æ¸²æŸ“è¾“å‡ºåœ¨å±å¹•ä¸Šçš„æ˜¾ç¤ºåŒºåŸŸã€‚å®ƒå…è®¸åœ¨æ¸²æŸ“æ—¶å¯¹æ˜¾ç¤ºå†…å®¹è¿›è¡Œç¼©æ”¾ã€è£å‰ªæˆ–å¹³ç§»ï¼Œä»¥é€‚åº”ä¸åŒçš„åˆ†è¾¨ç‡å’Œæ˜¾ç¤ºéœ€æ±‚ã€‚</p><p>Treeland ä½¿ç”¨ <code>WOutputViewport</code> æä¾› Viewport åŠŸèƒ½ï¼Œä½¿ç”¨ <code>wlroots</code> çš„ <code>wlr_output</code> ä¸­çš„å±å¹•ä¿¡æ¯ï¼Œå¯¹ç”»é¢è¿›è¡ŒçŸ©é˜µå˜æ¢ï¼Œè¿™é‡Œä¼šæ¶‰åŠåˆ°å±å¹•çš„ç¼©æ”¾ã€DPIç­‰å‚æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">QMatrix4x4 <span class="title">WOutputViewport::renderMatrix</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QMatrix4x4 renderMatrix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">auto</span> customTransform = <span class="built_in">viewportTransform</span>()) &#123;</span><br><span class="line">        customTransform-&gt;<span class="built_in">applyTo</span>(&amp;renderMatrix);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">parentItem</span>() &amp;&amp; !<span class="built_in">ignoreViewport</span>() &amp;&amp; <span class="built_in">input</span>() != <span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">auto</span> d = QQuickItemPrivate::<span class="built_in">get</span>(<span class="built_in">const_cast</span>&lt;WOutputViewport*&gt;(<span class="keyword">this</span>));</span><br><span class="line">        <span class="keyword">auto</span> viewportMatrix = d-&gt;<span class="built_in">itemNode</span>()-&gt;<span class="built_in">matrix</span>().<span class="built_in">inverted</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">auto</span> inputItem = <span class="built_in">input</span>()) &#123;</span><br><span class="line">            QMatrix4x4 matrix = QQuickItemPrivate::<span class="built_in">get</span>(<span class="built_in">parentItem</span>())-&gt;<span class="built_in">itemToWindowTransform</span>();</span><br><span class="line">            matrix *= QQuickItemPrivate::<span class="built_in">get</span>(inputItem)-&gt;<span class="built_in">windowToItemTransform</span>();</span><br><span class="line">            renderMatrix = viewportMatrix * matrix.<span class="built_in">inverted</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// the input item is window&#x27;s contentItem</span></span><br><span class="line">            <span class="keyword">auto</span> pd = QQuickItemPrivate::<span class="built_in">get</span>(<span class="built_in">parentItem</span>());</span><br><span class="line">            QMatrix4x4 parentMatrix = pd-&gt;<span class="built_in">itemToWindowTransform</span>().<span class="built_in">inverted</span>();</span><br><span class="line">            renderMatrix = viewportMatrix * parentMatrix;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> renderMatrix;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WOutputViewport</code> æä¾›äº† Viewport æ‰€éœ€çš„æ‰€æœ‰å‚æ•°ï¼Œå˜æ¢çŸ©é˜µã€æºå‡ ä½•å¤§å°ã€ç›®æ ‡å‡ ä½•å¤§å°ç­‰ä¿¡æ¯ã€‚</p><p>åœ¨ <code>WOutputRenderWindow</code> çš„äº‹ä»¶ä¸­ï¼Œåˆ¤æ–­å¦‚æœæ˜¯æ¸²æŸ“çš„äº‹ä»¶ï¼Œå°±æ‰§è¡Œæ¸²æŸ“ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">WOutputRenderWindow::event</span><span class="params">(QEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_D</span>(WOutputRenderWindow);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">type</span>() == doRenderEventType) &#123;</span><br><span class="line">        QCoreApplication::<span class="built_in">removePostedEvents</span>(<span class="keyword">this</span>, doRenderEventType);</span><br><span class="line">        <span class="built_in">d_func</span>()-&gt;<span class="built_in">doRender</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (QW::RenderWindow::<span class="built_in">beforeDisposeEventFilter</span>(<span class="keyword">this</span>, event)) &#123;</span><br><span class="line">        event-&gt;<span class="built_in">accept</span>();</span><br><span class="line">        QW::RenderWindow::<span class="built_in">afterDisposeEventFilter</span>(<span class="keyword">this</span>, event);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> isAccepted = QQuickWindow::<span class="built_in">event</span>(event);</span><br><span class="line">    <span class="keyword">if</span> (QW::RenderWindow::<span class="built_in">afterDisposeEventFilter</span>(<span class="keyword">this</span>, event))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isAccepted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ doRender ä¸­ï¼Œéå†æ‰€æœ‰çš„ Outputï¼Œæ‰§è¡Œ beginRenderï¼Œç„¶åæ‰§è¡Œ Output çš„æ¸²æŸ“ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">WOutputRenderWindowPrivate::doRender</span><span class="params">(<span class="type">const</span> QList&lt;OutputHelper *&gt; &amp;outputs,</span></span></span><br><span class="line"><span class="params"><span class="function">                                          <span class="type">bool</span> forceRender, <span class="type">bool</span> doCommit)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_ASSERT</span>(rendererList.<span class="built_in">isEmpty</span>());</span><br><span class="line">    <span class="built_in">Q_ASSERT</span>(!inRendering);</span><br><span class="line">    inRendering = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">W_Q</span>(WOutputRenderWindow);</span><br><span class="line">    <span class="keyword">for</span> (OutputLayer *layer : std::<span class="built_in">as_const</span>(layers)) &#123;</span><br><span class="line">        layer-&gt;<span class="built_in">beforeRender</span>(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">rc</span>()-&gt;<span class="built_in">polishItems</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (QSGRendererInterface::<span class="built_in">isApiRhiBased</span>(WRenderHelper::<span class="built_in">getGraphicsApi</span>()))</span><br><span class="line">        <span class="built_in">rc</span>()-&gt;<span class="built_in">beginFrame</span>();</span><br><span class="line">    <span class="built_in">rc</span>()-&gt;<span class="built_in">sync</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">QQuickAnimatorController_advance</span>(animationController.<span class="built_in">get</span>());</span><br><span class="line">    Q_EMIT q-&gt;<span class="built_in">beforeRendering</span>();</span><br><span class="line">    <span class="built_in">runAndClearJobs</span>(&amp;beforeRenderingJobs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> needsCommit = <span class="built_in">doRenderOutputs</span>(outputs, forceRender);</span><br><span class="line"></span><br><span class="line">    Q_EMIT q-&gt;<span class="built_in">afterRendering</span>();</span><br><span class="line">    <span class="built_in">runAndClearJobs</span>(&amp;afterRenderingJobs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (QSGRendererInterface::<span class="built_in">isApiRhiBased</span>(WRenderHelper::<span class="built_in">getGraphicsApi</span>()))</span><br><span class="line">        <span class="built_in">rc</span>()-&gt;<span class="built_in">endFrame</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (doCommit) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> i : std::<span class="built_in">as_const</span>(needsCommit)) &#123;</span><br><span class="line">            <span class="type">bool</span> ok = i.first-&gt;<span class="built_in">commit</span>(i.second);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i.second-&gt;<span class="built_in">currentBuffer</span>()) &#123;</span><br><span class="line">                i.second-&gt;<span class="built_in">endRender</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            i.first-&gt;<span class="built_in">resetState</span>(ok);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">resetGlState</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// On Intel&amp;Nvidia multi-GPU environment, wlroots using Intel card do render for all</span></span><br><span class="line">    <span class="comment">// outputs, and blit nvidia&#x27;s output buffer in drm_connector_state_update_primary_fb,</span></span><br><span class="line">    <span class="comment">// the &#x27;blit&#x27; behavior will make EGL context to Nvidia renderer. So must done current</span></span><br><span class="line">    <span class="comment">// OpenGL context here in order to ensure QtQuick always make EGL context to Intel</span></span><br><span class="line">    <span class="comment">// renderer before next frame.</span></span><br><span class="line">    <span class="keyword">if</span> (glContext)</span><br><span class="line">        glContext-&gt;<span class="built_in">doneCurrent</span>();</span><br><span class="line"></span><br><span class="line">    inRendering = <span class="literal">false</span>;</span><br><span class="line">    Q_EMIT q-&gt;<span class="built_in">renderEnd</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">qw_buffer *<span class="title">WBufferRenderer::beginRender</span><span class="params">(<span class="type">const</span> QSize &amp;pixelSize, qreal devicePixelRatio,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        <span class="type">uint32_t</span> format, RenderFlags flags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_ASSERT</span>(!state.buffer);</span><br><span class="line">    <span class="built_in">Q_ASSERT</span>(m_output);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pixelSize.<span class="built_in">isEmpty</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Q_EMIT <span class="title">beforeRendering</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    m_damageRing.<span class="built_in">set_bounds</span>(pixelSize.<span class="built_in">width</span>(), pixelSize.<span class="built_in">height</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// configure swapchain</span></span><br><span class="line">    <span class="keyword">if</span> (flags.<span class="built_in">testFlag</span>(RenderFlag::DontConfigureSwapchain)) &#123;</span><br><span class="line">        <span class="keyword">auto</span> renderFormat = <span class="built_in">pickFormat</span>(m_output-&gt;<span class="built_in">renderer</span>(), format);</span><br><span class="line">        <span class="keyword">if</span> (!renderFormat) &#123;</span><br><span class="line">            <span class="built_in">qWarning</span>(<span class="string">&quot;wlr_renderer doesn&#x27;t support format 0x%s&quot;</span>, <span class="built_in">drmGetFormatName</span>(format));</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!m_swapchain || <span class="built_in">QSize</span>(m_swapchain-&gt;<span class="built_in">handle</span>()-&gt;width, m_swapchain-&gt;<span class="built_in">handle</span>()-&gt;height) != pixelSize</span><br><span class="line">            || m_swapchain-&gt;<span class="built_in">handle</span>()-&gt;format.format != renderFormat-&gt;format) &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_swapchain)</span><br><span class="line">                <span class="keyword">delete</span> m_swapchain;</span><br><span class="line">            m_swapchain = qw_swapchain::<span class="built_in">create</span>(m_output-&gt;<span class="built_in">allocator</span>()-&gt;<span class="built_in">handle</span>(), pixelSize.<span class="built_in">width</span>(), pixelSize.<span class="built_in">height</span>(), renderFormat);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flags.<span class="built_in">testFlag</span>(RenderFlag::UseCursorFormats)) &#123;</span><br><span class="line">        <span class="type">bool</span> ok = m_output-&gt;<span class="built_in">configureCursorSwapchain</span>(pixelSize, format, &amp;m_swapchain);</span><br><span class="line">        <span class="keyword">if</span> (!ok)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">bool</span> ok = m_output-&gt;<span class="built_in">configurePrimarySwapchain</span>(pixelSize, format, &amp;m_swapchain,</span><br><span class="line">                                                      !flags.<span class="built_in">testFlag</span>(DontTestSwapchain));</span><br><span class="line">        <span class="keyword">if</span> (!ok)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Support scanout buffer of wlr_surface(from WSurfaceItem)</span></span><br><span class="line">    <span class="type">int</span> bufferAge;</span><br><span class="line">    <span class="keyword">auto</span> wbuffer = m_swapchain-&gt;<span class="built_in">acquire</span>(&amp;bufferAge);</span><br><span class="line">    <span class="keyword">if</span> (!wbuffer)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">auto</span> buffer = qw_buffer::<span class="built_in">from</span>(wbuffer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!m_renderHelper)</span><br><span class="line">        m_renderHelper = <span class="keyword">new</span> <span class="built_in">WRenderHelper</span>(m_output-&gt;<span class="built_in">renderer</span>());</span><br><span class="line">    m_renderHelper-&gt;<span class="built_in">setSize</span>(pixelSize);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> wd = QQuickWindowPrivate::<span class="built_in">get</span>(<span class="built_in">window</span>());</span><br><span class="line">    <span class="built_in">Q_ASSERT</span>(wd-&gt;renderControl);</span><br><span class="line">    <span class="keyword">auto</span> lastRT = m_renderHelper-&gt;<span class="built_in">lastRenderTarget</span>();</span><br><span class="line">    <span class="keyword">auto</span> rt = m_renderHelper-&gt;<span class="built_in">acquireRenderTarget</span>(wd-&gt;renderControl, buffer);</span><br><span class="line">    <span class="keyword">if</span> (rt.<span class="built_in">isNull</span>()) &#123;</span><br><span class="line">        buffer-&gt;<span class="built_in">unlock</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> rtd = QQuickRenderTargetPrivate::<span class="built_in">get</span>(&amp;rt);</span><br><span class="line">    QSGRenderTarget sgRT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rtd-&gt;type == QQuickRenderTargetPrivate::Type::PaintDevice) &#123;</span><br><span class="line">        sgRT.paintDevice = rtd-&gt;u.paintDevice;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Q_ASSERT</span>(rtd-&gt;type == QQuickRenderTargetPrivate::Type::RhiRenderTarget);</span><br><span class="line">        sgRT.rt = rtd-&gt;u.rhiRt;</span><br><span class="line">        sgRT.cb = wd-&gt;redirect.commandBuffer;</span><br><span class="line">        <span class="built_in">Q_ASSERT</span>(sgRT.cb);</span><br><span class="line">        sgRT.rpDesc = rtd-&gt;u.rhiRt-&gt;<span class="built_in">renderPassDescriptor</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> QT_NO_OPENGL</span></span><br><span class="line">        <span class="keyword">if</span> (wd-&gt;rhi-&gt;<span class="built_in">backend</span>() == QRhi::OpenGLES2) &#123;</span><br><span class="line">            <span class="keyword">auto</span> glRT = <span class="built_in">QRHI_RES</span>(QGles2TextureRenderTarget, rtd-&gt;u.rhiRt);</span><br><span class="line">            <span class="built_in">Q_ASSERT</span>(glRT-&gt;framebuffer &gt;= <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">auto</span> glContext = QOpenGLContext::<span class="built_in">currentContext</span>();</span><br><span class="line">            <span class="built_in">Q_ASSERT</span>(glContext);</span><br><span class="line">            QOpenGLContextPrivate::<span class="built_in">get</span>(glContext)-&gt;defaultFboRedirect = glRT-&gt;framebuffer;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    state.flags = flags;</span><br><span class="line">    state.context = wd-&gt;context;</span><br><span class="line">    state.pixelSize = pixelSize;</span><br><span class="line">    state.devicePixelRatio = devicePixelRatio;</span><br><span class="line">    state.bufferAge = bufferAge;</span><br><span class="line">    state.lastRT = lastRT;</span><br><span class="line">    state.buffer = buffer;</span><br><span class="line">    state.renderTarget = rt;</span><br><span class="line">    state.sgRenderTarget = sgRT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> buffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">QVector&lt;std::pair&lt;OutputHelper*, WBufferRenderer*&gt;&gt;</span><br><span class="line">WOutputRenderWindowPrivate::<span class="built_in">doRenderOutputs</span>(<span class="type">const</span> QList&lt;OutputHelper*&gt; &amp;outputs, <span class="type">bool</span> forceRender)</span><br><span class="line">&#123;</span><br><span class="line">    QVector&lt;OutputHelper*&gt; renderResults;</span><br><span class="line">    renderResults.<span class="built_in">reserve</span>(outputs.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span> (OutputHelper *helper : std::<span class="built_in">as_const</span>(outputs)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Q_LIKELY</span>(!forceRender)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!helper-&gt;<span class="built_in">renderable</span>()</span><br><span class="line">                || <span class="built_in">Q_UNLIKELY</span>(!WOutputViewportPrivate::<span class="built_in">get</span>(helper-&gt;<span class="built_in">output</span>())-&gt;<span class="built_in">renderable</span>())</span><br><span class="line">                || !helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">isEnabled</span>())</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!helper-&gt;<span class="built_in">contentIsDirty</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (helper-&gt;<span class="built_in">needsFrame</span>())</span><br><span class="line">                    renderResults.<span class="built_in">append</span>(helper);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Q_ASSERT</span>(helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">scale</span>() &lt;= helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">devicePixelRatio</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> <span class="keyword">auto</span> &amp;format = helper-&gt;<span class="built_in">qwoutput</span>()-&gt;<span class="built_in">handle</span>()-&gt;render_format;</span><br><span class="line">        <span class="type">const</span> <span class="keyword">auto</span> renderMatrix = helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">renderMatrix</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// maybe using the other WOutputViewport&#x27;s QSGTextureProvider</span></span><br><span class="line">        <span class="keyword">if</span> (!helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">depends</span>().<span class="built_in">isEmpty</span>())</span><br><span class="line">            <span class="built_in">updateDirtyNodes</span>();</span><br><span class="line"></span><br><span class="line">        qw_buffer *buffer = helper-&gt;<span class="built_in">beginRender</span>(helper-&gt;<span class="built_in">bufferRenderer</span>(), helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">size</span>(), format,</span><br><span class="line">                                                WBufferRenderer::RedirectOpenGLContextDefaultFrameBufferObject);</span><br><span class="line">        <span class="built_in">Q_ASSERT</span>(buffer == helper-&gt;<span class="built_in">bufferRenderer</span>()-&gt;<span class="built_in">currentBuffer</span>());</span><br><span class="line">        <span class="keyword">if</span> (buffer) &#123;</span><br><span class="line">            helper-&gt;<span class="built_in">render</span>(helper-&gt;<span class="built_in">bufferRenderer</span>(), <span class="number">0</span>, renderMatrix,</span><br><span class="line">                           helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">effectiveSourceRect</span>(),</span><br><span class="line">                           helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">targetRect</span>(),</span><br><span class="line">                           helper-&gt;<span class="built_in">output</span>()-&gt;<span class="built_in">preserveColorContents</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        renderResults.<span class="built_in">append</span>(helper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    QVector&lt;std::pair&lt;OutputHelper*, WBufferRenderer*&gt;&gt; needsCommit;</span><br><span class="line">    needsCommit.<span class="built_in">reserve</span>(renderResults.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> helper : std::<span class="built_in">as_const</span>(renderResults)) &#123;</span><br><span class="line">        <span class="keyword">auto</span> bufferRenderer = helper-&gt;<span class="built_in">afterRender</span>();</span><br><span class="line">        <span class="keyword">if</span> (bufferRenderer)</span><br><span class="line">            needsCommit.<span class="built_in">append</span>(&#123;helper, bufferRenderer&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rendererList.<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> needsCommit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">WBufferRenderer::render</span><span class="params">(<span class="type">int</span> sourceIndex, <span class="type">const</span> QMatrix4x4 &amp;renderMatrix,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="type">const</span> QRectF &amp;sourceRect, <span class="type">const</span> QRectF &amp;targetRect,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="type">bool</span> preserveColorContents)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_ASSERT</span>(state.buffer);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> &amp;source = m_sourceList.<span class="built_in">at</span>(sourceIndex);</span><br><span class="line">    QSGRenderer *renderer = <span class="built_in">ensureRenderer</span>(sourceIndex, state.context);</span><br><span class="line">    <span class="keyword">auto</span> wd = QQuickWindowPrivate::<span class="built_in">get</span>(<span class="built_in">window</span>());</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> qreal devicePixelRatio = state.devicePixelRatio;</span><br><span class="line">    state.renderer = renderer;</span><br><span class="line">    state.worldTransform = renderMatrix;</span><br><span class="line">    renderer-&gt;<span class="built_in">setDevicePixelRatio</span>(devicePixelRatio);</span><br><span class="line">    renderer-&gt;<span class="built_in">setDeviceRect</span>(<span class="built_in">QRect</span>(<span class="built_in">QPoint</span>(<span class="number">0</span>, <span class="number">0</span>), state.pixelSize));</span><br><span class="line">    renderer-&gt;<span class="built_in">setRenderTarget</span>(state.sgRenderTarget);</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> viewportRect = <span class="built_in">scaleToRect</span>(targetRect, devicePixelRatio);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> softwareRenderer = <span class="built_in">dynamic_cast</span>&lt;QSGSoftwareRenderer*&gt;(renderer);</span><br><span class="line">    &#123; <span class="comment">// before render</span></span><br><span class="line">        <span class="keyword">if</span> (softwareRenderer) &#123;</span><br><span class="line">            <span class="comment">// because software renderer don&#x27;t supports viewportRect,</span></span><br><span class="line">            <span class="comment">// so use transform to simulation.</span></span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> mapTransform = <span class="built_in">inputMapToOutput</span>(sourceRect, targetRect,</span><br><span class="line">                                                       state.pixelSize, state.devicePixelRatio);</span><br><span class="line">            <span class="keyword">if</span> (!mapTransform.<span class="built_in">isIdentity</span>())</span><br><span class="line">                state.worldTransform = mapTransform * state.worldTransform;</span><br><span class="line">            state.worldTransform.<span class="built_in">optimize</span>();</span><br><span class="line">            <span class="keyword">auto</span> image = <span class="built_in">getImageFrom</span>(state.renderTarget);</span><br><span class="line">            image-&gt;<span class="built_in">setDevicePixelRatio</span>(devicePixelRatio);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Should set to QSGSoftwareRenderer, but it&#x27;s not support specify matrix.</span></span><br><span class="line">            <span class="comment">// If transform is changed, it will full repaint.</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">isRootItem</span>(source.source)) &#123;</span><br><span class="line">                <span class="keyword">auto</span> rootTransform = QQuickItemPrivate::<span class="built_in">get</span>(wd-&gt;contentItem)-&gt;<span class="built_in">itemNode</span>();</span><br><span class="line">                <span class="keyword">if</span> (rootTransform-&gt;<span class="built_in">matrix</span>() != state.worldTransform)</span><br><span class="line">                    rootTransform-&gt;<span class="built_in">setMatrix</span>(state.worldTransform);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">auto</span> t = state.worldTransform.<span class="built_in">toTransform</span>();</span><br><span class="line">                <span class="keyword">if</span> (t.<span class="built_in">type</span>() &gt; QTransform::TxTranslate) &#123;</span><br><span class="line">                    (image-&gt;<span class="keyword">operator</span> QImage &amp;()).<span class="built_in">fill</span>(renderer-&gt;<span class="built_in">clearColor</span>());</span><br><span class="line">                    softwareRenderer-&gt;<span class="built_in">markDirty</span>();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">applyTransform</span>(softwareRenderer, t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            state.worldTransform.<span class="built_in">optimize</span>();</span><br><span class="line"></span><br><span class="line">            <span class="type">bool</span> flipY = wd-&gt;rhi ? !wd-&gt;rhi-&gt;<span class="built_in">isYUpInNDC</span>() : <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (state.renderTarget.<span class="built_in">mirrorVertically</span>())</span><br><span class="line">                flipY = !flipY;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (viewportRect.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">                QRect vr = viewportRect;</span><br><span class="line">                <span class="keyword">if</span> (flipY)</span><br><span class="line">                    vr.<span class="built_in">moveTop</span>(-vr.<span class="built_in">y</span>() + state.pixelSize.<span class="built_in">height</span>() - vr.<span class="built_in">height</span>());</span><br><span class="line">                renderer-&gt;<span class="built_in">setViewportRect</span>(vr);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                renderer-&gt;<span class="built_in">setViewportRect</span>(<span class="built_in">QRect</span>(<span class="built_in">QPoint</span>(<span class="number">0</span>, <span class="number">0</span>), state.pixelSize));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            QRectF rect = sourceRect;</span><br><span class="line">            <span class="keyword">if</span> (!rect.<span class="built_in">isValid</span>())</span><br><span class="line">                rect = <span class="built_in">QRectF</span>(<span class="built_in">QPointF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="built_in">QSizeF</span>(state.pixelSize) / devicePixelRatio);</span><br><span class="line"></span><br><span class="line">            <span class="type">const</span> <span class="type">float</span> left = rect.<span class="built_in">x</span>();</span><br><span class="line">            <span class="type">const</span> <span class="type">float</span> right = rect.<span class="built_in">x</span>() + rect.<span class="built_in">width</span>();</span><br><span class="line">            <span class="type">float</span> bottom = rect.<span class="built_in">y</span>() + rect.<span class="built_in">height</span>();</span><br><span class="line">            <span class="type">float</span> top = rect.<span class="built_in">y</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (flipY)</span><br><span class="line">                std::<span class="built_in">swap</span>(top, bottom);</span><br><span class="line"></span><br><span class="line">            QMatrix4x4 matrix;</span><br><span class="line">            matrix.<span class="built_in">ortho</span>(left, right, bottom, top, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">            QMatrix4x4 projectionMatrix, projectionMatrixWithNativeNDC;</span><br><span class="line">            projectionMatrix = matrix * state.worldTransform;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (wd-&gt;rhi &amp;&amp; !wd-&gt;rhi-&gt;<span class="built_in">isYUpInNDC</span>()) &#123;</span><br><span class="line">                std::<span class="built_in">swap</span>(top, bottom);</span><br><span class="line"></span><br><span class="line">                matrix.<span class="built_in">setToIdentity</span>();</span><br><span class="line">                matrix.<span class="built_in">ortho</span>(left, right, bottom, top, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            projectionMatrixWithNativeNDC = matrix * state.worldTransform;</span><br><span class="line"></span><br><span class="line">            renderer-&gt;<span class="built_in">setProjectionMatrix</span>(projectionMatrix);</span><br><span class="line">            renderer-&gt;<span class="built_in">setProjectionMatrixWithNativeNDC</span>(projectionMatrixWithNativeNDC);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> textureRT = <span class="built_in">static_cast</span>&lt;QRhiTextureRenderTarget*&gt;(state.sgRenderTarget.rt);</span><br><span class="line">            <span class="keyword">if</span> (preserveColorContents) &#123;</span><br><span class="line">                textureRT-&gt;<span class="built_in">setFlags</span>(textureRT-&gt;<span class="built_in">flags</span>() | QRhiTextureRenderTarget::PreserveColorContents);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                textureRT-&gt;<span class="built_in">setFlags</span>(textureRT-&gt;<span class="built_in">flags</span>() &amp; ~QRhiTextureRenderTarget::PreserveColorContents);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    state.context-&gt;<span class="built_in">renderNextFrame</span>(renderer);</span><br><span class="line"></span><br><span class="line">    &#123; <span class="comment">// after render</span></span><br><span class="line">        <span class="keyword">if</span> (!softwareRenderer) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> get damage area from QRhi renderer</span></span><br><span class="line">            m_damageRing.<span class="built_in">add_whole</span>();</span><br><span class="line">            <span class="comment">// ###: maybe Qt bug? Before executing QRhi::endOffscreenFrame, we may</span></span><br><span class="line">            <span class="comment">// use the same QSGRenderer for multiple drawings. This can lead to</span></span><br><span class="line">            <span class="comment">// rendering the same content for different QSGRhiRenderTarget instances</span></span><br><span class="line">            <span class="comment">// when using the RhiGles backend. Additionally, considering that the</span></span><br><span class="line">            <span class="comment">// result of the current drawing may be needed when drawing the next</span></span><br><span class="line">            <span class="comment">// sourceIndex, we should let the RHI (Rendering Hardware Interface)</span></span><br><span class="line">            <span class="comment">// complete the results of this drawing here to ensure the current</span></span><br><span class="line">            <span class="comment">// drawing result is available for use.</span></span><br><span class="line">            wd-&gt;rhi-&gt;<span class="built_in">finish</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">auto</span> currentImage = <span class="built_in">getImageFrom</span>(state.renderTarget);</span><br><span class="line">            <span class="built_in">Q_ASSERT</span>(currentImage &amp;&amp; currentImage == softwareRenderer-&gt;m_rt.paintDevice);</span><br><span class="line">            currentImage-&gt;<span class="built_in">setDevicePixelRatio</span>(<span class="number">1.0</span>);</span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> scaleTF = QTransform::<span class="built_in">fromScale</span>(devicePixelRatio, devicePixelRatio);</span><br><span class="line">            <span class="type">const</span> <span class="keyword">auto</span> scaledFlushRegion = scaleTF.<span class="built_in">map</span>(softwareRenderer-&gt;<span class="built_in">flushRegion</span>());</span><br><span class="line">            PixmanRegion scaledFlushDamage;</span><br><span class="line">            <span class="type">bool</span> ok = WTools::<span class="built_in">toPixmanRegion</span>(scaledFlushRegion, scaledFlushDamage);</span><br><span class="line">            <span class="built_in">Q_ASSERT</span>(ok);</span><br><span class="line"></span><br><span class="line">            &#123;</span><br><span class="line">                PixmanRegion damage;</span><br><span class="line">                m_damageRing.<span class="built_in">get_buffer_damage</span>(state.bufferAge, damage);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (viewportRect.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">                    QRect imageRect = (currentImage-&gt;<span class="keyword">operator</span> <span class="type">const</span> QImage &amp;()).<span class="built_in">rect</span>();</span><br><span class="line">                    <span class="function">QRegion <span class="title">invalidRegion</span><span class="params">(imageRect)</span></span>;</span><br><span class="line">                    invalidRegion -= viewportRect;</span><br><span class="line">                    <span class="keyword">if</span> (!scaledFlushRegion.<span class="built_in">isEmpty</span>())</span><br><span class="line">                        invalidRegion &amp;= scaledFlushRegion;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (!invalidRegion.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">                        <span class="function">QPainter <span class="title">pa</span><span class="params">(currentImage)</span></span>;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> r : std::<span class="built_in">as_const</span>(invalidRegion))</span><br><span class="line">                            pa.<span class="built_in">fillRect</span>(r, softwareRenderer-&gt;<span class="built_in">clearColor</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!damage.<span class="built_in">isEmpty</span>() &amp;&amp; state.lastRT.first != state.buffer &amp;&amp; !state.lastRT.second.<span class="built_in">isNull</span>()) &#123;</span><br><span class="line">                    <span class="keyword">auto</span> image = <span class="built_in">getImageFrom</span>(state.lastRT.second);</span><br><span class="line">                    <span class="built_in">Q_ASSERT</span>(image);</span><br><span class="line">                    <span class="built_in">Q_ASSERT</span>(image-&gt;<span class="built_in">size</span>() == state.pixelSize);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// <span class="doctag">TODO:</span> Don&#x27;t use the previous render target, we can get the damage region of QtQuick</span></span><br><span class="line">                    <span class="comment">// before QQuickRenderControl::render for qw_damage_ring, and add dirty region to</span></span><br><span class="line">                    <span class="comment">// QSGAbstractSoftwareRenderer to force repaint the damage region of current render target.</span></span><br><span class="line">                    <span class="function">QPainter <span class="title">pa</span><span class="params">(currentImage)</span></span>;</span><br><span class="line"></span><br><span class="line">                    PixmanRegion remainderDamage;</span><br><span class="line">                    ok = <span class="built_in">pixman_region32_subtract</span>(remainderDamage, damage, scaledFlushDamage);</span><br><span class="line">                    <span class="built_in">Q_ASSERT</span>(ok);</span><br><span class="line"></span><br><span class="line">                    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">auto</span> rects = <span class="built_in">pixman_region32_rectangles</span>(remainderDamage, &amp;count);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; ++i) &#123;</span><br><span class="line">                        <span class="keyword">auto</span> r = rects[i];</span><br><span class="line">                        pa.<span class="built_in">drawImage</span>(r.x1, r.y1, *image, r.x1, r.y1, r.x2 - r.x1, r.y2 - r.y1);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">isRootItem</span>(source.source))</span><br><span class="line">                <span class="built_in">applyTransform</span>(softwareRenderer, state.worldTransform.<span class="built_in">inverted</span>().<span class="built_in">toTransform</span>());</span><br><span class="line">            m_damageRing.<span class="built_in">add</span>(scaledFlushDamage);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">auto</span> dr = <span class="built_in">qobject_cast</span>&lt;QSGDefaultRenderContext*&gt;(state.context)) &#123;</span><br><span class="line">        QRhiResourceUpdateBatch *resourceUpdates = wd-&gt;rhi-&gt;<span class="built_in">nextResourceUpdateBatch</span>();</span><br><span class="line">        dr-&gt;<span class="built_in">currentFrameCommandBuffer</span>()-&gt;<span class="built_in">resourceUpdate</span>(resourceUpdates);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">shouldCacheBuffer</span>())</span><br><span class="line">        <span class="built_in">wTextureProvider</span>()-&gt;<span class="built_in">setBuffer</span>(state.buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤„ç†å®Œç”»é¢ä»¥åï¼Œå¦‚æœéœ€è¦ä¸Šå±ç”»é¢ï¼Œå°±è°ƒç”¨ commit æŠŠç”»é¢é€åˆ°å±å¹•ä¸Šã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">OutputHelper::commit</span><span class="params">(WBufferRenderer *buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">output</span>()-&gt;<span class="built_in">offscreen</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!buffer || !buffer-&gt;<span class="built_in">currentBuffer</span>()) &#123;</span><br><span class="line">        <span class="built_in">Q_ASSERT</span>(!<span class="keyword">this</span>-&gt;<span class="built_in">buffer</span>());</span><br><span class="line">        <span class="keyword">return</span> WOutputHelper::<span class="built_in">commit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setBuffer</span>(buffer-&gt;<span class="built_in">currentBuffer</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_lastCommitBuffer == buffer) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">pixman_region32_not_empty</span>(&amp;buffer-&gt;<span class="built_in">damageRing</span>()-&gt;<span class="built_in">handle</span>()-&gt;current))</span><br><span class="line">            <span class="built_in">setDamage</span>(&amp;buffer-&gt;<span class="built_in">damageRing</span>()-&gt;<span class="built_in">handle</span>()-&gt;current);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    m_lastCommitBuffer = buffer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> WOutputHelper::<span class="built_in">commit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ç¡¬ä»¶åŠ é€Ÿï¼ˆGPUï¼‰ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ç¡¬ä»¶æ¥åŠ é€Ÿè®¡ç®—è¿‡ç¨‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    state.worldTransform.<span class="built_in">optimize</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> flipY = wd-&gt;rhi ? !wd-&gt;rhi-&gt;<span class="built_in">isYUpInNDC</span>() : <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (state.renderTarget.<span class="built_in">mirrorVertically</span>())</span><br><span class="line">        flipY = !flipY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (viewportRect.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">        QRect vr = viewportRect;</span><br><span class="line">        <span class="keyword">if</span> (flipY)</span><br><span class="line">            vr.<span class="built_in">moveTop</span>(-vr.<span class="built_in">y</span>() + state.pixelSize.<span class="built_in">height</span>() - vr.<span class="built_in">height</span>());</span><br><span class="line">        renderer-&gt;<span class="built_in">setViewportRect</span>(vr);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        renderer-&gt;<span class="built_in">setViewportRect</span>(<span class="built_in">QRect</span>(<span class="built_in">QPoint</span>(<span class="number">0</span>, <span class="number">0</span>), state.pixelSize));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    QRectF rect = sourceRect;</span><br><span class="line">    <span class="keyword">if</span> (!rect.<span class="built_in">isValid</span>())</span><br><span class="line">        rect = <span class="built_in">QRectF</span>(<span class="built_in">QPointF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="built_in">QSizeF</span>(state.pixelSize) / devicePixelRatio);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> left = rect.<span class="built_in">x</span>();</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> right = rect.<span class="built_in">x</span>() + rect.<span class="built_in">width</span>();</span><br><span class="line">    <span class="type">float</span> bottom = rect.<span class="built_in">y</span>() + rect.<span class="built_in">height</span>();</span><br><span class="line">    <span class="type">float</span> top = rect.<span class="built_in">y</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (flipY)</span><br><span class="line">        std::<span class="built_in">swap</span>(top, bottom);</span><br><span class="line"></span><br><span class="line">    QMatrix4x4 matrix;</span><br><span class="line">    matrix.<span class="built_in">ortho</span>(left, right, bottom, top, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">    QMatrix4x4 projectionMatrix, projectionMatrixWithNativeNDC;</span><br><span class="line">    projectionMatrix = matrix * state.worldTransform;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (wd-&gt;rhi &amp;&amp; !wd-&gt;rhi-&gt;<span class="built_in">isYUpInNDC</span>()) &#123;</span><br><span class="line">        std::<span class="built_in">swap</span>(top, bottom);</span><br><span class="line"></span><br><span class="line">        matrix.<span class="built_in">setToIdentity</span>();</span><br><span class="line">        matrix.<span class="built_in">ortho</span>(left, right, bottom, top, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    projectionMatrixWithNativeNDC = matrix * state.worldTransform;</span><br><span class="line"></span><br><span class="line">    renderer-&gt;<span class="built_in">setProjectionMatrix</span>(projectionMatrix);</span><br><span class="line">    renderer-&gt;<span class="built_in">setProjectionMatrixWithNativeNDC</span>(projectionMatrixWithNativeNDC);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> textureRT = <span class="built_in">static_cast</span>&lt;QRhiTextureRenderTarget*&gt;(state.sgRenderTarget.rt);</span><br><span class="line">    <span class="keyword">if</span> (preserveColorContents) &#123;</span><br><span class="line">        textureRT-&gt;<span class="built_in">setFlags</span>(textureRT-&gt;<span class="built_in">flags</span>() | QRhiTextureRenderTarget::PreserveColorContents);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        textureRT-&gt;<span class="built_in">setFlags</span>(textureRT-&gt;<span class="built_in">flags</span>() &amp; ~QRhiTextureRenderTarget::PreserveColorContents);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Surface-æ¸²æŸ“"><a href="#Surface-æ¸²æŸ“" class="headerlink" title="Surface æ¸²æŸ“"></a>Surface æ¸²æŸ“</h2><p>åœ¨ Treeland ä¸­ï¼Œä¸º Surface åˆ›å»ºäº† <code>WSurfaceItem</code>ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªçª—å£ï¼Œå¹¶åˆ›å»ºäº† <code>WSurfaceContent</code> ä½œä¸º <code>WSurfaceItem</code> çš„ delegateã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">WSurfaceItemPrivate::initForDelegate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_Q</span>(WSurfaceItem);</span><br><span class="line"></span><br><span class="line">    std::unique_ptr&lt;QQuickItem&gt; newContentContainer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!delegate) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">getItemContent</span>()) &#123;</span><br><span class="line">            <span class="built_in">Q_ASSERT</span>(!delegateIsDirty);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        delegateIsDirty = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">auto</span> contentItem = <span class="keyword">new</span> <span class="built_in">WSurfaceItemContent</span>(q);</span><br><span class="line">        <span class="keyword">if</span> (surface)</span><br><span class="line">            contentItem-&gt;<span class="built_in">setSurface</span>(surface);</span><br><span class="line">        contentItem-&gt;<span class="built_in">setCacheLastBuffer</span>(!surfaceFlags.<span class="built_in">testFlag</span>(WSurfaceItem::DontCacheLastBuffer));</span><br><span class="line">        contentItem-&gt;<span class="built_in">setSmooth</span>(q-&gt;<span class="built_in">smooth</span>());</span><br><span class="line">        contentItem-&gt;<span class="built_in">setLive</span>(!q-&gt;<span class="built_in">flags</span>().<span class="built_in">testFlag</span>(WSurfaceItem::NonLive));</span><br><span class="line">        QObject::<span class="built_in">connect</span>(q, &amp;WSurfaceItem::smoothChanged, contentItem, &amp;WSurfaceItemContent::setSmooth);</span><br><span class="line">        newContentContainer.<span class="built_in">reset</span>(contentItem);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegateIsDirty) &#123;</span><br><span class="line">        <span class="keyword">auto</span> obj = delegate-&gt;<span class="built_in">createWithInitialProperties</span>(&#123;&#123;<span class="string">&quot;surface&quot;</span>, QVariant::<span class="built_in">fromValue</span>(q)&#125;&#125;, <span class="built_in">qmlContext</span>(q));</span><br><span class="line">        <span class="keyword">if</span> (!obj) &#123;</span><br><span class="line">            <span class="built_in">qWarning</span>() &lt;&lt; <span class="string">&quot;Failed on create surface item from delegate, error mssage:&quot;</span></span><br><span class="line">                       &lt;&lt; delegate-&gt;<span class="built_in">errorString</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        delegateIsDirty = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">auto</span> contentItem = <span class="built_in">qobject_cast</span>&lt;QQuickItem*&gt;(obj);</span><br><span class="line">        <span class="keyword">if</span> (!contentItem)</span><br><span class="line">            <span class="built_in">qFatal</span>() &lt;&lt; <span class="string">&quot;SurfaceItem&#x27;s delegate must is Item&quot;</span>;</span><br><span class="line"></span><br><span class="line">        newContentContainer.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">QQuickItem</span>(q));</span><br><span class="line">        QQmlEngine::<span class="built_in">setObjectOwnership</span>(contentItem, QQmlEngine::CppOwnership);</span><br><span class="line">        contentItem-&gt;<span class="built_in">setParent</span>(newContentContainer.<span class="built_in">get</span>());</span><br><span class="line">        contentItem-&gt;<span class="built_in">setParentItem</span>(newContentContainer.<span class="built_in">get</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!newContentContainer)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    newContentContainer-&gt;<span class="built_in">setZ</span>(<span class="built_in">qreal</span>(WSurfaceItem::ZOrder::ContentItem));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (contentContainer) &#123;</span><br><span class="line">        newContentContainer-&gt;<span class="built_in">setPosition</span>(contentContainer-&gt;<span class="built_in">position</span>());</span><br><span class="line">        newContentContainer-&gt;<span class="built_in">setSize</span>(contentContainer-&gt;<span class="built_in">size</span>());</span><br><span class="line">        newContentContainer-&gt;<span class="built_in">setTransformOrigin</span>(contentContainer-&gt;<span class="built_in">transformOrigin</span>());</span><br><span class="line">        newContentContainer-&gt;<span class="built_in">setScale</span>(contentContainer-&gt;<span class="built_in">scale</span>());</span><br><span class="line"></span><br><span class="line">        contentContainer-&gt;<span class="built_in">disconnect</span>(q);</span><br><span class="line">        contentContainer-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    contentContainer = newContentContainer.<span class="built_in">release</span>();</span><br><span class="line">    <span class="built_in">updateEventItem</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">updateBoundingRect</span>();</span><br><span class="line">    <span class="keyword">if</span> (eventItem)</span><br><span class="line">        <span class="built_in">updateEventItemGeometry</span>();</span><br><span class="line"></span><br><span class="line">    Q_EMIT q-&gt;<span class="built_in">contentItemChanged</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åå½“ <code>WSurfaceItem</code> éœ€è¦æ›´æ–°ç”»é¢æ—¶ï¼Œå°±èƒ½è°ƒç”¨ <code>updatePaintNode</code> æ›´æ–°æ¸²æŸ“ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">QSGNode *<span class="title">WSurfaceItemContent::updatePaintNode</span><span class="params">(QSGNode *oldNode, UpdatePaintNodeData *)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">W_D</span>(WSurfaceItemContent);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> tp = <span class="built_in">wTextureProvider</span>();</span><br><span class="line">    <span class="keyword">if</span> (d-&gt;live || !tp-&gt;<span class="built_in">texture</span>()) &#123;</span><br><span class="line">        <span class="keyword">auto</span> texture = d-&gt;surface ? d-&gt;surface-&gt;<span class="built_in">handle</span>()-&gt;<span class="built_in">get_texture</span>() : <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">if</span> (texture) &#123;</span><br><span class="line">            tp-&gt;<span class="built_in">setTexture</span>(qw_texture::<span class="built_in">from</span>(texture), d-&gt;buffer.<span class="built_in">get</span>());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tp-&gt;<span class="built_in">setBuffer</span>(d-&gt;buffer.<span class="built_in">get</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!tp-&gt;<span class="built_in">texture</span>() || <span class="built_in">width</span>() &lt;= <span class="number">0</span> || <span class="built_in">height</span>() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">delete</span> oldNode;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> node = <span class="built_in">static_cast</span>&lt;QSGImageNode*&gt;(oldNode);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Q_UNLIKELY</span>(!node)) &#123;</span><br><span class="line">        node = <span class="built_in">window</span>()-&gt;<span class="built_in">createImageNode</span>();</span><br><span class="line">        node-&gt;<span class="built_in">setOwnsTexture</span>(<span class="literal">false</span>);</span><br><span class="line">        QSGNode *fpnode = <span class="keyword">new</span> <span class="built_in">WSGRenderFootprintNode</span>(<span class="keyword">this</span>);</span><br><span class="line">        node-&gt;<span class="built_in">appendChildNode</span>(fpnode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> texture = tp-&gt;<span class="built_in">texture</span>();</span><br><span class="line">    node-&gt;<span class="built_in">setTexture</span>(texture);</span><br><span class="line">    <span class="type">const</span> QRectF textureGeometry = d-&gt;bufferSourceBox;</span><br><span class="line">    node-&gt;<span class="built_in">setSourceRect</span>(textureGeometry);</span><br><span class="line">    <span class="function"><span class="type">const</span> QRectF <span class="title">targetGeometry</span><span class="params">(d-&gt;ignoreBufferOffset ? QPointF() : d-&gt;bufferOffset, size())</span></span>;</span><br><span class="line">    node-&gt;<span class="built_in">setRect</span>(targetGeometry);</span><br><span class="line">    node-&gt;<span class="built_in">setFiltering</span>(<span class="built_in">smooth</span>() ? QSGTexture::Linear : QSGTexture::Nearest);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä½¿ç”¨ delegate çš„ç›®çš„æ˜¯ä¸ºäº†èƒ½è®©å¤šä¸ª <code>WSurfaceItem</code> ä½¿ç”¨ç›¸åŒçš„çª—å£ç”»é¢ï¼Œä¾‹å¦‚æŸäº›åœºæ™¯éœ€è¦ä¸´æ—¶åˆ›å»ºä¸€ä¸ªçª—å£çš„åˆ†èº«ï¼Œçª—å£åˆ‡æ¢åˆ—è¡¨ã€å¤šä»»åŠ¡è§†å›¾ç­‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">QSGTextureProvider *<span class="title">WSurfaceItemContent::textureProvider</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (QQuickItem::<span class="built_in">isTextureProvider</span>())</span><br><span class="line">        <span class="keyword">return</span> QQuickItem::<span class="built_in">textureProvider</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">wTextureProvider</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">WSGTextureProvider *<span class="title">WSurfaceItemContent::wTextureProvider</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">W_DC</span>(WSurfaceItemContent);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> w = <span class="built_in">qobject_cast</span>&lt;WOutputRenderWindow*&gt;(d-&gt;window);</span><br><span class="line">    <span class="keyword">if</span> (!w || !d-&gt;<span class="built_in">sceneGraphRenderContext</span>() || QThread::<span class="built_in">currentThread</span>() != d-&gt;<span class="built_in">sceneGraphRenderContext</span>()-&gt;<span class="built_in">thread</span>()) &#123;</span><br><span class="line">        <span class="built_in">qWarning</span>(<span class="string">&quot;WQuickCursor::textureProvider: can only be queried on the rendering thread of an WOutputRenderWindow&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!d-&gt;textureProvider) &#123;</span><br><span class="line">        d-&gt;textureProvider = <span class="keyword">new</span> <span class="built_in">WSGTextureProvider</span>(w);</span><br><span class="line">        <span class="keyword">if</span> (d-&gt;surface) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">auto</span> texture = d-&gt;surface-&gt;<span class="built_in">handle</span>()-&gt;<span class="built_in">get_texture</span>()) &#123;</span><br><span class="line">                d-&gt;textureProvider-&gt;<span class="built_in">setTexture</span>(qw_texture::<span class="built_in">from</span>(texture), d-&gt;buffer.<span class="built_in">get</span>());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                d-&gt;textureProvider-&gt;<span class="built_in">setBuffer</span>(d-&gt;buffer.<span class="built_in">get</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d-&gt;textureProvider;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Treeland ä½¿ç”¨ <code>WQuickTextureProxy</code> åˆ›å»ºçª—å£çš„ä»£ç†æ˜¾ç¤ºï¼Œè€Œå…¶ä¸­å°±æ˜¯è·å– <code>WSurfaceItem</code> çš„ textureProviderã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">QSGTextureProvider *<span class="title">WQuickTextureProxy::textureProvider</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (QQuickItem::<span class="built_in">isTextureProvider</span>())</span><br><span class="line">        <span class="keyword">return</span> QQuickItem::<span class="built_in">textureProvider</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">W_DC</span>(WQuickTextureProxy);</span><br><span class="line">    <span class="keyword">if</span> (!d-&gt;sourceItem)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> d-&gt;sourceItem-&gt;<span class="built_in">textureProvider</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¤šä¸ª proxy å°±å¯ä»¥æ˜¾ç¤ºåŒä¸€ä¸ªçª—å£çš„å†…å®¹ï¼Œæ¯” QML çš„ <code>ShaderEffectSource</code> æ•ˆç‡æ›´é«˜ã€‚</p><h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>ä¸Šè¿°ä»…ä»…æ˜¯ Treeland å®ç° Qt å’Œ wlroots ç¼åˆçš„ä¸€éƒ¨åˆ†æµç¨‹ï¼Œå®é™…ä¸Šå¯¹äº‹ä»¶çš„å¤„ç†å°±ååˆ†å¤æ‚ï¼Œä¸æ­¢é”®ç›˜è¾“å…¥ï¼Œè¿˜éœ€è¦å¤„ç†å…‰æ ‡ã€è§¦æ§ã€è§¦æ‘¸ç­‰å…¶ä»–è®¾å¤‡ã€‚è¿˜æœ‰å…‰æ ‡çš„ç»˜åˆ¶ä¹Ÿéœ€è¦åŒºåˆ†ç¡¬å…‰æ ‡å’Œè½¯å…‰æ ‡ï¼Œæ¸²æŸ“ç”»é¢æ—¶çš„ç¡¬ä»¶åŠ é€ŸåŠè½¯ä»¶å®ç°ç­‰ã€‚</p><p>åç»­å‡†å¤‡å†™ä¸€ä¸‹å…‰æ ‡ç›¸å…³çš„å¤„ç†ï¼Œä»¥åŠè¿˜æ²¡ä»‹ç» Treeland çš„ç”»é¢æ˜¯æ€ä¹ˆç»˜åˆ¶çš„ã€‚</p><h2 id="ç›¸å…³æ–‡æ¡£"><a href="#ç›¸å…³æ–‡æ¡£" class="headerlink" title="ç›¸å…³æ–‡æ¡£"></a>ç›¸å…³æ–‡æ¡£</h2><aside>ğŸ’¡<p>Qt QPA <a href="https://doc.qt.io/qt-6/qpa.html">https://doc.qt.io/qt-6/qpa.html</a><br>QOffscreenSurface <a href="https://doc.qt.io/qt-6/qoffscreensurface.html">https://doc.qt.io/qt-6/qoffscreensurface.html</a></p></aside>]]></content>
    
    
      
      
    <summary type="html">&lt;aside&gt;
ğŸ˜€ Treeland æ˜¯ä¸€ä¸ªåŸºäº wlroots å’Œ Qt çš„ Wayland åˆæˆå™¨
å¹¶ä¸”æ”¯æŒå¤šç”¨æˆ·å…±ç”¨åˆæˆå™¨ã€‚

&lt;/aside&gt;

&lt;h2 id=&quot;åè¯æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#åè¯æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;åè¯æ¦‚å¿µ&quot;&gt;</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.justforlxz.com/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="C++, Wayland, å›¾å½¢å­¦" scheme="https://blog.justforlxz.com/tags/C-Wayland-%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>Treelandï¼šDDE è¿›æ­¥çš„é˜¶æ¢¯</title>
    <link href="https://blog.justforlxz.com/2024/11/01/treeland-go-go-go/"/>
    <id>https://blog.justforlxz.com/2024/11/01/treeland-go-go-go/</id>
    <published>2024-10-31T16:00:00.000Z</published>
    <updated>2024-12-31T07:10:49.685Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h1><p>DDE åœ¨ v15 æ—¶æœŸï¼Œä½¿ç”¨ Mutter ä½œä¸ºå¸¦åˆæˆå™¨çš„çª—ç®¡ï¼Œä»¥åŠ Metacity è¿™ç§ä¸å¸¦åˆæˆå™¨çš„çª—ç®¡ï¼Œä¸€ä¸ªæ˜¯åœ¨é«˜æ€§èƒ½è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œä¸€ä¸ªæ˜¯ä¸ºä½æ€§èƒ½è®¾å¤‡ä¸Šä½¿ç”¨ã€‚</p><p>åœ¨ V20 æ—¶æœŸï¼ŒDDE æ›´æ¢ KWin å½“çª—å£ç®¡ç†å™¨ï¼Œç”±äº KWin è‡ªå¸¦æœ‰å…³é—­åˆæˆå™¨çš„æ¨¡å¼ï¼Œæ‰€ä»¥ DDE ä¹Ÿæ”¾å¼ƒäº† Metacity ä½œä¸ºå¤‡ç”¨çª—ç®¡çš„é€‰é¡¹ã€‚</p><h2 id="Mutter"><a href="#Mutter" class="headerlink" title="Mutter"></a>Mutter</h2><p>Mutter æ˜¯ GNOME å¼€å‘çš„å¸¦æœ‰åˆæˆå™¨åŠŸèƒ½çš„çª—å£ç®¡ç†å™¨ã€‚</p><img src="/2024/11/01/treeland-go-go-go/image.png" class="" title="Mutter"><p>Mutter</p><h2 id="Metacity"><a href="#Metacity" class="headerlink" title="Metacity"></a>Metacity</h2><p>ä¸€ä¸ªä¸å¸¦æœ‰åˆæˆå™¨åŠŸèƒ½çš„çª—å£ç®¡ç†å™¨ã€‚</p><img src="/2024/11/01/treeland-go-go-go/image%201.png" class="" title="Metacity"><p>Metacity</p><h2 id="KWin"><a href="#KWin" class="headerlink" title="KWin"></a>KWin</h2><p>KWin æ˜¯ KDE å¼€å‘çš„ï¼Œå…·æœ‰åŠ¨æ€åˆ‡æ¢æ¸²æŸ“åç«¯ï¼ŒåŠ¨æ€å¼€å…³åˆæˆå™¨åŠŸèƒ½çš„çª—å£ç®¡ç†å™¨ã€‚</p><img src="/2024/11/01/treeland-go-go-go/image%202.png" class="" title="KWin"><p>KWin</p><h1 id="éœ€æ±‚å’ŒæŒ‡æ ‡"><a href="#éœ€æ±‚å’ŒæŒ‡æ ‡" class="headerlink" title="éœ€æ±‚å’ŒæŒ‡æ ‡"></a>éœ€æ±‚å’ŒæŒ‡æ ‡</h1><p>åœ¨ä¸€ä¸ªé¢å‘ç”¨æˆ·çš„äº§å“ä¸­ï¼Œæ‹¥æœ‰å‹å¥½çš„ç•Œé¢æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼Œæ‰€ä»¥è®¾è®¡å¸ˆç»™äº†ä¸€å¤§å †éå¸¸å¥½çœ‹çš„ç•Œé¢äº¤äº’è®¾è®¡ã€‚</p><p>ä½†æ›´å¤šçš„åŠ¨ç”»æ•ˆæœï¼Œä»¥åŠæ›´å¤šçš„ç»„ä»¶äº¤äº’ï¼Œé€šå¸¸å°±è¦æ±‚ä½¿ç”¨æ›´å¤šçš„èµ„æºï¼Œæ›´å¤šçš„å†…å­˜ï¼Œæ›´é«˜çš„åŠŸè€—ã€‚</p><p>è®¾è®¡å¸ˆè¯´è¦åŠ¨ç”»åä¸½ï¼Œè¦åŠ¨ç”»æµç•…ï¼Œè¦ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒã€‚</p><p>æ¶æ„å¸ˆè¯´è¦ä½èµ„æºå ç”¨ï¼Œä½å†…å­˜ï¼Œä¸èƒ½å¡ã€‚</p><p>è™½è¯´ä¸€åˆ‡ç›®æ ‡éƒ½æ˜¯ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œä½†ä¸¤ä¸ªå¤§æŒ‡æ ‡åœ¨å®ç°ä¸Šç«Ÿç„¶æ˜¯å†²çªçš„ï¼Œé‚£ä¹ˆå¦‚ä½•å¹³è¡¡äºŒè€…ï¼Œå°±éœ€è¦ç ”å‘çŒ®ç¥­ä¸€äº›å¤´å‘äº†ã€‚</p><h1 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h1><p>åœ¨Linuxä¸‹ç›®å‰æœ‰ä¸¤ä¸ªæŠ€æœ¯æ ˆï¼Œä¸€ä¸ªæ˜¯å†å²æ‚ ä¹…çš„X11ï¼Œå¦ä¸€ä¸ªæ˜¯è¾ƒæ–°çš„ Waylandã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè·Ÿéšæˆ‘ä¸€èµ·æ¥å¯¹æ¯”ä¸¤ä¸ªæŠ€æœ¯ã€‚</p><h2 id="X11"><a href="#X11" class="headerlink" title="X11"></a>X11</h2><h3 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><p>X11é‡‡ç”¨äº†æ¯”è¾ƒè€çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ã€‚åº”ç”¨ç¨‹åºé€šè¿‡XæœåŠ¡å™¨ä¸ç¡¬ä»¶è®¾å¤‡è¿›è¡Œé€šä¿¡ï¼Œè¿™ç§æ¶æ„éå¸¸çµæ´»ï¼Œæ”¯æŒç½‘ç»œä¼ è¾“ï¼Œä½¿å¾—è¿œç¨‹æ˜¾ç¤ºå˜å¾—å¯èƒ½ã€‚ç„¶è€Œï¼ŒX11åè®®å¤æ‚ä¸”è¿‡æ—¶ï¼Œåœ¨å¾ˆå¤šæ–¹é¢ä¸å†ç¬¦åˆç°ä»£çš„å›¾å½¢éœ€æ±‚ã€‚</p><h3 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="headerlink" title="æ€§èƒ½"></a>æ€§èƒ½</h3><p>ç”±äºå…¶è®¾è®¡è¾ƒè€ï¼ŒX11åœ¨ä¸€äº›ç°ä»£åœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°ä¸ä½³ã€‚å®ƒéœ€è¦ä¾èµ–å¾ˆå¤šæ‰©å±•å’Œè¡¥ä¸æ‰èƒ½å®ç°ç°ä»£å›¾å½¢æ•ˆæœï¼Œä¾‹å¦‚åˆæˆç®¡ç†å™¨ï¼ˆCompositorï¼‰ç­‰ã€‚è¿™äº›å åŠ çš„å¤æ‚æ€§å¯¼è‡´äº†é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚</p><h3 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h3><p>X11çš„å®‰å…¨æ€§é—®é¢˜æ¯”è¾ƒæ˜æ˜¾ï¼Œå› ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½å¯ä»¥è®¿é—®å½¼æ­¤çš„çª—å£ä¿¡æ¯ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªæ¶æ„ç¨‹åºå¯ä»¥è¯»å–æˆ–å¹²æ‰°å…¶ä»–ç¨‹åºçš„è¾“å…¥è¾“å‡ºã€‚è™½ç„¶å¯ä»¥é€šè¿‡ä¸€äº›æ‰©å±•å’Œå·¥å…·åŠ å¼ºå®‰å…¨æ€§ï¼Œä½†è¿™å¹¶ä¸æ˜¯X11çš„è®¾è®¡åˆè¡·ã€‚</p><h3 id="å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§"><a href="#å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§" class="headerlink" title="å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§"></a><strong>å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§</strong></h3><p>ç”±äºå­˜åœ¨äº†å‡ åå¹´ï¼ŒX11æœ‰éå¸¸å¹¿æ³›çš„åº”ç”¨æ”¯æŒå’Œå…¼å®¹æ€§ã€‚è®¸å¤šè€çš„åº”ç”¨ç¨‹åºå’Œæ¡Œé¢ç¯å¢ƒä»ç„¶ä¾èµ–äºX11åè®®ï¼Œå°¤å…¶æ˜¯åœ¨è¿œç¨‹æ¡Œé¢å’ŒæŸäº›ä¸“ä¸šé¢†åŸŸã€‚</p><h3 id="è¾“å…¥è®¾å¤‡æ”¯æŒ"><a href="#è¾“å…¥è®¾å¤‡æ”¯æŒ" class="headerlink" title="è¾“å…¥è®¾å¤‡æ”¯æŒ"></a><strong>è¾“å…¥è®¾å¤‡æ”¯æŒ</strong></h3><p>ç”±äºå…¶å†å²æ‚ ä¹…ï¼ŒX11å¯¹å„ç§è¾“å…¥è®¾å¤‡çš„æ”¯æŒç›¸å½“æˆç†Ÿã€‚ä½†éšç€æ–°ç¡¬ä»¶å’Œæ–°è¾“å…¥æŠ€æœ¯çš„å‡ºç°ï¼ŒX11çš„è®¾è®¡æ˜¾å¾—æœ‰äº›ä¸çµæ´»ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šç‚¹è§¦æ§å’Œæ‰‹åŠ¿æ”¯æŒæ–¹é¢ã€‚</p><h3 id="è¿œç¨‹æ¡Œé¢å’Œç½‘ç»œé€æ˜æ€§"><a href="#è¿œç¨‹æ¡Œé¢å’Œç½‘ç»œé€æ˜æ€§" class="headerlink" title="è¿œç¨‹æ¡Œé¢å’Œç½‘ç»œé€æ˜æ€§"></a><strong>è¿œç¨‹æ¡Œé¢å’Œç½‘ç»œé€æ˜æ€§</strong></h3><p>X11çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯å…¶å¤©ç„¶çš„ç½‘ç»œé€æ˜æ€§ã€‚å®ƒæ”¯æŒé€šè¿‡ç½‘ç»œå°†æ˜¾ç¤ºå†…å®¹è¿œç¨‹ä¼ è¾“ï¼Œè¿™æ˜¯å¾ˆå¤šä¸“ä¸šé¢†åŸŸï¼ˆå¦‚ç§‘å­¦è®¡ç®—ã€æœåŠ¡å™¨ç®¡ç†ï¼‰ä¸­éå¸¸æœ‰ç”¨çš„åŠŸèƒ½ã€‚</p><h2 id="Wayland"><a href="#Wayland" class="headerlink" title="Wayland"></a>Wayland</h2><h3 id="æ¶æ„-1"><a href="#æ¶æ„-1" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><p>Waylandé‡‡ç”¨çš„æ˜¯æ›´ç®€å•çš„è®¾è®¡ï¼Œå»æ‰äº†XæœåŠ¡å™¨çš„å¤æ‚å±‚æ¬¡ã€‚æ¶ˆé™¤äº†å¾ˆå¤šä¸­é—´ç¯èŠ‚ï¼Œæé«˜äº†æ•ˆç‡å’Œå“åº”é€Ÿåº¦ã€‚Waylandä¸“æ³¨äºæœ¬åœ°æ˜¾ç¤ºï¼Œä¸åƒX11é‚£æ ·ç›´æ¥æ”¯æŒè¿œç¨‹æ˜¾ç¤ºã€‚</p><h3 id="æ€§èƒ½-1"><a href="#æ€§èƒ½-1" class="headerlink" title="æ€§èƒ½"></a>æ€§èƒ½</h3><p>Waylandçš„è®¾è®¡æ›´åŠ ç°ä»£åŒ–ï¼Œå®ƒç®€åŒ–äº†æ¸²æŸ“è¿‡ç¨‹ï¼Œå‡å°‘äº†ä¸­é—´å±‚ï¼Œæ€§èƒ½æå‡æ˜¾è‘—ã€‚ç‰¹åˆ«æ˜¯åœ¨åŠ¨ç”»å’Œçª—å£æ“ä½œæ–¹é¢ï¼ŒWaylandé€šå¸¸æ¯”X11æ›´ä¸ºæµç•…ã€‚</p><h3 id="å®‰å…¨æ€§-1"><a href="#å®‰å…¨æ€§-1" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h3><p>Waylandåœ¨è®¾è®¡æ—¶è€ƒè™‘äº†å®‰å…¨æ€§ã€‚åº”ç”¨ç¨‹åºä¹‹é—´çš„éš”ç¦»æ›´å¼ºï¼Œåº”ç”¨ç¨‹åºæ— æ³•è®¿é—®å…¶ä»–ç¨‹åºçš„å›¾åƒæˆ–è¾“å…¥è¾“å‡ºï¼Œè¿™æ˜¾è‘—æé«˜äº†ç³»ç»Ÿçš„æ•´ä½“å®‰å…¨æ€§ã€‚</p><h3 id="å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§-1"><a href="#å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§-1" class="headerlink" title="å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§"></a><strong>å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§</strong></h3><p>å°½ç®¡Waylandé€æ¸è¢«ä¸»æµæ¡Œé¢ç¯å¢ƒï¼ˆå¦‚GNOMEã€KDEç­‰ï¼‰æ”¯æŒï¼Œä½†å…¶åº”ç”¨ç”Ÿæ€ä»ç„¶ä¸å¦‚X11å¹¿æ³›ã€‚åœ¨æŸäº›è€æ—§æˆ–ä¸“ä¸šçš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯èƒ½éœ€è¦é€šè¿‡å…¼å®¹å±‚ï¼ˆå¦‚XWaylandï¼‰æ¥è¿è¡ŒåŸºäºX11çš„åº”ç”¨ç¨‹åºã€‚</p><h3 id="è¾“å…¥è®¾å¤‡æ”¯æŒ-1"><a href="#è¾“å…¥è®¾å¤‡æ”¯æŒ-1" class="headerlink" title="è¾“å…¥è®¾å¤‡æ”¯æŒ"></a><strong>è¾“å…¥è®¾å¤‡æ”¯æŒ</strong></h3><p>Waylandé’ˆå¯¹ç°ä»£ç¡¬ä»¶è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå°¤å…¶æ˜¯åœ¨å¤šç‚¹è§¦æ§ã€è§¦æ‘¸æ¿æ‰‹åŠ¿ç­‰æ–¹é¢æœ‰æ›´å¥½çš„æ”¯æŒã€‚æ­¤å¤–ï¼Œå®ƒå¯¹æ˜¾ç¤ºå™¨çš„DPIç¼©æ”¾ã€åˆ·æ–°ç‡ç­‰ä¹Ÿæœ‰æ›´çµæ´»çš„å¤„ç†ã€‚</p><h3 id="è¿œç¨‹æ¡Œé¢å’Œç½‘ç»œé€æ˜æ€§-1"><a href="#è¿œç¨‹æ¡Œé¢å’Œç½‘ç»œé€æ˜æ€§-1" class="headerlink" title="è¿œç¨‹æ¡Œé¢å’Œç½‘ç»œé€æ˜æ€§"></a><strong>è¿œç¨‹æ¡Œé¢å’Œç½‘ç»œé€æ˜æ€§</strong></h3><p>Waylandé»˜è®¤æ²¡æœ‰X11é‚£æ ·çš„ç½‘ç»œé€æ˜æ€§åŠŸèƒ½ã€‚è¿™æ„å‘³ç€åŸç”Ÿçš„è¿œç¨‹æ¡Œé¢åŠŸèƒ½æ¯”è¾ƒæœ‰é™ï¼Œå°½ç®¡å¯ä»¥é€šè¿‡ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·æˆ–åè®®ï¼ˆå¦‚VNCã€RDPï¼‰å®ç°è¿œç¨‹æ¡Œé¢ï¼Œä½†è¿™ä¸æ˜¯Waylandçš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸‹æ¥ï¼ŒX11å·²ç»è¿›å…¥ç»´æŠ¤é˜¶æ®µï¼Œä¸å†è¿›è¡Œå¤§å¹…æ›´æ–°ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¼€å‘è€…å’Œç¤¾åŒºçš„æ³¨æ„åŠ›é€æ¸è½¬ç§»åˆ°Waylandä¸Šï¼ŒX11å¯èƒ½ä¼šé€æ­¥æ·¡å‡ºä¸»æµæ¡Œé¢ç¯å¢ƒã€‚Waylandæ­£åœ¨é€æ­¥æˆä¸ºLinuxæ¡Œé¢çš„æ ‡å‡†ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„åº”ç”¨ç¨‹åºå’Œæ¡Œé¢ç¯å¢ƒè½¬å‘æ”¯æŒWaylandï¼Œå…¶ç”Ÿæ€ç³»ç»Ÿæ­£åœ¨ä¸æ–­æˆç†Ÿå’Œæ‰©å±•ã€‚</p><h1 id="æ¶æ„è®¾è®¡"><a href="#æ¶æ„è®¾è®¡" class="headerlink" title="æ¶æ„è®¾è®¡"></a>æ¶æ„è®¾è®¡</h1><p>ä»æŠ€æœ¯å±‚é¢ä¸Šï¼Œæˆ‘ä»¬è®¤ä¸ºæ˜¯æ—¶å€™æ›´æ–°æŠ€æœ¯æ–¹æ¡ˆäº†ï¼Œæ›¾ç»çš„X11+çª—å£ç®¡ç†å™¨+åˆæˆå™¨çš„æ¨¡å¼ï¼Œçµæ´»ä½†ä¸æ»¡è¶³éœ€æ±‚ï¼ŒWaylandä»åº•å±‚å°±å°†ä¸‰è€…èåˆåœ¨äº†ä¸€èµ·ï¼Œå¹¶ä¸”æ›´æ–°ç”»é¢æ˜¯ä»¥æ¯å¹…å®Œæ•´çš„ç”»é¢ä½œä¸ºåŸºç¡€çš„ï¼Œè¿™ç¡®ä¿äº†ç”»é¢ä¸ä¼šå› ä¸ºä¸åŒçª—å£æ›´æ–°ç•Œé¢çš„æ—¶æœºä¸ä¸€è‡´å¯¼è‡´ç”»é¢æ’•è£‚ã€‚</p><p>æ›´é‡è¦çš„ä¸€ç‚¹ï¼Œè‡ªç ”çš„çª—å£ç®¡ç†å™¨ï¼Œå®ƒæ˜¯ä»¥å®ç°DDEçš„éœ€æ±‚ä¸ºç›®çš„çš„ï¼Œè¿™æ˜¯ç¬¬ä¸‰æ–¹çª—å£ç®¡ç†å™¨ä¸èƒ½æ¯”æ‹Ÿçš„ã€‚é€šå¸¸ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„é¡¹ç›®æ—¶ï¼Œéƒ½è¦è¿›è¡Œå¤§é‡ç ´åæ€§çš„è°ƒæ•´ï¼Œå¯¼è‡´forkåçš„é¡¹ç›®æ— æ³•å’Œä¸Šæ¸¸åŒæ­¥ï¼Œä¸èƒ½åŠæ—¶è·å–æ›´æ–°å’Œä¿®å¤ï¼Œå¹¶ä¸”ç¬¬ä¸‰æ–¹çš„é¡¹ç›®å·²ç»å‘å±•äº†å¾ˆé•¿æ—¶é—´ï¼Œå†…éƒ¨æœ‰è®¸å¤šDDEç”¨ä¸ä¸Šã€ç”šè‡³å†²çªçš„åŠŸèƒ½ï¼Œéƒ½éœ€è¦è¿›è¡Œå¤§é‡è°ƒæ•´ï¼Œæ›´åŠ å‰§äº†ç»´æŠ¤æˆæœ¬ã€‚</p><p>æ‰€ä»¥ DDE å†³å®šå¼€å‘ä¸€ä¸ªæ–°çš„çª—å£ç®¡ç†å™¨â€”â€”Treelandã€‚</p><p>Treelandåœ¨åº•å±‚ä½¿ç”¨ wlroots ä½œä¸º Wayland çš„åŸºç¡€åº“ï¼Œä¸ä¿®æ”¹ wlroots çš„ä»£ç ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥éšæ—¶åŒæ­¥ä¸Šæ¸¸è¿›åº¦ï¼Œè·å¾—æ–°çš„åŠŸèƒ½ä¸ä¿®å¤ã€‚ä¸Šå±‚ä½¿ç”¨ Qtï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨å…¬å¸å†…å¤§é‡çš„ Qt å¼€å‘è€…ï¼Œä¸å†éœ€è¦ä¸€ç›´æœ‰ä¸“äººè´Ÿè´£ç‰¹å®šé¡¹ç›®ï¼Œè®©DDEçš„æŠ€æœ¯æ ˆæ›´åŠ ç»Ÿä¸€ã€‚</p><img src="/2024/11/01/treeland-go-go-go/image%203.png" class="" title="image.png"><aside><p>è¯¥å›¾æè¿°äº† Treeland åœ¨æ•´ä½“ä¸Šä¼šä½¿ç”¨å“ªäº›é¡¹ç›®æˆ–æ¥å£å®ŒæˆåŠŸèƒ½ã€‚</p></aside><img src="/2024/11/01/treeland-go-go-go/v25-charter-treeland-treeland.drawio-2.png" class="" title="Treeland ç»“æ„å›¾"><p>Treeland ç»“æ„å›¾</p><p>ç®€å•ä»‹ç»ä¸€äº› Treeland é‡Œæ¶‰åŠçš„é‡è¦é¡¹ç›®ã€‚</p><ul><li><p>QWlroots</p><p>  wlroots çš„ Qt ç»‘å®šï¼Œå°† wayland ä¿¡å·è½¬æ¢æˆ Qt é£æ ¼çš„ä¿¡å·ã€‚</p></li><li><p>Waylib</p><p>  å°† wlroots ä¸­çš„ç»„ä»¶å°è£…æˆ QtQuick å¯¹è±¡ï¼Œä½¿ç”¨ QPA ä¸º Treeland æä¾›äº‹ä»¶è½¬æ¢ä¸åˆ†å‘ã€‚</p></li><li><p>DtkDeclarative</p><p>  DTK çš„ QtQuick ç»„ä»¶ï¼Œå°è£…äº†å¤§éƒ¨åˆ† DTK style çš„æ§ä»¶ã€‚</p></li></ul><p>åœ¨ Waylibä¸­ï¼Œä¼šä½¿ç”¨åˆ° Qt çš„ QPA åŠŸèƒ½ï¼Œå°† wlroots ä½œä¸ºä¸€ä¸ªæ–°çš„å¹³å°æ¥å¤„ç†ä¸€éƒ¨åˆ†åŠŸèƒ½ã€‚</p><p>QPA åœ¨ Treeland ä¸­æœ‰ç€ä¸¾è¶³è½»é‡çš„åœ°ä½ï¼Œæ¥è‡ªç³»ç»Ÿåº•å±‚çš„äº‹ä»¶ä¼šå…ˆè¿›å…¥åˆ° Waylibä¸­ï¼Œåœ¨ Waylib é‡Œå°†äº‹ä»¶è½¬æ¢æˆ Qt å†…éƒ¨äº‹ä»¶ï¼Œå‘é€ç»™ä¸Šå±‚ã€‚è¿™æ · Treeland å°±å¯ä»¥åœ¨ QtQuick ä¸­ç¡®å®šç”¨æˆ·çš„ç‚¹å‡»ä½ç½®ã€æŒ‰é”®äº‹ä»¶ç­‰è¡Œä¸ºã€‚å½“ç”¨æˆ·ç‚¹å‡»çš„æ˜¯çª—å£æ—¶ï¼ŒTreeland è¿˜ä¼šé€šè¿‡ Waylib ç”Ÿæˆä¸€ä¸ªäº‹ä»¶ï¼Œé€šè¿‡ seat çš„æ¥å£å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆç•Œé¢äº¤äº’ã€‚</p><img src="/2024/11/01/treeland-go-go-go/waylib.png" class="" title="Treeland å¤„ç†åº•å±‚äº‹ä»¶ä¸ä¸Šå±‚äº‹ä»¶çš„æµç¨‹"><p>Treeland å¤„ç†åº•å±‚äº‹ä»¶ä¸ä¸Šå±‚äº‹ä»¶çš„æµç¨‹</p><h2 id="ç•Œé¢æ•ˆæœä¸ä¼˜åŒ–"><a href="#ç•Œé¢æ•ˆæœä¸ä¼˜åŒ–" class="headerlink" title="ç•Œé¢æ•ˆæœä¸ä¼˜åŒ–"></a>ç•Œé¢æ•ˆæœä¸ä¼˜åŒ–</h2><p>Treeland ä½œä¸ºä¸€ä¸ªçª—å£ç®¡ç†å™¨ï¼Œæœ€é‡è¦çš„åŠŸèƒ½è¿˜æ˜¯å¯¹çª—å£çš„ç®¡ç†åŠæ˜¾ç¤ºæ•ˆæœçš„æ§åˆ¶ï¼ŒTreeland æ‰€æœ‰çš„çª—å£éƒ½å¸¦æœ‰åœ†è§’å’Œé˜´å½±ï¼Œä»¥åŠä¸€äº›çª—å£æ¨¡ç³Šæ•ˆæœã€‚</p><h3 id="åœ†è§’"><a href="#åœ†è§’" class="headerlink" title="åœ†è§’"></a>åœ†è§’</h3><p>DDEåŠdeepinç¤¾åŒºåº”ç”¨éƒ½å¤§é‡é‡‡ç”¨äº†çª—å£åœ†è§’çš„è®¾è®¡ï¼Œç”±åˆæˆå™¨æä¾›åœ†è§’è£å‰ªå¯ä»¥å¸¦æ¥æ›´åŠ ç»Ÿä¸€çš„ç•Œé¢è®¾è®¡ã€‚</p><img src="/2024/11/01/treeland-go-go-go/image%204.png" class="" title="çº¢è‰²ä¸ºQtQuickåœ†è§’&#x2F;é»„è‰²ä¸ºTreelandåœ†è§’"><p>çº¢è‰²ä¸ºQtQuickåœ†è§’&#x2F;é»„è‰²ä¸ºTreelandåœ†è§’</p><p>QtQuick åœ†è§’æ˜¯ç”± Rectangle ç»„ä»¶æä¾›çš„ï¼Œå®ƒåªèƒ½åŒæ—¶å¯¹å››ä¸ªè§’è¿›è¡Œæ“ä½œï¼ˆçº¢è‰²å—ï¼‰ã€‚ä½† DTK ç¨‹åºå…·å¤‡å¼‚å½¢çª—å£çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ Treeland æä¾›äº†è‡ªå·±çš„è£åœ†è§’æ§ä»¶ï¼ˆé»„è‰²å—ï¼‰ã€‚<br>æ–°çš„é€ å‹ç®—æ³•ã€å‡ ä½•é¡¶ç‚¹æ•°é‡æ¯” QtQuick åŸç”Ÿçš„ Rectangle å‡å°‘50%ï¼ŒGPUé¡¶ç‚¹æ¸²æŸ“å’Œä¸‰è§’ç»†åˆ†æ€§èƒ½æå‡100%ã€‚<br>é‡‡ç”¨æ–°çš„æŠ—é”¯é½¿ç®—æ³•ï¼Œæé«˜äº†GPUç‰‡å…ƒç€è‰²å™¨æ€§èƒ½ï¼Œç›¸æ¯”äºæ™®é€š 4xMSAA æŠ—é”¯é½¿ç®—æ³•ï¼Œè®¡ç®—é‡å‡å°‘1&#x2F;4ã€‚</p><h3 id="æ¨¡ç³Š"><a href="#æ¨¡ç³Š" class="headerlink" title="æ¨¡ç³Š"></a>æ¨¡ç³Š</h3><img src="/2024/11/01/treeland-go-go-go/image%205.png" class="" title="QtQuick æ¨¡ç³Šæ§ä»¶"><p>QtQuick æ¨¡ç³Šæ§ä»¶</p><p>QtQuick çš„æ¨¡ç³Šç»„ä»¶ä»…æ”¯æŒå¯¹æ§ä»¶è‡ªèº«è¿›è¡Œæ¨¡ç³Šï¼Œè¿™å¹¶ä¸ç¬¦åˆ Treeland çš„éœ€æ±‚ã€‚</p><img src="/2024/11/01/treeland-go-go-go/image%206.png" class="" title="Treeland æ¨¡ç³Šæ§ä»¶"><p>Treeland æ¨¡ç³Šæ§ä»¶</p><p>Treeland é‡æ–°å®ç°äº†æ¨¡ç³Šç»„ä»¶ï¼Œèƒ½ä»æ˜¾å­˜é‡Œè·å–ç»„ä»¶ä¸‹æ–¹å›¾åƒæ•°æ®ï¼Œå†ä½¿ç”¨èåˆçš„æ¨¡ç³Šç®—æ³•ä¼˜åŒ–æ€§èƒ½ã€‚</p><h3 id="é˜´å½±"><a href="#é˜´å½±" class="headerlink" title="é˜´å½±"></a>é˜´å½±</h3><img src="/2024/11/01/treeland-go-go-go/image%207.png" class="" title="image.png"><p>Qt Quick æœ‰ä¸€ä¸ª BorderImage ç»„ä»¶ï¼Œå®ƒèƒ½ä»¥ä¹å®«æ ¼çš„æ–¹å¼ï¼Œå››ä¸ªè§’ä¿æŒä¸å˜ï¼Œå››è¾¹å’Œä¸­é—´çš„éƒ¨åˆ†æ‹‰ä¼¸ï¼Œæ¥è¾¾åˆ°åœ¨ç»„ä»¶åº•éƒ¨å……å½“è£…é¥°çš„æ•ˆæœã€‚å¹¶é€šè¿‡ ImageProvider çš„æœºåˆ¶ï¼Œæ‰‹åŠ¨æ§åˆ¶å›¾ç‰‡èµ„æºçš„åˆ›å»ºã€‚</p><p>Treeland ä½¿ç”¨ BorderImage ä½œä¸ºçª—å£é˜´å½±è´´å›¾ï¼Œé€šè¿‡ ImageProvider æ‰‹åŠ¨åˆ›å»ºè´´å›¾æè´¨ï¼Œåœ¨ç›¸åŒå¤§å°ä¸‹å¯å¤ç”¨åŒä¸€ä»½æè´¨ã€‚</p><h3 id="åŠ¨ç”»"><a href="#åŠ¨ç”»" class="headerlink" title="åŠ¨ç”»"></a>åŠ¨ç”»</h3><p>Treeland ç›´æ¥ä½¿ç”¨ QtQuick æä¾›çš„åŠ¨ç”»ç»„ä»¶ï¼Œæ¥ä¸ºç•Œé¢æä¾›åŠ¨ç”»æ•ˆæœã€‚</p><p>ä½¿ç”¨ State å’Œ Transition ä¸ºç»„ä»¶å®šä¹‰å±æ€§å˜åŒ–ï¼Œä¾‹å¦‚çª—å£æœ€å¤§åŒ–å’Œè¿˜åŸï¼Œä¸¤ä¸ª State åˆ‡æ¢ä¼šè§¦å‘ä¸åŒçš„ Transition æ‰§è¡Œå±æ€§å˜åŒ–ï¼Œåœ¨å±æ€§å˜åŒ–æ—¶ï¼Œä½¿ç”¨ QtQuick çš„åŠ¨ç”»ç»„ä»¶å®ŒæˆåŠ¨ç”»æ’­æ”¾ã€‚</p><h2 id="å¤šç”¨æˆ·"><a href="#å¤šç”¨æˆ·" class="headerlink" title="å¤šç”¨æˆ·"></a>å¤šç”¨æˆ·</h2><p>Treeland ä½œä¸ºè§£å†³æ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†ï¼Œç›®çš„ä¹‹ä¸€å°±æ˜¯å¤šç”¨æˆ·å…±ç”¨åˆæˆå™¨ã€‚åœ¨ç»å…¸æ¨¡å¼ä¸‹ï¼Œä¸åŒç”¨æˆ·çš„åˆ‡æ¢éœ€è¦åœ¨ tty å±‚é¢å‰ç«¯ç¨‹åºè½¬ç§»æ§åˆ¶æƒï¼Œæ¯ä¸ªç”¨æˆ·ç‹¬å ä¸€ä¸ª tty è¿›è¡Œç”»é¢ä¸Šå±ã€‚ä½†åˆ‡æ¢ttyæ‰€éœ€çš„å·¥ä½œé‡ä¸å°ï¼Œè¿™å¯¼è‡´åˆ‡æ¢æ—¶å±å¹•çš„ç¼“å†²åŒºè¢«ä¸åŒçš„ç¨‹åºè¦†ç›–ï¼Œç»™äººçš„è§‚æ„Ÿå°±æ˜¯å±å¹•é—ªçƒäº†ä¸€ä¸‹ï¼Œç”šè‡³æ˜¯é»‘å±ä¸€ä¼šå„¿ã€‚</p><h3 id="DDM"><a href="#DDM" class="headerlink" title="DDM"></a>DDM</h3><img src="/2024/11/01/treeland-go-go-go/image%208.png" class="" title="image.png"><img src="/2024/11/01/treeland-go-go-go/image%209.png" class="" title="image.png"><p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒLightDMæ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªç”¨æˆ·æ‹¥æœ‰å®Œæ•´çš„ä¸€å¥—è¿›ç¨‹ç»„ï¼Œéƒ½éœ€è¦è¿è¡Œçª—ç®¡ã€ä»»åŠ¡æ ã€æ–‡ä»¶ç®¡ç†å™¨ç­‰ã€‚ä¸åŒçš„ç”¨æˆ·ä¼šå•ç‹¬å ç”¨ä¸€ä¸ª ttyï¼Œé‚£ä¹ˆç”¨æˆ·åˆ‡æ¢æ—¶ï¼Œå¿…ç„¶ä¼´éšç€åº•å±‚ DRM ä»¥åŠæ˜¾å¡é©±åŠ¨ç­‰æ“ä½œçš„åˆ‡æ¢ï¼Œå¸¦æ¥çš„ç»“æœå°±æ˜¯ä¼šçœ‹åˆ°é—ªé»‘å±ï¼Œè€Œä¸”ä¸¤ä¸ªç”¨æˆ·éƒ½è¦è·‘ä¸€ä¸ªé”å±ç•Œé¢æ¥ç»´æŒâ€å‡è£…æ˜¯åŒä¸€ä¸ªç•Œé¢â€œï¼Œä¹Ÿå¸¦æ¥äº†è·¨ç”¨æˆ·è¿›ç¨‹çš„ä¿¡æ¯åŒæ­¥éš¾é¢˜ã€‚</p><p>è€Œ DDM å’Œ Treeland é‡æ–°è®¾è®¡äº†å·¥ä½œæµç¨‹ï¼Œå°† Treeland å•ç‹¬æŠ½ç¦»å‡ºæ¥ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½é€šè¿‡ç›¸åŒçš„ä¸€å¥—æœºåˆ¶å°†çª—å£ç”»é¢å‘é€ç»™ Treelandï¼Œè€Œ Treeland è´Ÿè´£æœ€ç»ˆçš„ç”»é¢åˆæˆä»¥åŠä¸Šå±ã€‚</p><p>å¸¦æ¥çš„å¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œå†…å­˜æ–¹é¢èŠ‚çœäº†çª—ç®¡ã€é”å±ç­‰è¿›ç¨‹ï¼Œåˆ‡æ¢ç”¨æˆ·ä¹Ÿä¸ä¼šæœ‰é»‘å±é—ªçƒï¼ŒçŠ¶æ€ä¹Ÿä¸ç”¨æƒ³åŠæ³•åŒæ­¥äº†ã€‚</p><img src="/2024/11/01/treeland-go-go-go/greeter.png" class="" title="ä¸€ä¸ªç®€åŒ–çš„ DDM ä¸ Treeland çš„å¤šç”¨æˆ·ç™»å½•æµç¨‹"><p>ä¸€ä¸ªç®€åŒ–çš„ DDM ä¸ Treeland çš„å¤šç”¨æˆ·ç™»å½•æµç¨‹</p><h3 id="ä¸-systemd-çš„é›†æˆ"><a href="#ä¸-systemd-çš„é›†æˆ" class="headerlink" title="ä¸ systemd çš„é›†æˆ"></a>ä¸ systemd çš„é›†æˆ</h3><p>DDE çš„æ¯ä¸€ä¸ªç”¨æˆ·ä¼šè¯ï¼Œéƒ½å·²åˆ‡æ¢è‡³ systemd æœåŠ¡ï¼Œè€Œéæ‰€æœ‰è¿›ç¨‹éƒ½æŒ‚è½½åˆ°ä¼šè¯å…¥å£çš„æœåŠ¡ä¸Šã€‚è¿™æ ·åšæœ‰å¾ˆå¤šå¥½å¤„ï¼ŒåŒ…æ‹¬å¿«é€Ÿé‡å¯æ¡Œé¢ç¯å¢ƒï¼Œè€Œéæ³¨é”€å†ç™»å½•ã€‚è¿œç¨‹æ¡Œé¢çš„é“ºå«ï¼Œä¼šè¯çš„å¯åŠ¨ä¸å†å±€é™äºæœ¬åœ°ä¼šè¯ã€‚</p><p>åœ¨ Treeland æ¨¡å¼ä¸‹ï¼ŒDDE ä¼šåŠ è½½ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡ï¼Œç”¨äºä¸ºç”¨æˆ·ä¼šè¯æ³¨å…¥æ˜¾ç¤ºç¯å¢ƒå˜é‡ã€‚è¯¥æœåŠ¡ä½¿ç”¨ systemd æä¾›çš„ socket æœºåˆ¶å®è¡Œæ‡’åŠ è½½ï¼Œå½“ DDE éœ€è¦æ˜¾ç¤ºçª—å£æ—¶ï¼Œå³æ—¶å‘ Treeland æ³¨å†Œï¼Œå®Œæˆç”¨æˆ·æ˜¾ç¤ºæœåŠ¡çš„åˆå§‹åŒ–ã€‚å½“ Treeland å´©æºƒé‡å¯æ—¶ï¼Œè¯¥æœåŠ¡ä¹Ÿä¼šç­‰å¾… Treeland å¯åŠ¨å®Œæˆï¼Œå¹¶å†æ¬¡è¿æ¥å› Treelandï¼Œç¡®ä¿ç”¨æˆ·ä¾§çš„çª—å£èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚</p><img src="/2024/11/01/treeland-go-go-go/treeland.png" class="" title="å¤šç”¨æˆ·ç™»å½•æ—¶çš„åŸºæœ¬æµç¨‹"><p>å¤šç”¨æˆ·ç™»å½•æ—¶çš„åŸºæœ¬æµç¨‹</p><h1 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡ä»‹ç»äº†æ·±åº¦æ“ä½œç³»ç»Ÿï¼ˆDDEï¼‰åœ¨çª—å£ç®¡ç†å™¨æ–¹é¢çš„æ¼”è¿›ï¼Œä»æ—©æœŸä½¿ç”¨Mutterå’ŒMetacityï¼Œåˆ°åæ¥é‡‡ç”¨KWinï¼Œæœ€ç»ˆå†³å®šå¼€å‘è‡ªå·±çš„çª—å£ç®¡ç†å™¨Treelandã€‚TreelandåŸºäºwlrootså’ŒQtæŠ€æœ¯æ ˆï¼Œå®ç°äº†æ›´å¥½çš„æ€§èƒ½å’Œæ›´ç»Ÿä¸€çš„æŠ€æœ¯æ¡†æ¶ã€‚</p><p>æœ¬æ–‡æ¦‚è¿°äº† Treeland çš„æŠ€æœ¯æ¶æ„ã€ç•Œé¢æ•ˆæœä¼˜åŒ–ï¼ˆå¦‚åœ†è§’ã€æ¨¡ç³Šã€é˜´å½±ç­‰ï¼‰ï¼Œä»¥åŠå…¶åœ¨å¤šç”¨æˆ·åœºæ™¯ä¸‹çš„ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº†Treelandä¸systemdçš„é›†æˆï¼Œå±•ç¤ºäº†DDEåœ¨ç³»ç»Ÿæ¶æ„å’Œç”¨æˆ·ä½“éªŒæ–¹é¢çš„æŒç»­åˆ›æ–°å’Œæ”¹è¿›ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å›é¡¾&quot;&gt;&lt;a href=&quot;#å›é¡¾&quot; class=&quot;headerlink&quot; title=&quot;å›é¡¾&quot;&gt;&lt;/a&gt;å›é¡¾&lt;/h1&gt;&lt;p&gt;DDE åœ¨ v15 æ—¶æœŸï¼Œä½¿ç”¨ Mutter ä½œä¸ºå¸¦åˆæˆå™¨çš„çª—ç®¡ï¼Œä»¥åŠ Metacity è¿™ç§ä¸å¸¦åˆæˆå™¨çš„çª—ç®¡ï¼Œä¸€ä¸ªæ˜¯åœ¨é«˜æ€§èƒ½è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œä¸€</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.justforlxz.com/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="C++" scheme="https://blog.justforlxz.com/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>Add macvlan net</title>
    <link href="https://blog.justforlxz.com/2024/04/15/Add-macvlan-net/"/>
    <id>https://blog.justforlxz.com/2024/04/15/Add-macvlan-net/</id>
    <published>2024-04-15T05:10:41.000Z</published>
    <updated>2024-04-15T05:11:47.503Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Script to enable macvlan on boot</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">ExecStartPre=-/usr/bin/bash -c &#x27;mount --make-rshared /&#x27; # for k3s in lxc (optional)</span><br><span class="line">ExecStartPre=-/usr/bin/bash -c &#x27;/usr/bin/ip link del mac0&#x27;</span><br><span class="line">ExecStartPre=/usr/bin/bash -c &#x27;/usr/bin/ip link set eth0 up&#x27;</span><br><span class="line">ExecStartPre=/usr/bin/bash -c &#x27;/usr/bin/ip link add link eth0 mac0 type macvlan mode bridge&#x27;</span><br><span class="line">ExecStartPre=/usr/bin/bash -c &#x27;/usr/bin/ip addr add 192.168.1.11/24 dev mac0&#x27;</span><br><span class="line">ExecStartPre=/usr/bin/bash -c &#x27;/usr/bin/ip link set mac0 up&#x27;</span><br><span class="line">ExecStartPre=-/usr/bin/bash -c &#x27;/usr/bin/ip route add 192.168.1.0/24 dev mac0&#x27;</span><br><span class="line">ExecStartPre=/usr/bin/bash -c &#x27;/usr/bin/ip route add default via 192.168.1.1&#x27;</span><br><span class="line">ExecStartPre=/usr/bin/bash -c &#x27;/usr/bin/ip route add 198.18.0.0/16 via 192.168.1.1&#x27; # for fake ip (optional)</span><br><span class="line">ExecStartPre=/usr/bin/bash -c &#x27;ip rule add to 192.168.1.0/24 priority 2500 lookup main&#x27;</span><br><span class="line">ExecStart=/usr/bin/bash -c &#x27;/usr/bin/echo done&#x27;</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[Unit]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Description=Script t</summary>
      
    
    
    
    
    <category term="k8s" scheme="https://blog.justforlxz.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>solved run k8s in wsl2</title>
    <link href="https://blog.justforlxz.com/2024/03/01/solved-run-k8s-in-wsl2/"/>
    <id>https://blog.justforlxz.com/2024/03/01/solved-run-k8s-in-wsl2/</id>
    <published>2024-03-01T03:30:11.000Z</published>
    <updated>2024-04-15T05:09:55.032Z</updated>
    
    <content type="html"><![CDATA[<p>When I use wsl2 join my k8s cluster, I have some problem. It can be start, but pod is not runing.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Normal   Scheduled               95m                default-scheduler  Successfully assigned longhorn-system/longhorn-csi-plugin-bvnmk to company-wsl-1</span><br><span class="line">Warning  FailedCreatePodSandBox  4m                 kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox &quot;a13a250444d61af44800db054a047059c66202ab9d8a47732748c7c4d380131b&quot;: plugin type=&quot;multus&quot; failed (add): Multus: [longhorn-system/longhorn-csi-plugin-bvnmk/2203cd9f-608d-42b1-82b9-dad186a9b5cb]: error waiting for pod: Get &quot;https://[10.43.0.1]:443/api/v1/namespaces/longhorn-system/pods/longhorn-csi-plugin-bvnmk?timeout=1m0s&quot;: dial tcp 10.43.0.1:443: i/o timeout</span><br><span class="line">Normal   SandboxChanged          2m (x3 over 8m1s)  kubelet            Pod sandbox changed, it will be killed and re-created.</span><br><span class="line">Warning  FailedCreatePodSandBox  2m                 kubelet            Failed to create pod sandbox: rpc error: code = Unknown desc = failed to reserve sandbox name &quot;longhorn-csi-plugin-bvnmk_longhorn-system_2203cd9f-608d-42b1-82b9-dad186a9b5cb_2&quot;: name &quot;longhorn-csi-plugin-bvnmk_longhorn-system_2203cd9f-608d-42b1-82b9-dad186a9b5cb_2&quot; is reserved for &quot;a13a250444d61af44800db054a047059c66202ab9d8a47732748c7c4d380131b&quot;</span><br></pre></td></tr></table></figure><p>Looks like network problem, but when I open journal in wsl2, I see iptables-restore can not runing.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Mar 01 11:26:59 DESKTOP-TH5NA7O k3s[223]: E0301 11:26:59.262472     223 proxier.go:1521] &quot;Failed to execute iptables-restore&quot; err=&lt;</span><br><span class="line">Mar 01 11:26:59 DESKTOP-TH5NA7O k3s[223]:         exit status 2: iptables-restore v1.8.7 (nf_tables): Couldn&#x27;t load match `recent&#x27;:No such file or directory</span><br><span class="line">Mar 01 11:26:59 DESKTOP-TH5NA7O k3s[223]:</span><br><span class="line">Mar 01 11:26:59 DESKTOP-TH5NA7O k3s[223]:         Error occurred at line: 145</span><br><span class="line">Mar 01 11:26:59 DESKTOP-TH5NA7O k3s[223]:         Try `iptables-restore -h&#x27; or &#x27;iptables-restore --help&#x27; for more information.</span><br><span class="line">Mar 01 11:26:59 DESKTOP-TH5NA7O k3s[223]:  &gt;</span><br><span class="line">Mar 01 11:26:59 DESKTOP-TH5NA7O k3s[223]: I0301 11:26:59.262516     223 proxier.go:801] &quot;Sync failed&quot; retryingTime=&quot;30s&quot;</span><br></pre></td></tr></table></figure><p>Now letâ€™s fix!</p><p>build before install depends.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">apt install -y git build-essential flex bison libssl-dev libelf-dev bc dwarves python3</span><br></pre></td></tr></table></figure><ol><li>clone wsl2 kernel code.</li></ol><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone --depth 1 https://github.com/microsoft/WSL2-Linux-Kernel.git &amp;&amp; cd WSL2-Linux-Kernel</span><br></pre></td></tr></table></figure><ol start="2"><li>enable xt_recent.</li></ol><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i &#x27;s/# CONFIG_NETFILTER_XT_MATCH_RECENT is not set/CONFIG_NETFILTER_XT_MATCH_RECENT=y/&#x27; Microsoft/config-wsl</span><br></pre></td></tr></table></figure><ol start="3"><li>build kernel.</li></ol><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make -j2 KCONFIG_CONFIG=Microsoft/config-wsl</span><br></pre></td></tr></table></figure><ol start="4"><li>cp kernel to some path.</li></ol><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp arch/x86/boot/bzImage /mnt/c/Users/&lt;your-user-name&gt;/wsl-kernel</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">5. Create a .wslconfig file in C:\Users\&lt;your-user-name&gt;\</span><br><span class="line"></span><br><span class="line">```text</span><br><span class="line">[wsl2]</span><br><span class="line">kernel=C:\\Users\\&lt;your-user-name&gt;\\wsl-kernel</span><br></pre></td></tr></table></figure><ol start="6"><li>reboot wsl</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">wsl <span class="literal">--shutdown</span></span><br><span class="line"></span><br><span class="line">wsl</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;When I use wsl2 join my k8s cluster, I have some problem. It can be start, but pod is not runing.&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;</summary>
      
    
    
    
    
    <category term="k8s" scheme="https://blog.justforlxz.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>solved Could not find a declaration file for module &#39;vuex&#39;.</title>
    <link href="https://blog.justforlxz.com/2023/09/11/solved-Could-not-find-a-declaration-file-for-module-vuex/"/>
    <id>https://blog.justforlxz.com/2023/09/11/solved-Could-not-find-a-declaration-file-for-module-vuex/</id>
    <published>2023-09-11T02:14:56.000Z</published>
    <updated>2024-04-15T05:09:55.028Z</updated>
    
    <content type="html"><![CDATA[<p>Recently I was rewriting the email client using Vue and encountered an error when using Vuex to process data.</p><p><code>Could not find a declaration file for module &#39;vuex&#39;.</code></p><p>Vuex does not have <code>@types/vuex</code>, so it can only be solved by adding d.ts manually.</p><p>Add vuex.d.ts in the project directory and add the following content:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&quot;vuex&quot;</span> &#123;</span><br><span class="line">   <span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;vuex/types/index.d.ts&quot;</span>;</span><br><span class="line">   <span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;vuex/types/helpers.d.ts&quot;</span>;</span><br><span class="line">   <span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;vuex/types/logger.d.ts&quot;</span>;</span><br><span class="line">   <span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;vuex/types/vue.d.ts&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Recently I was rewriting the email client using Vue and encountered an error when using Vuex to process data.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Could not find</summary>
      
    
    
    
    <category term="Vue" scheme="https://blog.justforlxz.com/categories/Vue/"/>
    
    <category term="Solution" scheme="https://blog.justforlxz.com/categories/Vue/Solution/"/>
    
    
    <category term="vuex" scheme="https://blog.justforlxz.com/tags/vuex/"/>
    
  </entry>
  
  <entry>
    <title>solved react-native error: SDK iphoneos cannot be located</title>
    <link href="https://blog.justforlxz.com/2023/06/29/solved-react-native-error-SDK-iphoneos-cannot-be-located/"/>
    <id>https://blog.justforlxz.com/2023/06/29/solved-react-native-error-SDK-iphoneos-cannot-be-located/</id>
    <published>2023-06-29T01:40:13.000Z</published>
    <updated>2024-04-15T05:09:55.032Z</updated>
    
    <content type="html"><![CDATA[<p>While initializing the project, react native has the following error.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">patching file config.sub</span><br><span class="line">checking <span class="keyword">for</span> a BSD-compatible install... /usr/bin/install -c</span><br><span class="line">checking whether build environment is sane... <span class="built_in">yes</span></span><br><span class="line">checking <span class="keyword">for</span> arm-apple-darwin-strip... no</span><br><span class="line">checking <span class="keyword">for</span> strip... strip</span><br><span class="line">checking <span class="keyword">for</span> a thread-safe <span class="built_in">mkdir</span> -p... ./install-sh -c -d</span><br><span class="line">checking <span class="keyword">for</span> gawk... no</span><br><span class="line">checking <span class="keyword">for</span> mawk... no</span><br><span class="line">checking <span class="keyword">for</span> nawk... no</span><br><span class="line">checking <span class="keyword">for</span> awk... awk</span><br><span class="line">checking whether make sets $(MAKE)... <span class="built_in">yes</span></span><br><span class="line">checking whether make supports nested variables... <span class="built_in">yes</span></span><br><span class="line">checking <span class="keyword">for</span> arm-apple-darwin-gcc... /Library/Developer/CommandLineTools/usr/bin/cc -<span class="built_in">arch</span> arm64 -isysroot</span><br><span class="line">checking whether the C compiler works... no</span><br><span class="line">xcrun: error: SDK <span class="string">&quot;iphoneos&quot;</span> cannot be located</span><br><span class="line">xcrun: error: SDK <span class="string">&quot;iphoneos&quot;</span> cannot be located</span><br><span class="line">xcrun: error: SDK <span class="string">&quot;iphoneos&quot;</span> cannot be located</span><br><span class="line">xcrun: error: unable to lookup item <span class="string">&#x27;Path&#x27;</span> <span class="keyword">in</span> SDK <span class="string">&#x27;iphoneos&#x27;</span></span><br><span class="line">/Users/lxz/Library/Caches/CocoaPods/Pods/External/glog/2263bd123499e5b93b5efe24871be317-04b94/missing: Unknown `--is-lightweight<span class="string">&#x27; option</span></span><br><span class="line"><span class="string">Try `/Users/lxz/Library/Caches/CocoaPods/Pods/External/glog/2263bd123499e5b93b5efe24871be317-04b94/missing --help&#x27;</span> <span class="keyword">for</span> more information</span><br><span class="line">configure: WARNING: <span class="string">&#x27;missing&#x27;</span> script is too old or missing</span><br><span class="line">configure: error: <span class="keyword">in</span> `/Users/lxz/Library/Caches/CocoaPods/Pods/External/glog/2263bd123499e5b93b5efe24871be317-04b94<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">configure: error: C compiler cannot create executables</span></span><br><span class="line"><span class="string">See `config.log&#x27;</span> <span class="keyword">for</span> more details</span><br><span class="line">âœ– Installing CocoaPods dependencies (this may take a few minutes)</span><br><span class="line">error Looks like your iOS environment is not properly <span class="built_in">set</span>. Please go to https://reactnative.dev/docs/environment-setup?os=macos&amp;platform=android and follow the React Native CLI QuickStart guide <span class="keyword">for</span> macOS and iOS.</span><br><span class="line">info Run CLI with --verbose flag <span class="keyword">for</span> more details.</span><br></pre></td></tr></table></figure><p>Notice in the error that &#x2F;Library&#x2F;Developer&#x2F;CommandLineTools&#x2F; is being used, which should use the path of xcode.</p><p>works for me:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> xcode-select --switch /Applications/Xcode.app</span><br></pre></td></tr></table></figure><p>switch to project directory.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ios &amp;&amp; npx pod install &amp;&amp; <span class="built_in">cd</span> .. &amp;&amp; react-native run-ios</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;While initializing the project, react native has the following error.&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre</summary>
      
    
    
    
    <category term="ReactNative" scheme="https://blog.justforlxz.com/categories/ReactNative/"/>
    
    <category term="Solution" scheme="https://blog.justforlxz.com/categories/ReactNative/Solution/"/>
    
    
    <category term="reactnative" scheme="https://blog.justforlxz.com/tags/reactnative/"/>
    
    <category term="ios" scheme="https://blog.justforlxz.com/tags/ios/"/>
    
  </entry>
  
  <entry>
    <title>å¼€å‘ä¸€ä¸ª KWin ç‰¹æ•ˆæ’ä»¶</title>
    <link href="https://blog.justforlxz.com/2023/06/25/How-to-develop-a-kwin-special-effects-plugin/"/>
    <id>https://blog.justforlxz.com/2023/06/25/How-to-develop-a-kwin-special-effects-plugin/</id>
    <published>2023-06-25T05:25:55.000Z</published>
    <updated>2024-04-15T05:09:54.914Z</updated>
    
    <content type="html"><![CDATA[<p>KWin æ˜¯ KDE å¼€å‘çš„çª—å£ç®¡ç†å™¨ï¼Œæä¾›äº†éå¸¸ä¸°å¯Œçš„æ’ä»¶ï¼Œå¯ä»¥å¯¹åŠŸèƒ½è¿›è¡Œå¤§é‡çš„å®šåˆ¶ã€‚</p><p>æœ¬ç¯‡æ–‡ç« æ˜¯å¯¹çª—å£ç‰¹æ•ˆæ’ä»¶çš„å¼€å‘ä»‹ç»ã€‚</p><h2 id="æ’ä»¶å¼€å‘"><a href="#æ’ä»¶å¼€å‘" class="headerlink" title="æ’ä»¶å¼€å‘"></a>æ’ä»¶å¼€å‘</h2><h3 id="æ’ä»¶å®šä¹‰"><a href="#æ’ä»¶å®šä¹‰" class="headerlink" title="æ’ä»¶å®šä¹‰"></a>æ’ä»¶å®šä¹‰</h3><p>KWin çš„æ’ä»¶é€šå¸¸å¯ä»¥ä½¿ç”¨ä¸€äº›å®è¾…åŠ©ç”Ÿæˆä»£ç ï¼Œä¾‹å¦‚ä½¿ç”¨ <code>KPluginFactory</code> è¿›è¡Œæ’ä»¶çš„å®šä¹‰ï¼Œå†…å®¹æ˜¯ç”¨æ¥ç”Ÿæˆæ’ä»¶çš„å…¥å£ç±»ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> EffectPluginFactory_iid <span class="string">&quot;org.kde.kwin.EffectPluginFactory&quot;</span> KWIN_PLUGIN_VERSION_STRING</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KWIN_PLUGIN_FACTORY_NAME KPLUGINFACTORY_PLUGIN_CLASS_INTERNAL_NAME</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KWIN_EFFECT_FACTORY_SUPPORTED_ENABLED(className, jsonFile, supported, enabled ) \</span></span><br><span class="line"><span class="meta">    class KWIN_PLUGIN_FACTORY_NAME : public KWin::EffectPluginFactory \</span></span><br><span class="line"><span class="meta">    &#123; \</span></span><br><span class="line"><span class="meta">        Q_OBJECT \</span></span><br><span class="line"><span class="meta">        Q_PLUGIN_METADATA(IID EffectPluginFactory_iid FILE jsonFile) \</span></span><br><span class="line"><span class="meta">        Q_INTERFACES(KPluginFactory) \</span></span><br><span class="line"><span class="meta">    public: \</span></span><br><span class="line"><span class="meta">        explicit KWIN_PLUGIN_FACTORY_NAME() &#123;&#125; \</span></span><br><span class="line"><span class="meta">        ~KWIN_PLUGIN_FACTORY_NAME() &#123;&#125; \</span></span><br><span class="line"><span class="meta">        bool isSupported() const override &#123; \</span></span><br><span class="line"><span class="meta">            supported \</span></span><br><span class="line"><span class="meta">        &#125; \</span></span><br><span class="line"><span class="meta">        bool enabledByDefault() const override &#123; \</span></span><br><span class="line"><span class="meta">            enabled \</span></span><br><span class="line"><span class="meta">        &#125; \</span></span><br><span class="line"><span class="meta">        KWin::Effect *createEffect() const override &#123; \</span></span><br><span class="line"><span class="meta">            return new className(); \</span></span><br><span class="line"><span class="meta">        &#125; \</span></span><br><span class="line"><span class="meta">    &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KWIN_EFFECT_FACTORY_ENABLED(className, jsonFile, enabled ) \</span></span><br><span class="line"><span class="meta">    KWIN_EFFECT_FACTORY_SUPPORTED_ENABLED(className, jsonFile, return true;, enabled )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KWIN_EFFECT_FACTORY_SUPPORTED(className, jsonFile, supported ) \</span></span><br><span class="line"><span class="meta">    KWIN_EFFECT_FACTORY_SUPPORTED_ENABLED(className, jsonFile, supported, return true; )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KWIN_EFFECT_FACTORY(className, jsonFile ) \</span></span><br><span class="line"><span class="meta">    KWIN_EFFECT_FACTORY_SUPPORTED_ENABLED(className, jsonFile, return true;, return true; )</span></span><br></pre></td></tr></table></figure><p>å¤§éƒ¨åˆ†å®åªæ˜¯ä¸ºäº†æ–¹ä¾¿ç»“æ„ä¿®æ”¹ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <code>K_PLUGIN_FACTORY</code> è¿›è¡Œæ’ä»¶å®šä¹‰å³å¯ã€‚</p><p>å‡è®¾æˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ªæ’ä»¶ï¼Œåå­—å« demoï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ main.cpp ä¸­ä½¿ç”¨ <code>KWIN_EFFECT_FACTORY_SUPPORTED</code> å®šä¹‰</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">KWIN_EFFECT_FACTORY_SUPPORTED</span>(</span><br><span class="line">    Demo,</span><br><span class="line">    <span class="string">&quot;metadata.json&quot;</span>,</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä»£ç å±•å¼€åæ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">KPLUGINFACTORY_PLUGIN_CLASS_INTERNAL_NAME</span> : <span class="keyword">public</span> KWin::EffectPluginFactory \</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Q_OBJECT</span></span><br><span class="line"><span class="function">    <span class="title">Q_PLUGIN_METADATA</span><span class="params">(IID EffectPluginFactory_iid FILE <span class="string">&quot;metadata.json&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">Q_INTERFACES</span><span class="params">(KPluginFactory)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span>: \</span></span><br><span class="line"><span class="function">    explicit KPLUGINFACTORY_PLUGIN_CLASS_INTERNAL_NAME() &#123;</span>&#125;</span><br><span class="line">    ~<span class="built_in">KPLUGINFACTORY_PLUGIN_CLASS_INTERNAL_NAME</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isSupported</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">enabledByDefault</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">KWin::Effect *<span class="title">createEffect</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Demo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å® <code>KWIN_EFFECT_FACTORY_SUPPORTED</code> åªæ˜¯ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†å·¥å‚å‡½æ•°ï¼Œè¾…åŠ©ç”Ÿæˆäº†ä¸€äº›å¿…è¦çš„é‡è½½ã€‚</p><p><code>metadata.json</code> æ–‡ä»¶æ˜¯ç”¨æ¥ä½œä¸ºæ’ä»¶çš„æè¿°ä¿¡æ¯ä½¿ç”¨çš„ã€‚</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;KPlugin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;Category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Accessibility&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Allow clip of window content&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;EnabledByDefault&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;scissor&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;License&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GPL&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ScissorWindow&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Name[zh_CN]&quot;</span><span class="punctuation">:</span> <span class="string">&quot;çª—å£åœ†è§’&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;org.kde.kwin.effect&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enabledByDefaultMethod&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç‰¹æ•ˆæ’ä»¶"><a href="#ç‰¹æ•ˆæ’ä»¶" class="headerlink" title="ç‰¹æ•ˆæ’ä»¶"></a>ç‰¹æ•ˆæ’ä»¶</h3><p>ç‰¹æ•ˆæ’ä»¶æ˜¯ä¸€ç±»å¯ä»¥æ”¹å˜çª—å£ç”»é¢çš„æ’ä»¶ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨æ’ä»¶é‡Œå¯¹çª—å£è¿›è¡Œè´´å›¾ã€å˜å½¢å’Œè£åˆ‡ï¼Œåœ¨ DDE ä¸­ï¼Œå°±ä½¿ç”¨ç‰¹æ•ˆæ’ä»¶å®Œæˆäº†åœ†è§’è£åˆ‡å’Œçª—å£æ¨¡ç³Šã€‚</p><p>è¿™é‡Œä½¿ç”¨åœ†è§’è£åˆ‡æ’ä»¶ä½œä¸ºä¾‹å­ï¼Œé¦–å…ˆä½¿ç”¨ <code>KWIN_EFFECT_FACTORY_SUPPORTED</code> å®å¯¹æ’ä»¶è¿›è¡Œå®šä¹‰ï¼Œ <code>KWIN_EFFECT_FACTORY_SUPPORTED</code> æ¥å—ä¸€ä¸ª class ä½œä¸ºè¿”å›çš„æ¥å£ç±»ï¼Œå®ƒéœ€è¦ç»§æ‰¿è‡ª <code>Effect</code>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…ƒä¿¡æ¯çš„ json æ–‡ä»¶ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¿”å›æ˜¯å¦æ”¯æŒï¼Œåœ¨å¯ç”¨æ’ä»¶æ—¶å¯å¯¹å½“å‰ç¯å¢ƒè¿›è¡Œåˆ¤æ–­ï¼Œä¾‹å¦‚æ’ä»¶éœ€è¦ä½¿ç”¨ <code>OpenGL</code> å¯¹å›¾å½¢è¿›è¡Œä¸€äº›æ“ä½œï¼Œä½†æ˜¯å½“å‰ç¯å¢ƒä¸æ”¯æŒ <code>OpenGL</code>ï¼Œé‚£ä¹ˆæ’ä»¶å°±ä¸ä¼šå¯ç”¨ã€‚</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">#include <span class="string">&quot;scissorwindow.h&quot;</span></span><br><span class="line"></span><br><span class="line">namespace KWin</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">KWIN_EFFECT_FACTORY_SUPPORTED(ScissorWindow<span class="punctuation">,</span></span><br><span class="line">                              <span class="string">&quot;metadata.json.stripped&quot;</span><span class="punctuation">,</span></span><br><span class="line">                              return ScissorWindow<span class="punctuation">:</span><span class="punctuation">:</span>supported();)</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span> <span class="comment">// namespace KWin</span></span><br><span class="line"></span><br><span class="line">#include <span class="string">&quot;main.moc&quot;</span></span><br></pre></td></tr></table></figure><p>åœ¨ Effect ç±»ä¸­æœ‰å‡ ä¸ªä¸åŒé˜¶æ®µçš„æ–¹æ³•å¯ä»¥é‡è½½ã€‚</p><ul><li>prePaintScreen<ul><li>è®¾ç½®æ˜¯å¦å˜æ¢çª—å£æˆ–æ•´ä¸ªå±å¹•</li><li>æ›´æ”¹å°†è¦ç»˜åˆ¶çš„å±å¹•åŒºåŸŸ</li><li>åšå„ç§å†…åŠ¡å¤„ç†ä»»åŠ¡ï¼Œæ¯”å¦‚åˆå§‹åŒ–ä½ çš„æ•ˆæœå˜é‡<br>  ç”¨äºå³å°†åˆ°æ¥çš„ç»˜ç”»è¿‡ç¨‹æˆ–æ›´æ–°åŠ¨ç”»çš„è¿›åº¦</li></ul></li><li>paintScreen<ul><li>åœ¨çª—å£ä¸Šç”»ä¸œè¥¿ï¼ˆè°ƒç”¨åç”» effect-&gt;paintScreen())</li><li>ç»˜åˆ¶å¤šä¸ªæ¡Œé¢å’Œ&#x2F;æˆ–åŒä¸€æ¡Œé¢çš„å¤šä¸ªå‰¯æœ¬</li></ul></li><li>postPaintScreen<ul><li>åœ¨åŠ¨ç”»çš„æƒ…å†µä¸‹å®‰æ’ä¸‹ä¸€æ¬¡é‡ç»˜ï¼Œä¸åº”è¯¥åœ¨è¿™é‡Œç”»ä»»ä½•ä¸œè¥¿ã€‚</li></ul></li><li>prePaintWindow<ul><li>å¯ç”¨æˆ–ç¦ç”¨çª—å£çš„ç»˜åˆ¶ï¼ˆä¾‹å¦‚å¯ç”¨æœ€å°åŒ–çª—å£çš„ç»˜åˆ¶ï¼‰</li><li>å°†çª—å£è®¾ç½®ä¸ºåŠé€æ˜</li><li>è®¾ç½®è¦è½¬æ¢çš„çª—å£</li><li>è¯·æ±‚å°†çª—å£åˆ†æˆå¤šä¸ªéƒ¨åˆ†</li></ul></li><li>paintWindow<ul><li>åšå„ç§è½¬æ¢</li><li>æ”¹å˜çª—å£çš„ä¸é€æ˜åº¦</li><li>æ”¹å˜äº®åº¦å’Œ&#x2F;æˆ–é¥±å’Œåº¦ï¼Œå¦‚æœæ”¯æŒçš„è¯</li></ul></li><li>postPaintWindow<ul><li>åœ¨åŠ¨ç”»çš„æƒ…å†µä¸‹ä¸ºå•ä¸ªçª—å£å®‰æ’ä¸‹ä¸€æ¬¡é‡ç»˜<br>  ä¸åº”è¯¥åœ¨è¿™é‡Œç”»ä»»ä½•ä¸œè¥¿ã€‚</li></ul></li><li>paintEffectFrame<ul><li>åœ¨ç»˜åˆ¶ EffectFrame ä¹‹å‰ç›´æ¥è°ƒç”¨æ­¤æ–¹æ³•ã€‚</li><li>å¦‚æœéœ€è¦ç»‘å®šshaderæˆ–è€…æ‰§è¡Œï¼Œå¯ä»¥å®ç°è¿™ä¸ªæ–¹æ³•å¸§æ¸²æŸ“å‰çš„å…¶ä»–æ“ä½œã€‚</li></ul></li><li>drawWindow<ul><li>å¯ä»¥è°ƒç”¨ä»¥ç»˜åˆ¶ä¸€ä¸ªçª—å£çš„å¤šä¸ªå‰¯æœ¬ï¼ˆä¾‹å¦‚ç¼©ç•¥å›¾ï¼‰ã€‚</li><li>å¯ä»¥åœ¨è¿™é‡Œæ”¹å˜çª—å£çš„ä¸é€æ˜åº¦&#x2F;äº®åº¦&#x2F;ç­‰ï¼Œä½†ä¸èƒ½åšä»»ä½•è½¬æ¢ã€‚</li><li>åœ¨åŸºäº OpenGL çš„åˆæˆä¸­ï¼Œæ¡†æ¶ç¡®ä¿ä¸Šä¸‹æ–‡æ˜¯æœ€æ–°çš„</li></ul></li></ul><p>åœ¨æ–¹æ³•åç§°ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨åœºæ™¯åŠçª—å£ç»˜åˆ¶çš„è¿‡ç¨‹ä¸­ï¼Œåˆ†åˆ«å¯ä»¥åœ¨å®é™…ç»˜åˆ¶çš„å‰ååˆ†åˆ«æ‰§è¡Œä¸€äº›åŠ¨ä½œï¼Œåœ†è§’æ’ä»¶å°±æ˜¯åœ¨ <code>drawWindow</code> å‡½æ•°ä¸­ï¼Œä½¿ç”¨ <code>OpenGL</code> å¯¹çª—å£ä½¿ç”¨ç€è‰²å™¨è¿›è¡Œçª—å£è£åˆ‡ï¼Œå¹¶ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚</p><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ScissorWindow::drawWindow</span><span class="params">(EffectWindow *w, <span class="type">int</span> mask, <span class="type">const</span> QRegion&amp; region, WindowPaintData &amp;data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (w-&gt;<span class="built_in">isDesktop</span>() || <span class="built_in">isMaximized</span>(w)) &#123;</span><br><span class="line">        <span class="keyword">return</span> effects-&gt;<span class="built_in">drawWindow</span>(w, mask, region, data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    QPointF cornerRadius;</span><br><span class="line">    <span class="type">const</span> QVariant valueRadius = w-&gt;<span class="built_in">data</span>(WindowRadiusRole);</span><br><span class="line">    <span class="keyword">if</span> (valueRadius.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">        cornerRadius = w-&gt;<span class="built_in">data</span>(WindowRadiusRole).<span class="built_in">toPointF</span>();</span><br><span class="line">        <span class="type">const</span> qreal xMin&#123; std::<span class="built_in">min</span>(cornerRadius.<span class="built_in">x</span>(), w-&gt;<span class="built_in">width</span>() / <span class="number">2.0</span>) &#125;;</span><br><span class="line">        <span class="type">const</span> qreal yMin&#123; std::<span class="built_in">min</span>(cornerRadius.<span class="built_in">y</span>(), w-&gt;<span class="built_in">height</span>() / <span class="number">2.0</span>) &#125;;</span><br><span class="line">        <span class="type">const</span> qreal minRadius&#123; std::<span class="built_in">min</span>(xMin, yMin) &#125;;</span><br><span class="line">        cornerRadius = <span class="built_in">QPointF</span>(minRadius, minRadius);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cornerRadius.<span class="built_in">x</span>() &lt; <span class="number">2</span> &amp;&amp; cornerRadius.<span class="built_in">y</span>() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> effects-&gt;<span class="built_in">drawWindow</span>(w, mask, region, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> QString&amp; key = <span class="built_in">QString</span>(<span class="string">&quot;%1+%2&quot;</span>).<span class="built_in">arg</span>(cornerRadius.<span class="built_in">toPoint</span>().<span class="built_in">x</span>()).<span class="built_in">arg</span>(cornerRadius.<span class="built_in">toPoint</span>().<span class="built_in">y</span>()</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (!m_texMaskMap.<span class="built_in">count</span>(key)) &#123;</span><br><span class="line"><span class="function">QImage <span class="title">img</span><span class="params">(QSize(radius.x() * <span class="number">2</span>, radius.y() * <span class="number">2</span>), QImage::Format_RGBA8888)</span></span>;</span><br><span class="line">    img.<span class="built_in">fill</span>(<span class="built_in">QColor</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(&amp;img)</span></span>;</span><br><span class="line">    painter.<span class="built_in">setPen</span>(Qt::NoPen);</span><br><span class="line">    painter.<span class="built_in">setBrush</span>(<span class="built_in">QColor</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>));</span><br><span class="line">    painter.<span class="built_in">setRenderHint</span>(QPainter::Antialiasing);</span><br><span class="line">    painter.<span class="built_in">drawEllipse</span>(<span class="number">0</span>, <span class="number">0</span>, radius.<span class="built_in">x</span>() * <span class="number">2</span>, radius.<span class="built_in">y</span>() * <span class="number">2</span>);</span><br><span class="line">    painter.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line">    m_texMaskMap[key] = <span class="keyword">new</span> <span class="built_in">GLTexture</span>(img.<span class="built_in">copy</span>(<span class="number">0</span>, <span class="number">0</span>, radius.<span class="built_in">x</span>(), radius.<span class="built_in">y</span>()));</span><br><span class="line">    m_texMaskMap[key]-&gt;<span class="built_in">setFilter</span>(GL_LINEAR);</span><br><span class="line">    m_texMaskMap[key]-&gt;<span class="built_in">setWrapMode</span>(GL_CLAMP_TO_EDGE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ShaderManager::<span class="built_in">instance</span>()-&gt;<span class="built_in">pushShader</span>(m_filletOptimizeShader);</span><br><span class="line">    m_filletOptimizeShader-&gt;<span class="built_in">setUniform</span>(<span class="string">&quot;typ1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    m_filletOptimizeShader-&gt;<span class="built_in">setUniform</span>(<span class="string">&quot;sampler&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    m_filletOptimizeShader-&gt;<span class="built_in">setUniform</span>(<span class="string">&quot;msk1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    m_filletOptimizeShader-&gt;<span class="built_in">setUniform</span>(<span class="string">&quot;k&quot;</span>, <span class="built_in">QVector2D</span>(w-&gt;<span class="built_in">width</span>() / cornerRadius.<span class="built_in">x</span>(), w-&gt;<span class="built_in">height</span>() / cornerRadius.<span class="built_in">y</span>()));</span><br><span class="line">    <span class="keyword">if</span> (w-&gt;<span class="built_in">hasDecoration</span>()) &#123;</span><br><span class="line">        m_filletOptimizeShader-&gt;<span class="built_in">setUniform</span>(<span class="string">&quot;typ2&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        m_filletOptimizeShader-&gt;<span class="built_in">setUniform</span>(<span class="string">&quot;typ2&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">auto</span> old_shader = data.shader;</span><br><span class="line">    data.shader = m_filletOptimizeShader;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE1);</span><br><span class="line">    m_texMaskMap[key]-&gt;<span class="built_in">bind</span>();</span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">    effects-&gt;<span class="built_in">drawWindow</span>(w, mask, region, data);</span><br><span class="line">    ShaderManager::<span class="built_in">instance</span>()-&gt;<span class="built_in">popShader</span>();</span><br><span class="line">    data.shader = old_shader;</span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE1);</span><br><span class="line">    m_texMaskMap[key]-&gt;<span class="built_in">unbind</span>();</span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœçª—å£æ˜¯æ¡Œé¢ç±»å‹ï¼Œæˆ–è€…å·²ç»æœ€å¤§åŒ–äº†ï¼Œåˆ™æ— éœ€å¤„ç†ï¼Œç›´æ¥è¿”å› Effect åŸæœ¬çš„å¤„ç†å‡½æ•°ã€‚</p><p>ä¹‹åå°è¯•ä»çª—å£å±æ€§ä¸­å–å‡ºåœ†è§’å¤§å°çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åœ†è§’å¤§å°ï¼Œæˆ–è€…å€¼å°äº2ï¼Œåˆ™æ— éœ€å¤„ç†ã€‚</p><p>å°è¯•æŸ¥è¯¢ç¼“å­˜ï¼Œåœ¨è¿™é‡Œä¸ºçª—å£çš„å››ä¸ªè§’æ„å»ºä¸€ä»½é®ç½©å¯¹è±¡å¹¶ç¼“å­˜ï¼Œä½¿ç”¨ <code>OpenGL</code> å°†é®ç½©å’Œç€è‰²å™¨è¿›è¡Œå…³è”ï¼Œæ¿€æ´»ä¸¤ä¸ªæè´¨åˆ†åˆ«ç»˜åˆ¶çª—å£å†…å®¹å’Œå››ä¸ªè§’çš„é®ç½©ï¼Œåœ¨ç€è‰²å™¨ä¸­å®Œæˆçª—å£åœ†è§’çš„åŠé€æ˜æ•ˆæœã€‚</p><p>é™äºç¯‡å¹…ï¼Œæœ¬æ–‡ä¸å±•å¼€ä»‹ç»å¦‚ä½•å®ç°åœ†è§’æ’ä»¶çš„å…¨éƒ¨å®ç°è¿‡ç¨‹ï¼Œä»…æŒ‘é€‰å…³é”®æ­¥éª¤ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å°†åŠ¨æ€åº“å¤åˆ¶åˆ° <code>/usr/share/kwin/effects/plugins</code> ï¼Œå¹¶ä½¿ç”¨ <code>DBus</code> æ¿€æ´»æ’ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qdbus --literal org.kde.KWin /Effects org.kde.kwin.Effects.loadEffect scissor</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;KWin æ˜¯ KDE å¼€å‘çš„çª—å£ç®¡ç†å™¨ï¼Œæä¾›äº†éå¸¸ä¸°å¯Œçš„æ’ä»¶ï¼Œå¯ä»¥å¯¹åŠŸèƒ½è¿›è¡Œå¤§é‡çš„å®šåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡æ–‡ç« æ˜¯å¯¹çª—å£ç‰¹æ•ˆæ’ä»¶çš„å¼€å‘ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ’ä»¶å¼€å‘&quot;&gt;&lt;a href=&quot;#æ’ä»¶å¼€å‘&quot; class=&quot;headerlink&quot; title=&quot;æ’ä»¶å¼€å‘&quot;&gt;</summary>
      
    
    
    
    <category term="deepin" scheme="https://blog.justforlxz.com/categories/deepin/"/>
    
    
    <category term="deepin" scheme="https://blog.justforlxz.com/tags/deepin/"/>
    
    <category term="kwin" scheme="https://blog.justforlxz.com/tags/kwin/"/>
    
  </entry>
  
  <entry>
    <title>How to count the cpu usage of a process</title>
    <link href="https://blog.justforlxz.com/2023/05/24/How-to-count-the-cpu-usage-of-a-process/"/>
    <id>https://blog.justforlxz.com/2023/05/24/How-to-count-the-cpu-usage-of-a-process/</id>
    <published>2023-05-24T02:43:04.000Z</published>
    <updated>2024-04-15T05:09:54.913Z</updated>
    
    <content type="html"><![CDATA[<p>Sometimes we want to collect the cpu usage of the process, and usually use a script to make simple statistics.</p><p>Under Linux, the cpu time slice of the process can be obtained through the stat provided by procfs.</p><p>Or simply use some commands to get directly.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">FULL_PATH=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$@</span> &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> ; <span class="keyword">do</span></span><br><span class="line">    PID=$(pidof <span class="variable">$&#123;FULL_PATH&#125;</span>)</span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$PID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span> :: <span class="variable">$FULL_PATH</span>[<span class="variable">$PID</span>] <span class="subst">$(ps -C $&#123;FULL_PATH&#125; -o %cpu | tail -1)</span>%&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 0.5</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Sometimes we want to collect the cpu usage of the process, and usually use a script to make simple statistics.&lt;/p&gt;
&lt;p&gt;Under Linux, the cp</summary>
      
    
    
    
    <category term="Solution" scheme="https://blog.justforlxz.com/categories/Solution/"/>
    
    
    <category term="Linux" scheme="https://blog.justforlxz.com/tags/Linux/"/>
    
    <category term="Bash" scheme="https://blog.justforlxz.com/tags/Bash/"/>
    
  </entry>
  
  <entry>
    <title>How to Solve the Module not found: Cannot resolve &#39;fs&#39; error in Next.js</title>
    <link href="https://blog.justforlxz.com/2023/04/19/How-to-Solve-the-Module-not-found-Cannot-resolve-fs-error-in-Next-js/"/>
    <id>https://blog.justforlxz.com/2023/04/19/How-to-Solve-the-Module-not-found-Cannot-resolve-fs-error-in-Next-js/</id>
    <published>2023-04-19T05:58:21.000Z</published>
    <updated>2024-04-15T05:09:54.913Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Webpack-4-version"><a href="#Webpack-4-version" class="headerlink" title="Webpack 4 version"></a>Webpack 4 version</h2><p>To resolve the error with Webpack 4, you need to tell webpack to set the module to â€˜emptyâ€™ on the client-side (!isServer).</p><p>This is also a solution when you are working with older Next.js versions.</p><p>The configuration essentially tells Webpack to create an empty module for fs, which effectively suppresses the error.</p><p>Update your <code>next.config.js</code> with the following:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">webpack</span>: <span class="function">(<span class="params">config, &#123; isServer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isServer) &#123;</span><br><span class="line">      <span class="comment">// set &#x27;fs&#x27; to an empty module on the client to prevent this error on build --&gt; Error: Can&#x27;t resolve &#x27;fs&#x27;</span></span><br><span class="line">      config.<span class="property">node</span> = &#123;</span><br><span class="line">        <span class="attr">fs</span>: <span class="string">&quot;empty&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Webpack-5-version"><a href="#Webpack-5-version" class="headerlink" title="Webpack 5 version"></a>Webpack 5 version</h2><p>To resolve the error with Webpack 5, you need to tell webpack not to resolve the module on the client-side (!isServer).</p><p>Update your <code>next.config.js</code> with the following:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">webpack</span>: <span class="function">(<span class="params">config, &#123; isServer &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isServer) &#123;</span><br><span class="line">      <span class="comment">// don&#x27;t resolve &#x27;fs&#x27; module on the client to prevent this error on build --&gt; Error: Can&#x27;t resolve &#x27;fs&#x27;</span></span><br><span class="line">      config.<span class="property">resolve</span>.<span class="property">fallback</span> = &#123;</span><br><span class="line">        <span class="attr">fs</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Webpack-4-version&quot;&gt;&lt;a href=&quot;#Webpack-4-version&quot; class=&quot;headerlink&quot; title=&quot;Webpack 4 version&quot;&gt;&lt;/a&gt;Webpack 4 version&lt;/h2&gt;&lt;p&gt;To resolve</summary>
      
    
    
    
    <category term="Solution" scheme="https://blog.justforlxz.com/categories/Solution/"/>
    
    
    <category term="Next.js" scheme="https://blog.justforlxz.com/tags/Next-js/"/>
    
    <category term="Web" scheme="https://blog.justforlxz.com/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>Kitty configuration for macOS</title>
    <link href="https://blog.justforlxz.com/2023/04/17/Kitty-configuration-for-macOS/"/>
    <id>https://blog.justforlxz.com/2023/04/17/Kitty-configuration-for-macOS/</id>
    <published>2023-04-17T08:39:51.000Z</published>
    <updated>2024-04-15T05:09:54.915Z</updated>
    
    <content type="html"><![CDATA[<p>Iâ€™ve been using Kitty for a couple of days. I use it because there is a plugin for nvim that can seamlessly switch focus with kitty, so I donâ€™t need to repeat the settings, I like it very much.</p><p>After a period of use. I have completed part of the configuration, and now I want to share it.</p><p>I use different folders for related functions. Such as themes, tabs, windows, and shortcuts.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">lxz @ lxzMacBook-Pro <span class="keyword">in</span> ~/.dot/kitty/.config/kitty on git:master o [16:38:58]</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ kitty.conf</span><br><span class="line">â”œâ”€â”€ kitty.d</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ init</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ init.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ keybind</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ init.conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ nvim.conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tab.conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ window.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ session</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ init.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ theme</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ background.conf</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ color.conf</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ font.conf</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tabbar.conf</span><br><span class="line">â”‚Â Â      â””â”€â”€ window.conf</span><br><span class="line">â””â”€â”€ session.conf</span><br><span class="line"></span><br><span class="line">6 directories, 13 files</span><br></pre></td></tr></table></figure><h2 id="Some-screenshot"><a href="#Some-screenshot" class="headerlink" title="Some screenshot"></a>Some screenshot</h2><h3 id="session-look-at-the-lower-left-corner"><a href="#session-look-at-the-lower-left-corner" class="headerlink" title="session (look at the lower left corner)"></a>session (look at the lower left corner)</h3><img src="/2023/04/17/Kitty-configuration-for-macOS/2023-04-17-17.52.14.png" class="" title="2023-04-17-17.52.14.png"><img src="/2023/04/17/Kitty-configuration-for-macOS/2023-04-17-17.59.50.png" class="" title="2023-04-17-17.59.50.png"><h3 id="multi-splits"><a href="#multi-splits" class="headerlink" title="multi splits"></a>multi splits</h3><img src="/2023/04/17/Kitty-configuration-for-macOS/2023-04-17-17.57.06.png" class="" title="2023-04-17-17.57.06.png"><h2 id="Base-settings"><a href="#Base-settings" class="headerlink" title="Base settings"></a>Base settings</h2><p>In kitty.conf, I just set to load configuration files in other directories.</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">globinclude kitty.d/**/*.conf</span><br></pre></td></tr></table></figure><p>I wonâ€™t show the configuration after splitting, just give a hint according to the function.</p><h2 id="Init"><a href="#Init" class="headerlink" title="Init"></a>Init</h2><p>In init.conf, I set some default variables.</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">term xterm-256color</span><br><span class="line">shell_integration enabled</span><br><span class="line">allow_hyperlinks yes</span><br><span class="line">editor nvim</span><br></pre></td></tr></table></figure><h2 id="Theme-settings"><a href="#Theme-settings" class="headerlink" title="Theme settings"></a>Theme settings</h2><h3 id="Tabs-settings"><a href="#Tabs-settings" class="headerlink" title="Tabs settings"></a>Tabs settings</h3><p>In tabs settings, I like <code>powerline</code> style.</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">tab_bar_style powerline</span><br></pre></td></tr></table></figure><h3 id="Windows-settings"><a href="#Windows-settings" class="headerlink" title="Windows settings"></a>Windows settings</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">window_border_width 0.5pt</span><br><span class="line"></span><br><span class="line">window_resize_step_cells 2</span><br><span class="line">window_resize_step_lines 2</span><br><span class="line"></span><br><span class="line">initial_window_width  640</span><br><span class="line">initial_window_height 400</span><br><span class="line"></span><br><span class="line">draw_minimal_borders yes</span><br><span class="line"></span><br><span class="line">inactive_text_alpha 0.7</span><br><span class="line"></span><br><span class="line">hide_window_decorations no</span><br><span class="line"></span><br><span class="line">macos_titlebar_color background</span><br><span class="line">macos_thicken_font 0.75</span><br><span class="line"></span><br><span class="line">active_border_color none</span><br><span class="line"></span><br><span class="line"># default layout is vertical splits only</span><br><span class="line">enabled_layouts splits</span><br><span class="line"></span><br><span class="line">enable_audio_bell no</span><br></pre></td></tr></table></figure><h3 id="Fonts-settings"><a href="#Fonts-settings" class="headerlink" title="Fonts settings"></a>Fonts settings</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">font_family FiraCode Nerd Font Mono Retina</span><br><span class="line">font_size 16.0</span><br></pre></td></tr></table></figure><h3 id="Color-settings"><a href="#Color-settings" class="headerlink" title="Color settings"></a>Color settings</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># Dark One Nuanced by ariasuni, https://store.kde.org/p/1225908</span><br><span class="line"># Imported from KDE .colorscheme format by thematdev, https://thematdev.org</span><br><span class="line"># For migrating your schemes from Konsole format see</span><br><span class="line"># https://git.thematdev.org/thematdev/konsole-scheme-migration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># importing Background</span><br><span class="line">background #282c34</span><br><span class="line"># importing BackgroundFaint</span><br><span class="line"># importing BackgroundIntense</span><br><span class="line"># importing Color0</span><br><span class="line">color0 #3f4451</span><br><span class="line"># importing Color0Faint</span><br><span class="line">color16 #282c34</span><br><span class="line"># importing Color0Intense</span><br><span class="line">color8 #4f5666</span><br><span class="line"># importing Color1</span><br><span class="line">color1 #e06c75</span><br><span class="line"># importing Color1Faint</span><br><span class="line">color17 #c25d66</span><br><span class="line"># importing Color1Intense</span><br><span class="line">color9 #ff7b86</span><br><span class="line"># importing Color2</span><br><span class="line">color2 #98c379</span><br><span class="line"># importing Color2Faint</span><br><span class="line">color18 #82a566</span><br><span class="line"># importing Color2Intense</span><br><span class="line">color10 #b1e18b</span><br><span class="line"># importing Color3</span><br><span class="line">color3 #d19a66</span><br><span class="line"># importing Color3Faint</span><br><span class="line">color19 #b38257</span><br><span class="line"># importing Color3Intense</span><br><span class="line">color11 #efb074</span><br><span class="line"># importing Color4</span><br><span class="line">color4 #61afef</span><br><span class="line"># importing Color4Faint</span><br><span class="line">color20 #5499d1</span><br><span class="line"># importing Color4Intense</span><br><span class="line">color12 #67cdff</span><br><span class="line"># importing Color5</span><br><span class="line">color5 #c678dd</span><br><span class="line"># importing Color5Faint</span><br><span class="line">color21 #a966bd</span><br><span class="line"># importing Color5Intense</span><br><span class="line">color13 #e48bff</span><br><span class="line"># importing Color6</span><br><span class="line">color6 #56b6c2</span><br><span class="line"># importing Color6Faint</span><br><span class="line">color22 #44919a</span><br><span class="line"># importing Color6Intense</span><br><span class="line">color14 #63d4e0</span><br><span class="line"># importing Color7</span><br><span class="line">color7 #e6e6e6</span><br><span class="line"># importing Color7Faint</span><br><span class="line">color23 #c8c8c8</span><br><span class="line"># importing Color7Intense</span><br><span class="line">color15 #ffffff</span><br><span class="line"># importing Foreground</span><br><span class="line">foreground #abb2bf</span><br><span class="line"># importing ForegroundFaint</span><br><span class="line"># importing ForegroundIntense</span><br><span class="line"># importing General</span><br></pre></td></tr></table></figure><h2 id="Shortcuts-settings"><a href="#Shortcuts-settings" class="headerlink" title="Shortcuts settings"></a>Shortcuts settings</h2><h3 id="Init-1"><a href="#Init-1" class="headerlink" title="Init"></a>Init</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># clear the terminal screen</span><br><span class="line">map cmd+k combine : clear_terminal scrollback active : send_text normal,application \x0c</span><br><span class="line"></span><br><span class="line"># jump to beginning and end of word</span><br><span class="line">map alt+left send_text all \x1b\x62</span><br><span class="line">map alt+right send_text all \x1b\x66</span><br><span class="line"></span><br><span class="line"># jump to beginning and end of line</span><br><span class="line">map cmd+left send_text all \x01</span><br><span class="line">map cmd+right send_text all \x05</span><br><span class="line"></span><br><span class="line"># Map cmd + &lt;num&gt; to corresponding tabs</span><br><span class="line">map cmd+1 goto_tab 1</span><br><span class="line">map cmd+2 goto_tab 2</span><br><span class="line">map cmd+3 goto_tab 3</span><br><span class="line">map cmd+4 goto_tab 4</span><br><span class="line">map cmd+5 goto_tab 5</span><br><span class="line">map cmd+6 goto_tab 6</span><br><span class="line">map cmd+7 goto_tab 7</span><br><span class="line">map cmd+8 goto_tab 8</span><br><span class="line">map cmd+9 goto_tab 9</span><br><span class="line"></span><br><span class="line"># changing font sizes</span><br><span class="line">map cmd+equal    change_font_size all +2.0</span><br><span class="line">map cmd+minus    change_font_size all -2.0</span><br><span class="line">map cmd+0        change_font_size all 0</span><br><span class="line"></span><br><span class="line">map cmd+c        copy_to_clipboard</span><br><span class="line">map cmd+v        paste_from_clipboard</span><br></pre></td></tr></table></figure><h3 id="Tab"><a href="#Tab" class="headerlink" title="Tab"></a>Tab</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">map alt+1 goto_tab 1</span><br><span class="line">map alt+2 goto_tab 2</span><br><span class="line">map alt+3 goto_tab 3</span><br><span class="line">map alt+4 goto_tab 4</span><br><span class="line">map alt+5 goto_tab 5</span><br><span class="line">map alt+6 goto_tab 6</span><br><span class="line">map alt+7 goto_tab 7</span><br><span class="line">map alt+8 goto_tab 8</span><br><span class="line">map alt+9 goto_tab 9</span><br><span class="line">map alt+0 goto_tab 0</span><br><span class="line"></span><br><span class="line"># open new tab with cmd+t</span><br><span class="line">map cmd+t new_tab</span><br><span class="line"></span><br><span class="line"># switch between next and previous splits</span><br><span class="line">map cmd+]        next_window</span><br><span class="line">map cmd+[        previous_window</span><br></pre></td></tr></table></figure><h3 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># open new split (window) with cmd+d retaining the cwd</span><br><span class="line">map cmd+w close_window</span><br><span class="line">map cmd+shif+n new_os_window</span><br><span class="line">map cmd+d launch --location=hsplit --cwd=current</span><br><span class="line">map cmd+shift+d launch --location=vsplit --cwd=current</span><br></pre></td></tr></table></figure><h3 id="Neovim"><a href="#Neovim" class="headerlink" title="Neovim"></a>Neovim</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">map ctrl+j kitten pass_keys.py neighboring_window bottom ctrl+j &quot;^.* - nvim$&quot;</span><br><span class="line">map ctrl+k kitten pass_keys.py neighboring_window top    ctrl+k &quot;^.* - nvim$&quot;</span><br><span class="line">map ctrl+h kitten pass_keys.py neighboring_window left   ctrl+h &quot;^.* - nvim$&quot;</span><br><span class="line">map ctrl+l kitten pass_keys.py neighboring_window right  ctrl+l &quot;^.* - nvim$&quot;</span><br><span class="line"></span><br><span class="line"># the 3 here is the resize amount, adjust as needed</span><br><span class="line">map alt+j kitten pass_keys.py relative_resize down  3 alt+j &quot;^.* - nvim$&quot;</span><br><span class="line">map alt+k kitten pass_keys.py relative_resize up    3 alt+k &quot;^.* - nvim$&quot;</span><br><span class="line">map alt+h kitten pass_keys.py relative_resize left  3 alt+h &quot;^.* - nvim$&quot;</span><br><span class="line">map alt+l kitten pass_keys.py relative_resize right 3 alt+l &quot;^.* - nvim$&quot;</span><br></pre></td></tr></table></figure><p>Moving in shell and nvim.</p><img src="/2023/04/17/Kitty-configuration-for-macOS/nvim-integration.gif" class="" title="nvim-integration.gif"><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>Kitty supports session management, I added some default sessions, and opened session sockets for nvim.</p><p>The session.conf at the root is the location configuration of the session.</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">new_tab home</span><br><span class="line">layout splits</span><br><span class="line">cd ~</span><br><span class="line">launch zsh</span><br><span class="line">focus</span><br><span class="line"></span><br><span class="line">new_tab work</span><br><span class="line">cd ~/Develop/linuxdeepin/</span><br><span class="line">launch zsh</span><br><span class="line"></span><br><span class="line">new_tab nvim</span><br><span class="line">cd ~/.config/nvim</span><br><span class="line">launch zsh</span><br></pre></td></tr></table></figure><h3 id="Init-2"><a href="#Init-2" class="headerlink" title="Init"></a>Init</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">startup_session session.conf</span><br><span class="line"></span><br><span class="line"># Other unix systems:</span><br><span class="line">allow_remote_control yes</span><br><span class="line">listen_on unix:/tmp/.kitty</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Iâ€™ve been using Kitty for a couple of days. I use it because there is a plugin for nvim that can seamlessly switch focus with kitty, so I</summary>
      
    
    
    
    <category term="development tools" scheme="https://blog.justforlxz.com/categories/development-tools/"/>
    
    
    <category term="Kitty" scheme="https://blog.justforlxz.com/tags/Kitty/"/>
    
  </entry>
  
  <entry>
    <title>How to solve parallels desktop linux usb problem</title>
    <link href="https://blog.justforlxz.com/2023/04/11/How-to-solve-parallels-desktop-linux-usb-problem/"/>
    <id>https://blog.justforlxz.com/2023/04/11/How-to-solve-parallels-desktop-linux-usb-problem/</id>
    <published>2023-04-11T04:59:39.000Z</published>
    <updated>2024-04-15T05:09:54.914Z</updated>
    
    <content type="html"><![CDATA[<p>I am runing a linux virtual machine macos using parallels desktop. One day when I booted normally, I got a usb error and couldnâ€™t use the keyboard and mouse in virtual machine.</p><p>An error messages like this is output on the screen.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">usb 3-1: can&#x27;t set config #1, error -62</span><br><span class="line">xhci_hcd Error while assigning device slot ID: Command Aborted.</span><br><span class="line">xhci_hcd Max number of devices this xHCI host supports is 32.</span><br><span class="line">usb usb3-port2: couldn&#x27;t allocate usb_device</span><br></pre></td></tr></table></figure><img src="/2023/04/11/How-to-solve-parallels-desktop-linux-usb-problem/tg_image_2922023940.jpeg" class="" title="error.jpeg"><p>Finally I found a solution on the parallels desktop forum.</p><ol><li>Start your virtual machine.</li><li>Press e to edit the grub menu during the boot phase, passing a new parameter to the kernel.</li><li>Append <code>xhci_hcd.quirks=0x40</code> after quiet</li><li>F10 booting the kernel</li><li>After entering the system, open the terminal and edit the <code>/etc/default/grub</code> file</li><li>Replace that line with the following line:</li></ol><blockquote><p>GRUB_CMDLINE_LINUX_DEFAULT&#x3D;â€quiet xhci_hcd.quirks&#x3D;0x40â€</p></blockquote><ol start="7"><li>Next, execute the following command:</li></ol><blockquote><p>sudo update-grub</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;I am runing a linux virtual machine macos using parallels desktop. One day when I booted normally, I got a usb error and couldnâ€™t use the</summary>
      
    
    
    
    <category term="Solution" scheme="https://blog.justforlxz.com/categories/Solution/"/>
    
    
    <category term="parallels desktop" scheme="https://blog.justforlxz.com/tags/parallels-desktop/"/>
    
  </entry>
  
  <entry>
    <title>How to remove all Terminating pods</title>
    <link href="https://blog.justforlxz.com/2023/03/15/How-to-remove-all-Terminating-pods/"/>
    <id>https://blog.justforlxz.com/2023/03/15/How-to-remove-all-Terminating-pods/</id>
    <published>2023-03-15T06:47:59.000Z</published>
    <updated>2024-04-15T05:09:54.914Z</updated>
    
    <content type="html"><![CDATA[<p>Sometimes all pods of k8s will be in Terminating state, use this command to clean up all pods.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get pods --all-namespaces | grep Terminating | while read line; do</span><br><span class="line">  pod_name=$(echo $line | awk &#x27;&#123;print $2&#125;&#x27; ) \</span><br><span class="line">  name_space=$(echo $line | awk &#x27;&#123;print $1&#125;&#x27; ); \</span><br><span class="line">  kubectl delete pods $pod_name -n $name_space --grace-period=0 --force</span><br><span class="line">done</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Sometimes all pods of k8s will be in Terminating state, use this command to clean up all pods.&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table</summary>
      
    
    
    
    <category term="Solution" scheme="https://blog.justforlxz.com/categories/Solution/"/>
    
    
    <category term="k8s" scheme="https://blog.justforlxz.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>solved duplicate hostname or contents</title>
    <link href="https://blog.justforlxz.com/2023/02/01/solved-duplicate-hostname-or-contents/"/>
    <id>https://blog.justforlxz.com/2023/02/01/solved-duplicate-hostname-or-contents/</id>
    <published>2023-02-01T06:48:21.000Z</published>
    <updated>2024-04-15T05:09:55.028Z</updated>
    
    <content type="html"><![CDATA[<img src="/2023/02/01/solved-duplicate-hostname-or-contents/tg_image_1176326230.jpeg" class=""><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Feb 01 05:40:37 fv-az406-375 k3s[5352]: time=&quot;2023-02-01T05:40:37Z&quot; level=info msg=&quot;Waiting to retrieve agent configuration; server is not ready: Node password rejected, duplicate hostname or contents of &#x27;/etc/rancher/node/password&#x27; may not match server node-passwd entry, try enabling a unique node name with the --with-node-id flag&quot;</span><br></pre></td></tr></table></figure><p>When you join a cluster, you are reminded that it already exists, but the same node does not exist in the cluster.</p><p>you can do this.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl -n kube-system delete secrets &lt;node name&gt;.node-password.k3s</span><br></pre></td></tr></table></figure><p>example:</p><p>first, we list all node to check, if the node exists, we should not continue the operation, we need to modify the name of the node that is joining the cluster to avoid conflicts with existing ones.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get node</span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">rpi4                    Ready    control-plane,master   2d3h   v1.25.6+k3s1</span><br></pre></td></tr></table></figure><p>Now the homenas-vm node does not exist. But the logs tell us that the cluster already has the password, it doesnâ€™t match the current one.</p><p>Then we need to manually delete the old password in the cluster and let the new node join.</p><p>you can use this command to show all secrets, the node password in here.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl get -n kube-system secrets</span><br></pre></td></tr></table></figure><p>then you will see all secrets.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NAME                                      TYPE                 DATA   AGE</span><br><span class="line">company-laptop.node-password.k3s          Opaque               1      2d1h</span><br><span class="line">company-pc.node-password.k3s              Opaque               1      2d2h</span><br><span class="line">homenas-vm.node-password.k3s              Opaque               1      50m</span><br><span class="line">k3s-serving                               kubernetes.io/tls    2      2d3h</span><br><span class="line">rpi4.node-password.k3s                    Opaque               1      2d3h</span><br><span class="line">sh.helm.release.v1.traefik-crd.v1         helm.sh/release.v1   1      2d3h</span><br><span class="line">sh.helm.release.v1.traefik.v1             helm.sh/release.v1   1      2d3h</span><br></pre></td></tr></table></figure><p>if the homenas-vm is invalid, we need to delete it manually.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl -n kube-system delete secrets homenas-vm.node-password.k3s</span><br></pre></td></tr></table></figure><p>itâ€™s done!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;img src=&quot;/2023/02/01/solved-duplicate-hostname-or-contents/tg_image_1176326230.jpeg&quot; class=&quot;&quot;&gt;

&lt;figure class=&quot;highlight text&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;</summary>
      
    
    
    
    <category term="Solution" scheme="https://blog.justforlxz.com/categories/Solution/"/>
    
    
  </entry>
  
  <entry>
    <title>how to use nvim dap to debug cpp</title>
    <link href="https://blog.justforlxz.com/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/"/>
    <id>https://blog.justforlxz.com/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/</id>
    <published>2022-12-08T02:16:45.000Z</published>
    <updated>2024-04-15T05:09:54.994Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ä¹‹å‰æˆ‘å·²ç»åˆ†äº«è¿‡äº†ä¸€ä»½ç®€å•çš„ nvim é…ç½®ï¼Œå®ƒå·²ç»å®ç°äº†ç¼–ç¨‹æ‰€éœ€çš„æ™ºèƒ½æç¤ºï¼Œè¯­æ³•é«˜äº®ï¼Œä»£ç è·³è½¬ç­‰åŠŸèƒ½ï¼Œä»Šå¤©æˆ‘æ‰“ç®—æ•´ä¸€ä¸‹ nvim çš„è°ƒè¯•æ¡†æ¶ dapã€‚</p><p>dap æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®¢æˆ·ç«¯è´Ÿè´£åœ¨ nvim ä¸Šæ˜¾ç¤ºå„ç§è°ƒè¯•ä¿¡æ¯ï¼Œæ¯”å¦‚æ˜¾ç¤ºæ–­ç‚¹ã€è°ƒç”¨æ ˆã€å¯¹è±¡å†…å­˜ä¿¡æ¯ç­‰ï¼ŒæœåŠ¡ç«¯åˆ™æä¾›å®¢æˆ·ç«¯æ‰€éœ€çš„åŠŸèƒ½ï¼ŒæœåŠ¡ç«¯é€šå¸¸æ˜¯ä¸€ä¸ªè°ƒè¯•å™¨ï¼Œæˆ–è€…æ˜¯è°ƒè¯•å™¨åŒ…è£…ã€‚</p><p>æœ¬ç¯‡ä¼šç”¨åˆ° Mason è¿™ä¸ªæ’ä»¶å»å®‰è£… dap çš„æœåŠ¡ç«¯ï¼Œæœ¬ç¯‡ä¸ä¼šå±•å¼€ Masonï¼Œå°†æ¥æœ‰æœºä¼šè¯¦ç»†è¯´ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆå…ˆçœ‹å‡ å¼ æ­£å¸¸å·¥ä½œçš„å›¾:</p><center><img src="/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/tg_image_3574429301.jpeg" class=""><p>è¿è¡Œç•Œé¢</p><img src="/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/tg_image_3358891712.jpeg" class=""><p>æŸ¥çœ‹å˜é‡ä¿¡æ¯</p><img src="/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/tg_image_3913027219.jpeg" class=""><p>å¿«æ·é”®</p><img src="/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/tg_image_1568131740.jpeg" class="" title="call stacks"><p>å‡½æ•°è°ƒç”¨æ ˆ</p></center><h2 id="å®‰è£…-dap"><a href="#å®‰è£…-dap" class="headerlink" title="å®‰è£… dap"></a>å®‰è£… dap</h2><p>åœ¨ Mason çš„å®‰è£…åˆ—è¡¨ä¸­æ·»åŠ ä¸Š codelldbï¼Œcodelldb æ˜¯ vscode ç”¨çš„è°ƒè¯•æœåŠ¡ç«¯ï¼Œè´Ÿè´£ç»™ vscode æä¾›è°ƒè¯•ä¿¡æ¯ï¼Œæœ‰äº†è¿™ä¸ªåç«¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿çš„å®ç°å’Œ vscode ç›¸åŒçš„è°ƒè¯•åŠŸèƒ½ã€‚</p><h2 id="é…ç½®-dap"><a href="#é…ç½®-dap" class="headerlink" title="é…ç½® dap"></a>é…ç½® dap</h2><p>åœ¨ plugins ç›®å½•ä¸‹æ–°å»º <code>_dap.lua</code> æ–‡ä»¶ã€‚</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="string">&quot;mfussenegger/nvim-dap&quot;</span>,</span><br><span class="line">  opt = <span class="literal">true</span>,</span><br><span class="line">  <span class="built_in">module</span> = &#123; <span class="string">&quot;dap&quot;</span> &#125;,</span><br><span class="line">  requires = &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;theHamsta/nvim-dap-virtual-text&quot;</span>,</span><br><span class="line">      <span class="built_in">module</span> = &#123; <span class="string">&quot;nvim-dap-virtual-text&quot;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;rcarriga/nvim-dap-ui&quot;</span>,</span><br><span class="line">      <span class="built_in">module</span> = &#123; <span class="string">&quot;dapui&quot;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;nvim-telescope/telescope-dap.nvim&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;jbyuki/one-small-step-for-vimkind&quot;</span>,</span><br><span class="line">      <span class="built_in">module</span> = <span class="string">&quot;osv&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">config</span> = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&quot;config.dap&quot;</span>).setup()</span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">  disable = <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰äº›äººä¼šåœ¨ packer é‡Œç”¨ use å®‰è£…ï¼ŒæŠŠ return æ”¹æˆ use å°±å¯ä»¥äº†ã€‚</p></blockquote><p>packer çš„ä»£ç å·²ç»å†™å¥½äº†ï¼Œç°åœ¨å†™ config å‡½æ•°ï¼Œåœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘æŠŠæ–‡ä»¶æ”¾åœ¨äº† <code>lua/config/dap/</code> ç›®å½•ä¸‹ï¼Œå› ä¸ºè¦é…ç½®ä¸åŒçš„è¯­è¨€ï¼Œè¿™æ ·ä¼šæ–¹ä¾¿ç®¡ç†ä¸€äº›ã€‚</p><p>é¦–å…ˆè¦å…ˆåœ¨ dap ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª init.luaï¼Œè¿™é‡Œæ˜¯æ¨¡å—å…¥å£ï¼Œåˆå§‹åŒ–çš„å·¥ä½œä»è¿™é‡Œå¼€å§‹ã€‚</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> M = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">configure</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">configure_exts</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">configure_debuggers</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">M.setup</span><span class="params">()</span></span></span><br><span class="line">configure() <span class="comment">-- Configuration</span></span><br><span class="line">configure_exts() <span class="comment">-- Extensions</span></span><br><span class="line">configure_debuggers() <span class="comment">-- Debugger</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">configure_debuggers()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> M</span><br></pre></td></tr></table></figure><p>åœ¨ <code>_dap.lua</code> ä¸­è°ƒç”¨äº† <code>require(&quot;config.dap&quot;).setup()</code>ï¼Œè¿™ä¸ª setup å‡½æ•°å°±æ˜¯ <code>config/dap/init.lua</code> ä¸­çš„ <code>M.setup()</code> å‡½æ•°ã€‚</p><p>ç›®å‰åªæ˜¯å†™äº†ä¸€ä¸ªå£³å­ï¼Œç°åœ¨è®©æˆ‘ä»¬æ­£å¼é…ç½®å®ƒå§ã€‚</p><h3 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h3><p>åœ¨ nvim ä¸­è¿›è¡Œè°ƒè¯•ï¼Œç•Œé¢æ˜¾ç„¶è¿˜æ˜¯åœ¨ç»ˆç«¯é‡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨å¿«æ·é”®è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚æ ‡è®°æ–­ç‚¹ã€å•æ­¥è¿›å…¥ã€è·³å‡ºç­‰ã€‚</p><p>åœ¨ <code>config/dap/keymaps.lua</code> ä¸­è¿›è¡Œå¿«æ·é”®çš„é…ç½®ã€‚</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> M = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> whichkey = <span class="built_in">require</span> <span class="string">&quot;which-key&quot;</span></span><br><span class="line"><span class="comment">-- local legendary = require &quot;legendary&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- local function keymap(lhs, rhs, desc)</span></span><br><span class="line"><span class="comment">--   vim.keymap.set(&quot;n&quot;, lhs, rhs, &#123; silent = true, desc = desc &#125;)</span></span><br><span class="line"><span class="comment">-- end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">M.setup</span><span class="params">()</span></span></span><br><span class="line">  <span class="keyword">local</span> keymap = &#123;</span><br><span class="line">    d = &#123;</span><br><span class="line">      name = <span class="string">&quot;DAP&quot;</span>,</span><br><span class="line">      R = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.run_to_cursor()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Run to Cursor&quot;</span> &#125;,</span><br><span class="line">      E = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dapui&#x27;.eval(vim.fn.input &#x27;[Expression] &gt; &#x27;)&lt;cr&gt;&quot;</span>, <span class="string">&quot;Evaluate Input&quot;</span> &#125;,</span><br><span class="line">      C = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.set_breakpoint(vim.fn.input &#x27;[Condition] &gt; &#x27;)&lt;cr&gt;&quot;</span>, <span class="string">&quot;Conditional Breakpoint&quot;</span> &#125;,</span><br><span class="line">      U = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dapui&#x27;.toggle()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Toggle UI&quot;</span> &#125;,</span><br><span class="line">      b = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.step_back()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Step Back&quot;</span> &#125;,</span><br><span class="line">      c = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.continue()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Continue&quot;</span> &#125;,</span><br><span class="line">      d = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.disconnect()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Disconnect&quot;</span> &#125;,</span><br><span class="line">      e = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dapui&#x27;.eval()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Evaluate&quot;</span> &#125;,</span><br><span class="line">      g = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.session()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Get Session&quot;</span> &#125;,</span><br><span class="line">      h = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap.ui.widgets&#x27;.hover()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Hover Variables&quot;</span> &#125;,</span><br><span class="line">      S = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap.ui.widgets&#x27;.scopes()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Scopes&quot;</span> &#125;,</span><br><span class="line">      i = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.step_into()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Step Into&quot;</span> &#125;,</span><br><span class="line">      o = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.step_over()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Step Over&quot;</span> &#125;,</span><br><span class="line">      p = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.pause.toggle()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Pause&quot;</span> &#125;,</span><br><span class="line">      q = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.close()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Quit&quot;</span> &#125;,</span><br><span class="line">      r = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.repl.toggle()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Toggle Repl&quot;</span> &#125;,</span><br><span class="line">      s = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.continue()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Start&quot;</span> &#125;,</span><br><span class="line">      t = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.toggle_breakpoint()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Toggle Breakpoint&quot;</span> &#125;,</span><br><span class="line">      x = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.terminate()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Terminate&quot;</span> &#125;,</span><br><span class="line">      u = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dap&#x27;.step_out()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Step Out&quot;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">local</span> opts = &#123;</span><br><span class="line">    mode = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">    prefix = <span class="string">&quot;&lt;leader&gt;&quot;</span>,</span><br><span class="line">    buffer = <span class="literal">nil</span>,</span><br><span class="line">    silent = <span class="literal">true</span>,</span><br><span class="line">    noremap = <span class="literal">true</span>,</span><br><span class="line">    nowait = <span class="literal">false</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  whichkey.register(keymap, opts)</span><br><span class="line">  <span class="comment">--- require(&quot;legendary.integrations.which-key&quot;).bind_whichkey(keymap, opts, false)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">local</span> keymap_v = &#123;</span><br><span class="line">    d = &#123;</span><br><span class="line">      name = <span class="string">&quot;Debug&quot;</span>,</span><br><span class="line">      e = &#123; <span class="string">&quot;&lt;cmd&gt;lua require&#x27;dapui&#x27;.eval()&lt;cr&gt;&quot;</span>, <span class="string">&quot;Evaluate&quot;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  opts = &#123;</span><br><span class="line">    mode = <span class="string">&quot;v&quot;</span>,</span><br><span class="line">    prefix = <span class="string">&quot;&lt;leader&gt;&quot;</span>,</span><br><span class="line">    buffer = <span class="literal">nil</span>,</span><br><span class="line">    silent = <span class="literal">true</span>,</span><br><span class="line">    noremap = <span class="literal">true</span>,</span><br><span class="line">    nowait = <span class="literal">false</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  whichkey.register(keymap_v, opts)</span><br><span class="line">  <span class="comment">--- require(&quot;legendary.integrations.which-key&quot;).bind_whichkey(keymap_v, opts, false)</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> M</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæˆ‘å°†å¿«æ·é”®ç»‘å®šåœ¨äº† <code>&lt;leader&gt; d</code> ä¸Šé¢ã€‚</p><p>ç°åœ¨è¿”å›åˆ° <code>init.lua</code> ä¸­ï¼Œåœ¨ <code>setup</code> å‡½æ•°ä¸­è°ƒç”¨ keymapsã€‚</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">M.setup</span><span class="params">()</span></span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;config.dap.keymaps&quot;</span>).setup() <span class="comment">-- Keymaps</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="dapui"><a href="#dapui" class="headerlink" title="dapui"></a>dapui</h3><p>dapui æ˜¯ä¸€ä¸ªç¾åŒ– dap ç•Œé¢çš„æ’ä»¶ï¼Œé€šå¸¸å¤§å®¶éƒ½ä¼šé…ç½®çš„å§ï¼</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">configure_exts</span><span class="params">()</span></span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;nvim-dap-virtual-text&quot;</span>).setup(&#123;</span><br><span class="line">commented = <span class="literal">true</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> dap, dapui = <span class="built_in">require</span>(<span class="string">&quot;dap&quot;</span>), <span class="built_in">require</span>(<span class="string">&quot;dapui&quot;</span>)</span><br><span class="line">dapui.setup(&#123;</span><br><span class="line">expand_lines = <span class="literal">true</span>,</span><br><span class="line">icons = &#123; expanded = <span class="string">&quot;ïƒ&quot;</span>, collapsed = <span class="string">&quot;ïƒš&quot;</span>, circular = <span class="string">&quot;ï„&quot;</span> &#125;,</span><br><span class="line">mappings = &#123;</span><br><span class="line"><span class="comment">-- Use a table to apply multiple mappings</span></span><br><span class="line">expand = &#123; <span class="string">&quot;&lt;CR&gt;&quot;</span>, <span class="string">&quot;&lt;2-LeftMouse&gt;&quot;</span> &#125;,</span><br><span class="line"><span class="built_in">open</span> = <span class="string">&quot;o&quot;</span>,</span><br><span class="line"><span class="built_in">remove</span> = <span class="string">&quot;d&quot;</span>,</span><br><span class="line">edit = <span class="string">&quot;e&quot;</span>,</span><br><span class="line">repl = <span class="string">&quot;r&quot;</span>,</span><br><span class="line">toggle = <span class="string">&quot;t&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">layouts = &#123;</span><br><span class="line">&#123;</span><br><span class="line">elements = &#123;</span><br><span class="line">&#123; id = <span class="string">&quot;scopes&quot;</span>, size = <span class="number">0.33</span> &#125;,</span><br><span class="line">&#123; id = <span class="string">&quot;breakpoints&quot;</span>, size = <span class="number">0.17</span> &#125;,</span><br><span class="line">&#123; id = <span class="string">&quot;stacks&quot;</span>, size = <span class="number">0.25</span> &#125;,</span><br><span class="line">&#123; id = <span class="string">&quot;watches&quot;</span>, size = <span class="number">0.25</span> &#125;,</span><br><span class="line">&#125;,</span><br><span class="line">size = <span class="number">0.33</span>,</span><br><span class="line">position = <span class="string">&quot;right&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">elements = &#123;</span><br><span class="line">&#123; id = <span class="string">&quot;repl&quot;</span>, size = <span class="number">0.45</span> &#125;,</span><br><span class="line">&#123; id = <span class="string">&quot;console&quot;</span>, size = <span class="number">0.55</span> &#125;,</span><br><span class="line">&#125;,</span><br><span class="line">size = <span class="number">0.27</span>,</span><br><span class="line">position = <span class="string">&quot;bottom&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">floating = &#123;</span><br><span class="line">max_height = <span class="number">0.9</span>,</span><br><span class="line">max_width = <span class="number">0.5</span>, <span class="comment">-- Floats will be treated as percentage of your screen.</span></span><br><span class="line">border = vim.g.border_chars, <span class="comment">-- Border style. Can be &#x27;single&#x27;, &#x27;double&#x27; or &#x27;rounded&#x27;</span></span><br><span class="line">mappings = &#123;</span><br><span class="line"><span class="built_in">close</span> = &#123; <span class="string">&quot;q&quot;</span>, <span class="string">&quot;&lt;Esc&gt;&quot;</span> &#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;) <span class="comment">-- use default</span></span><br><span class="line">dap.listeners.after.event_initialized[<span class="string">&quot;dapui_config&quot;</span>] = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">dapui.<span class="built_in">open</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">dap.listeners.before.event_terminated[<span class="string">&quot;dapui_config&quot;</span>] = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">dapui.<span class="built_in">close</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">dap.listeners.before.event_exited[<span class="string">&quot;dapui_config&quot;</span>] = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">dapui.<span class="built_in">close</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>é…ç½®åŸºæœ¬ä¸Šå¤§å®¶éƒ½æ²¡å·®å¤šå°‘ï¼Œè¯´ä¸å®šéƒ½æ˜¯ä»ä¸€ä¸ªäººçš„é…ç½®é‡Œæ¬è¿çš„ã€‚</p><center><img src="/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/tg_image_1681120408.jpeg" class="" title="evaluate"></center><h3 id="é…ç½®-icon"><a href="#é…ç½®-icon" class="headerlink" title="é…ç½® icon"></a>é…ç½® icon</h3><p>æˆ‘è¿˜ä¿®æ”¹äº†å‡ ä¸ªé»˜è®¤çš„ iconï¼Œåœ¨ configure å‡½æ•°é‡Œã€‚</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">configure</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">local</span> dap_breakpoint = &#123;</span><br><span class="line">breakpoint = &#123;</span><br><span class="line">text = <span class="string">&quot;ï—£&quot;</span>,</span><br><span class="line">texthl = <span class="string">&quot;LspDiagnosticsSignError&quot;</span>,</span><br><span class="line">linehl = <span class="string">&quot;&quot;</span>,</span><br><span class="line">numhl = <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">rejected = &#123;</span><br><span class="line">text = <span class="string">&quot;ï—£&quot;</span>,</span><br><span class="line">texthl = <span class="string">&quot;LspDiagnosticsSignHint&quot;</span>,</span><br><span class="line">linehl = <span class="string">&quot;&quot;</span>,</span><br><span class="line">numhl = <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">stopped = &#123;</span><br><span class="line">text = <span class="string">&quot;ï¡&quot;</span>,</span><br><span class="line">texthl = <span class="string">&quot;LspDiagnosticsSignInformation&quot;</span>,</span><br><span class="line">linehl = <span class="string">&quot;DiagnosticUnderlineInfo&quot;</span>,</span><br><span class="line">numhl = <span class="string">&quot;LspDiagnosticsSignInformation&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vim.fn.sign_define(<span class="string">&quot;DapBreakpoint&quot;</span>, dap_breakpoint.breakpoint)</span><br><span class="line">vim.fn.sign_define(<span class="string">&quot;DapStopped&quot;</span>, dap_breakpoint.stopped)</span><br><span class="line">vim.fn.sign_define(<span class="string">&quot;DapBreakpointRejected&quot;</span>, dap_breakpoint.rejected)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><center><img src="/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/tg_image_3049280764.jpeg" class="" title="breakpoint"><p>æ–­ç‚¹æ ‡è®°</p><img src="/2022/12/08/how-to-use-nvim-dap-to-debug-cpp/tg_image_3325119905.jpeg" class="" title="breakpoint"><p>å•æ­¥åœæ­¢</p></center><h3 id="é…ç½®å®¢æˆ·ç«¯"><a href="#é…ç½®å®¢æˆ·ç«¯" class="headerlink" title="é…ç½®å®¢æˆ·ç«¯"></a>é…ç½®å®¢æˆ·ç«¯</h3><p>ç°åœ¨è¿˜å·®ä¸€ä¸ªå®¢æˆ·ç«¯çš„å‡½æ•°æ²¡æœ‰å†™ï¼Œåœ¨è¿™é‡Œåªæ˜¯ä¸ºäº†è°ƒç”¨é’ˆå¯¹ä¸åŒè¯­è¨€è®¾ç½®çš„æœåŠ¡ç«¯ï¼Œå†…å®¹ä¹Ÿéå¸¸çš„ç®€å•ã€‚</p><p>æ–°å»ºä¸€ä¸ª <code>config/dap/cpp.lua</code>ï¼Œåœ¨é‡Œé¢é…ç½® c++ ç›¸å…³çš„å‚æ•°å°±è¡Œäº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œcodelldb å¯ä»¥è°ƒè¯• cã€c++ã€rust ç­‰è¯­è¨€ï¼Œå°±ä¸ä¼šå†æ‹†åˆ†æˆæ›´ç²¾ç»†çš„æ–‡ä»¶äº†ã€‚</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> M = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">M.setup</span><span class="params">()</span></span></span><br><span class="line"><span class="comment">-- local dap_install = require &quot;dap-install&quot;</span></span><br><span class="line"><span class="comment">-- dap_install.config(&quot;codelldb&quot;, &#123;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> dap = <span class="built_in">require</span>(<span class="string">&quot;dap&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> install_root_dir = vim.fn.stdpath(<span class="string">&quot;data&quot;</span>) .. <span class="string">&quot;/mason&quot;</span></span><br><span class="line"><span class="keyword">local</span> extension_path = install_root_dir .. <span class="string">&quot;/packages/codelldb/extension/&quot;</span></span><br><span class="line"><span class="keyword">local</span> codelldb_path = extension_path .. <span class="string">&quot;adapter/codelldb&quot;</span></span><br><span class="line"></span><br><span class="line">dap.adapters.codelldb = &#123;</span><br><span class="line"><span class="built_in">type</span> = <span class="string">&quot;server&quot;</span>,</span><br><span class="line">port = <span class="string">&quot;$&#123;port&#125;&quot;</span>,</span><br><span class="line">executable = &#123;</span><br><span class="line">command = codelldb_path,</span><br><span class="line">args = &#123; <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;$&#123;port&#125;&quot;</span> &#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">-- On windows you may have to uncomment this:</span></span><br><span class="line"><span class="comment">-- detached = false,</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line">dap.configurations.cpp = &#123;</span><br><span class="line">&#123;</span><br><span class="line">name = <span class="string">&quot;Launch file&quot;</span>,</span><br><span class="line"><span class="built_in">type</span> = <span class="string">&quot;codelldb&quot;</span>,</span><br><span class="line">request = <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">program = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">return</span> vim.fn.<span class="built_in">input</span>(<span class="string">&quot;Path to executable: &quot;</span>, vim.fn.getcwd() .. <span class="string">&quot;/&quot;</span>, <span class="string">&quot;file&quot;</span>)</span><br><span class="line"><span class="keyword">end</span>,</span><br><span class="line">cwd = <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span>,</span><br><span class="line">stopOnEntry = <span class="literal">true</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dap.configurations.c = dap.configurations.cpp</span><br><span class="line">dap.configurations.rust = dap.configurations.cpp</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> M</span><br></pre></td></tr></table></figure><blockquote><p>Mason åœ¨è¿™é‡Œç»ˆäºéœ²é¢äº†ï¼Œä½†æ˜¯æˆ‘ä»¬åªæ˜¯çœ‹åˆ°æŸ¥æ‰¾äº† Mason å®‰è£… codelldb çš„è·¯å¾„è€Œå·²ã€‚</p></blockquote><p>é…ç½®çš„å†…å®¹æ˜¯å›ºå®šçš„ï¼Œè®¾ç½®ä¸€ä¸‹æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„å’Œå‚æ•°ï¼Œè®¾ç½®ä¸€ä¸‹è°ƒè¯•è¿™ä¸ªè¯­è¨€æ‰€éœ€çš„å¯åŠ¨å‚æ•°ï¼Œè¿™é‡Œé»˜è®¤ç»™äº†ä¸€ä¸ªè¾“å…¥å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å¯åŠ¨è°ƒè¯•çš„ç®€å•æ–¹æ³•ã€‚</p><h2 id="é…ç½®-launch-json"><a href="#é…ç½®-launch-json" class="headerlink" title="é…ç½® launch.json"></a>é…ç½® launch.json</h2><p>ä¸Šé¢çš„å†…å®¹å°±å·²ç»è¶³å¤Ÿè°ƒè¯• c++ ç¨‹åºäº†ï¼Œä½†æ˜¯ dap è¿˜æ”¯æŒ vscode çš„ launch.jsonï¼Œå°†å¯åŠ¨é…ç½®ä½œä¸ºå›ºå®šæ¨¡æ¿å¡«å…¥å¯åŠ¨è°ƒè¯•çš„åˆ—è¡¨ï¼Œå¹¶ä¸”åœ¨ launch.json ä¸­æˆ‘ä»¬è¿˜å¯ä»¥æ§åˆ¶ç¨‹åºçš„ç¯å¢ƒå˜é‡ï¼Œå¯åŠ¨å‚æ•°ç­‰ï¼Œä¼šæ¯”è¾ƒæ–¹ä¾¿ä¸€äº›ã€‚</p><p>dap æ”¯æŒè¿™ä¸ªåªéœ€è¦åœ¨ setup å‡½æ•°åŠ ä¸Šä¸€è¡Œä»£ç å°±è¶³å¤Ÿäº†ã€‚</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;dap.ext.vscode&quot;</span>).load_launchjs(<span class="literal">nil</span>, &#123; codelldb = &#123; <span class="string">&quot;c&quot;</span>, <span class="string">&quot;cpp&quot;</span>, <span class="string">&quot;rust&quot;</span> &#125; &#125;)</span><br></pre></td></tr></table></figure><p>è¿™å¥è¯çš„æ„æ€æ˜¯ launch.json ä¸­çš„ç±»å‹æ˜¯ codelldb æ—¶ï¼Œä½¿ç”¨ cã€cppã€rust çš„è°ƒè¯•é…ç½®ï¼Œè€Œä¸Šé¢æˆ‘ä»¬é…ç½®äº† codelldb çš„å‚æ•° å’Œ cpp çš„å‚æ•°ï¼Œè€Œä¸”è¿˜å°† cpp çš„é…ç½®å¤åˆ¶ç»™äº† c å’Œ rustã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œlaunch.json ç°åœ¨ç¯å¢ƒå˜é‡æ¢æˆäº† environment å­—æ®µï¼Œå¹¶ä¸”ç»“æ„ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œdap ç›®å‰åªæ”¯æŒ env å­—æ®µï¼Œæˆ‘åœ¨è€ƒè™‘è´¡çŒ®ä¸€ä¸ª pr åšä¸€ä¸ªè‡ªåŠ¨è½¬æ¢ã€‚</p><p>è¿™é‡Œç»™ä¸€ä¸ª launch.json çš„ä¾‹å­ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(codelldb) Launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;codelldb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./build/bin/deepin-kwin_x11&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;--replace&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;DISPLAY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;:0&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;PATH&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build/bin:$PATH&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;XDG_CURRENT_DESKTOP&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Deepin&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;QT_PLUGIN_PATH&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/build&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;QT_LOGGING_RULES&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kwin_*.debug=true&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ codelldb å…¶å®æ˜¯ä¸€ä¸ªæ ‡è¯†å­—ç¬¦ä¸²ï¼Œvscode é»˜è®¤æä¾›çš„ type æ˜¯ cppgdbï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹æˆç›¸åŒçš„å­—æ®µã€‚</p><p>æƒ³è¦åœ¨çº¿æŸ¥çœ‹æœ€ç»ˆæ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥çœ‹ä¸‹é¢å‡ ä¸ªé“¾æ¥ï¼š</p><p><a href="https://github.com/justforlxz/config.nvim/blob/master/lua/config/dap/rust.lua">cpp.lua </a><br><a href="https://github.com/justforlxz/config.nvim/blob/master/lua/config/dap/init.lua">init.lua</a><br><a href="https://github.com/justforlxz/config.nvim/blob/master/lua/config/dap/keymaps.lua">keymaps.lua</a><br><a href="https://github.com/justforlxz/config.nvim/blob/master/lua/plugins/_dap.lua">_dap.lua</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨ä¹‹å‰æˆ‘å·²ç»åˆ†äº«è¿‡äº†ä¸€ä»½ç®€å•çš„ nvim é…ç½®ï¼Œå®ƒå·²ç»å®ç°äº†ç¼–ç¨‹æ‰€éœ€çš„æ™ºèƒ½æç¤ºï¼Œè¯­æ³•é«˜äº®ï¼Œä»£ç è·³è½¬ç­‰åŠŸèƒ½ï¼Œä»Šå¤©æˆ‘æ‰“ç®—æ•´ä¸€ä¸‹ nvim çš„è°ƒè¯•æ¡†æ¶ dapã€‚&lt;/p&gt;
&lt;p&gt;dap æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®¢æˆ·ç«¯è´Ÿè´£åœ¨ nvim ä¸Šæ˜¾ç¤ºå„ç§è°ƒè¯•ä¿¡æ¯ï¼Œæ¯”å¦‚æ˜¾ç¤ºæ–­ç‚¹ã€è°ƒç”¨æ ˆã€å¯¹è±¡å†…å­˜ä¿¡æ¯ç­‰ï¼Œæœ</summary>
      
    
    
    
    <category term="neovim" scheme="https://blog.justforlxz.com/categories/neovim/"/>
    
    
    <category term="neovim" scheme="https://blog.justforlxz.com/tags/neovim/"/>
    
    <category term="dap" scheme="https://blog.justforlxz.com/tags/dap/"/>
    
  </entry>
  
  <entry>
    <title>1. init project</title>
    <link href="https://blog.justforlxz.com/2022/11/07/photo-1-init-project/"/>
    <id>https://blog.justforlxz.com/2022/11/07/photo-1-init-project/</id>
    <published>2022-11-07T08:38:31.000Z</published>
    <updated>2024-04-15T05:09:55.027Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä¸ªç³»åˆ—çš„æ–‡ç« ï¼Œç”¨æ¥è®°å½•æˆ‘çš„ç›¸å†Œåº”ç”¨çš„å¼€å‘è¿‡ç¨‹ï¼Œå†…å®¹å¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ï¼Œè¿˜è¯·è¯»è€…è§è°…ã€‚</p><p>æˆ‘ä½¿ç”¨  NextCloud ä½œä¸ºæˆ‘çš„å­˜å‚¨ä¸­å¿ƒï¼Œä½†æ˜¯å½“æˆ‘å¤‡ä»½ç›¸å†Œçš„æ—¶å€™ï¼Œæˆ‘æ„Ÿåˆ°äº†è«åçš„è›‹ç–¼ï¼Œå®åœ¨æ˜¯å¤ªéš¾ç”¨äº†ï¼Œä¸æ”¯æŒç›¸å†Œï¼Œä¸æ”¯æŒæ ‡è®°ï¼Œä¸æ”¯æŒå„ç§è§†å›¾ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±å†™ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯ï¼Œåªæä¾›ç›¸å†ŒåŠŸèƒ½ã€‚</p><h2 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h2><p>æˆ‘ç”¨çš„æ˜¯ iPhone 12ï¼Œç†æ‰€å½“ç„¶æˆ‘ä¼šé€‰æ‹© iOS å®¢æˆ·ç«¯å¼€å‘ï¼Œåœ¨æˆ‘é¢å‰æœ‰è¿™ä¹ˆå‡ ç§æ–¹æ¡ˆå¯ä»¥é€‰æ‹©ï¼š</p><ol><li>object-c</li><li>swift</li><li>swiftui</li><li>flutter</li><li>qml</li><li>react-native</li></ol><blockquote><p>æœ¬ç€ä¸‰çŸ­ä¸€é•¿é€‰æœ€é•¿çš„åŸåˆ™ï¼Œæˆ‘è®¡åˆ’ä½¿ç”¨ react-native ä½œä¸ºé¡¹ç›®çš„æŠ€æœ¯æ–¹æ¡ˆã€‚</p></blockquote><p>object-c å·²ç»å¾ˆè€æ—§äº†ï¼Œæˆ‘åªæ˜¯æƒ³ä¸šä½™æ—¶é—´åšä¸€ä¸ªåº”ç”¨æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ï¼Œæ’é™¤ã€‚</p><p>swfit å’Œ swiftui æ˜¯è‹¹æœç›®å‰ä¸»æ¨çš„ï¼Œç‰¹åˆ«æ˜¯ swfituiï¼Œç”¨æ¥å†™ç•Œé¢çœŸçš„å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯æˆ‘ä¸æƒ³å­¦æ–°çš„ï¼Œæ’é™¤ã€‚</p><p>flutter æ˜¯è°·æ­Œåœ¨æ¨çš„ä¸€ä¸ªæ¡†æ¶ï¼Œä»æˆ‘çš„ç ”å‘è§’åº¦æ¥çœ‹ï¼Œflutter å’Œ qml æ²¡æœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«ï¼Œéƒ½æ˜¯è‡ªå·±å®ç°äº†ç»˜åˆ¶ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå®Œå–„æ§ä»¶ç­‰é«˜çº§åŠŸèƒ½ï¼Œæ—¢ç„¶æˆ‘æ˜¯ä¸€ä¸ª Qt å¼€å‘è€…ï¼Œæˆ‘è‚¯å®šä¸ä¼šé€‰æ‹©å†å»å­¦ä¸€å¥—ç±»ä¼¼çš„æŠ€æœ¯äº†ï¼Œæ’é™¤ã€‚</p><p>qmlï¼ŒQt ç›®å‰ä¸»æ¨çš„ç•Œé¢å¼€å‘æ¡†æ¶ï¼Œé‡‡ç”¨ JSON like çš„æ–¹å¼æè¿°ç•Œé¢ï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œä¸€éƒ¨åˆ†çš„æ ‡å‡† js è¯­æ³•ï¼Œé…åˆ C++ åœ¨ native ç«¯æä¾›æœ¬åœ°åŠŸèƒ½ï¼ŒQt è‡ªå·±æ˜¯ä¸€å¥—å¹³å°ä¸€æ ·çš„æ¡†æ¶ï¼Œç”¨èµ·æ¥å¾ˆçˆ½ï¼Œä½†æ˜¯æˆ‘ä¸æƒ³å†™ qmlï¼Œæ’é™¤ã€‚</p><p>æœ€ç»ˆå°±åªèƒ½ç”¨ react native äº†ï¼Œæˆ‘ä¸ªäººæƒ³å­¦ä¸€ä¸‹å‰ç«¯å¼€å‘ï¼Œä½¿ç”¨ç›¸å…³çš„æŠ€æœ¯æ ˆå¯¹æˆ‘æ¥è¯´æ€§ä»·æ¯”æœ€é«˜ï¼Œé€‰æ‹©ã€‚</p><blockquote><p><del>ä¸ºäº†å†™ js è€Œæ‰¾äº†è¿™ä¹ˆå¤šå€Ÿå£ï¼ˆ</del></p></blockquote><h2 id="åŠŸèƒ½è®¾è®¡"><a href="#åŠŸèƒ½è®¾è®¡" class="headerlink" title="åŠŸèƒ½è®¾è®¡"></a>åŠŸèƒ½è®¾è®¡</h2><p>ç¡®å®šäº†æŠ€æœ¯æ–¹æ¡ˆï¼Œå°±éœ€è¦è€ƒè™‘å®ç°å“ªäº›åŠŸèƒ½äº†ï¼Œä½œä¸ºä¸€ä¸ªç›¸å†Œ Appï¼Œå®ƒæœ€åŸºæœ¬çš„åŠŸèƒ½è‚¯å®šæ˜¯ <del>èƒ½å¯åŠ¨</del>,å—¯ï¼Œçœ‹å›¾ã€‚</p><ul><li>æµè§ˆæœåŠ¡å™¨å’Œæœ¬åœ°çš„å›¾ç‰‡</li><li>ä¸Šä¼ å’Œä¸‹è½½å›¾ç‰‡</li><li>ç›¸å†Œåˆ†ç±»</li><li>æ ‡è®°ä¿¡æ¯</li><li>æŸ¥çœ‹æ–‡ä»¶è¯¦æƒ…</li></ul><p>ä¸€å¼€å§‹å…ˆä¸è€ƒè™‘é‚£ä¹ˆå¤šï¼Œåšä¸€ä¸ªåŸºæœ¬çš„ TimeLine æ ·å¼å°±å¯ä»¥äº†ã€‚</p><h2 id="ç•Œé¢è®¾è®¡"><a href="#ç•Œé¢è®¾è®¡" class="headerlink" title="ç•Œé¢è®¾è®¡"></a>ç•Œé¢è®¾è®¡</h2><p>åŠŸèƒ½ä¹Ÿå·²ç»ç¡®å®šäº†ï¼Œå…ˆå®ç°ä¸€ä¸ª TimeLine çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆå°±è¦ç¡®å®šç•Œé¢çš„æ ·å¼äº†ï¼Œæˆ‘ä¸ªäººæ¯”è¾ƒæ¬£èµ Google Photo çš„è®¾è®¡ï¼Œæ‰“ç®—å°±æŒ‰åƒç´ å¤åˆ¶äº†ã€‚</p><h2 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h2><p>ç°åœ¨å¯ä»¥è€ƒè™‘æ€ä¹ˆå†™ä»£ç äº†ï¼Œé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸‹é¡¹ç›®ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npx react-native init photos --template react-native-template-typescript</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–ä¸€ä¸ªå¸¦æœ‰ typescript çš„ react native é¡¹ç›®ï¼Œç„¶ååœ¨ vscode é‡Œå®‰è£…ä¸€äº› react å’Œ react native ç›¸å…³çš„æ’ä»¶å°±å¯ä»¥äº†ã€‚</p><p>åˆ æ‰åˆå§‹åŒ–é¡¹ç›®çš„ App.tsx å’Œç›¸å…³çš„æ–‡ä»¶ï¼Œæ–°å»º src ç›®å½•å’Œ App.tsx æ–‡ä»¶ï¼Œå¼€å§‹å†™æ–°çš„ç•Œé¢ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç³»åˆ—çš„æ–‡ç« ï¼Œç”¨æ¥è®°å½•æˆ‘çš„ç›¸å†Œåº”ç”¨çš„å¼€å‘è¿‡ç¨‹ï¼Œå†…å®¹å¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ï¼Œè¿˜è¯·è¯»è€…è§è°…ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä½¿ç”¨  NextCloud ä½œä¸ºæˆ‘çš„å­˜å‚¨ä¸­å¿ƒï¼Œä½†æ˜¯å½“æˆ‘å¤‡ä»½ç›¸å†Œçš„æ—¶å€™ï¼Œæˆ‘æ„Ÿåˆ°äº†è«åçš„è›‹ç–¼ï¼Œå®åœ¨æ˜¯å¤ªéš¾ç”¨äº†ï¼Œä¸æ”¯æŒç›¸å†Œï¼Œä¸æ”¯æŒæ ‡è®°ï¼Œä¸æ”¯æŒå„ç§è§†å›¾ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±å†™ä¸€ä¸ªæ–°çš„</summary>
      
    
    
    
    <category term="photos å¼€å‘ç¬”è®°" scheme="https://blog.justforlxz.com/categories/photos-%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="typescript" scheme="https://blog.justforlxz.com/tags/typescript/"/>
    
    <category term="react" scheme="https://blog.justforlxz.com/tags/react/"/>
    
    <category term="react native" scheme="https://blog.justforlxz.com/tags/react-native/"/>
    
  </entry>
  
  <entry>
    <title>docker-buildx-multi-arch-images</title>
    <link href="https://blog.justforlxz.com/2022/08/25/docker-buildx-multi-arch-images/"/>
    <id>https://blog.justforlxz.com/2022/08/25/docker-buildx-multi-arch-images/</id>
    <published>2022-08-25T05:32:03.000Z</published>
    <updated>2024-04-15T05:09:54.959Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ä¸€ç›´åœ¨æ github çš„ ciï¼Œä¸ºäº†æ–¹ä¾¿å…¬å¸çš„å¼€å‘å¿«é€Ÿä¿®å¤å…¶ä»–å‘è¡Œç‰ˆä¸Šçš„æ„å»ºé—®é¢˜ï¼Œæˆ‘ç ”ç©¶äº†ä¸€ä¸‹ distrobox å¯åŠ¨å®¹å™¨æ¥ä½œä¸ºæœ¬åœ°éªŒè¯ç¯å¢ƒçš„å¯è¡Œæ€§ï¼Œç»“æœå‘ç°è¿˜ä¸é”™ï¼Œå°±é¡ºæ‰‹åšäº†å‡ ä¸ªé•œåƒã€‚</p><p>v23 çš„ä»“åº“æ˜¯æ”¯æŒå¤šä¸ªæ¶æ„çš„ï¼Œæƒ³ç€é¡ºæ‰‹åšä¸€ä»½ v23 çš„é•œåƒæäº¤åˆ° docker hub ä¸Šï¼Œç»“æœé‡åˆ°äº†ä¸€ç‚¹å¤šå¹³å°çš„å‘ã€‚</p><h2 id="docker-buildx"><a href="#docker-buildx" class="headerlink" title="docker buildx"></a>docker buildx</h2><p>Docker Buildxæ˜¯ä¸€ä¸ªCLIæ’ä»¶ï¼Œå®ƒæ‰©å±•äº†Dockerå‘½ä»¤ï¼Œå®Œå…¨æ”¯æŒ Moby BuildKit æ„å»ºå·¥å…·åŒ…æä¾›çš„ç‰¹æ€§ã€‚å®ƒæä¾›äº†ä¸docker æ„å»ºç›¸åŒçš„ç”¨æˆ·ä½“éªŒï¼Œæä¾›äº†è®¸å¤šæ–°ç‰¹æ€§ï¼Œæ¯”å¦‚åˆ›å»ºä½œç”¨åŸŸçš„æ„å»ºå™¨å®ä¾‹å’ŒåŒæ—¶é’ˆå¯¹å¤šä¸ªèŠ‚ç‚¹æ„å»ºã€‚</p><p>Moby BuildKit æ„å»ºå·¥å…·æä¾›äº†ä¸€äº›è¯¸å¦‚è·¨å¹³å°å¯åŠ¨çš„åŠŸèƒ½ã€‚</p><h2 id="é¦–æ¬¡å°è¯•"><a href="#é¦–æ¬¡å°è¯•" class="headerlink" title="é¦–æ¬¡å°è¯•"></a>é¦–æ¬¡å°è¯•</h2><p>æœ€å¼€å§‹æˆ‘æ˜¯æ‰“ç®—ä½¿ç”¨ docker import ç›´æ¥æŠŠ base.tgz å¯¼å…¥è¿›å»çš„ï¼Œdocker import æ”¯æŒ â€“platform å‚æ•°æŒ‡å®šæ¶æ„ï¼Œæˆ‘å°±è·‘äº†ä¸¤éï¼Œç”Ÿæˆäº† linux&#x2F;arm64 å’Œ linux&#x2F;amd64 ä¸¤ä¸ªæ¶æ„çš„ã€‚</p><p>ç»“æœæˆ‘çœ‹åˆ° docker images é‡Œåªæœ‰ä¸€ä»½ï¼Œè€Œä¸”ç”¨ docker image inspect beige:base æŸ¥çœ‹å‘ç°é‡Œé¢çš„ Architecuture åªæœ‰ amd64ï¼Œæ¨é€åˆ° docker hub åä¹Ÿåªæœ‰ä¸€ä»½ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸æ­£ç¡®çš„ã€‚</p><h2 id="ä½¿ç”¨-dockerfile"><a href="#ä½¿ç”¨-dockerfile" class="headerlink" title="ä½¿ç”¨ dockerfile"></a>ä½¿ç”¨ dockerfile</h2><p>ç»è¿‡æˆ‘ä¸€ç•ªçš„æœç´¢ï¼Œæˆ‘çœ‹åˆ°äº†ä¸€ç§ä½¿ç”¨ docker buildx é…åˆ dockerfile çš„å¤šæ¶æ„æ„å»ºæ–¹å¼ï¼Œç„¶åæˆ‘å°±å¿«é€Ÿçš„å†™äº†ä¸€ä»½ dockerfileã€‚</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> --platform=$TARGETPLATFORM scratch</span><br><span class="line"></span><br><span class="line"><span class="keyword">ARG</span> TARGETARCH</span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> beige-<span class="variable">$&#123;TARGETARCH&#125;</span>.tgz /</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;sh&quot;</span> ]</span></span><br></pre></td></tr></table></figure><p>dockerfile éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå˜é‡éœ€è¦å…ˆä½¿ç”¨ ARG å£°æ˜ï¼Œåœ¨ build é˜¶æ®µï¼Œé‡åˆ°å˜é‡ä¼šäº§ç”Ÿä¸€æ¬¡åˆ†å‰ï¼Œè¿™æ ·å°±ä¼šåœ¨ä¸åŒçš„æ¶æ„é‡Œç»§ç»­è¿è¡Œäº†ï¼ˆè¿™ä¹Ÿæ˜¯å‘æˆ‘å¾ˆé•¿çš„æ—¶é—´ï¼Œæœ€ç»ˆæˆ‘å°†æ–‡ä»¶åä¿®æ”¹ä¸ºæ–¹ä¾¿è·å–çš„æ–¹å¼â€¦â€¦ï¼‰ã€‚</p><p>æ¥ä¸‹æ¥éœ€è¦åˆ›å»ºä¸€ä»½æ„å»ºç¯å¢ƒã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker buildx create --use</span><br></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤å¯ä»¥åˆ›å»ºä¸€ä¸ªåŸºæœ¬ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ <code>docker buildx ls</code> æŸ¥çœ‹å½“å‰çš„ç¯å¢ƒï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤å°±æ”¯æŒçš„æœ‰å¾ˆå¤šç§æ¶æ„ã€‚</p><p>ç„¶åä½¿ç”¨ build å‘½ä»¤å¼€å§‹æ„å»ºï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker buildx build --platform=linux/amd64,linux/arm64 -t linuxdeepin/beige:base --push .</span><br></pre></td></tr></table></figure><p>ç®€å•è¯´ä¸€ä¸‹å‚æ•°ï¼Œplatform å‚æ•°è´Ÿè´£æ§åˆ¶æœ¬æ¬¡ build ä¼ å…¥æ¶æ„ï¼Œt å‚æ•°è®¾ç½® tag åç§°ï¼Œè¿™é‡Œæˆ‘ç”¨äº† â€“push ç›´æ¥æ¨é€ä¸Šå»äº†ï¼Œå®ƒé»˜è®¤ç”¨çš„ docker-compose å¤„ç†ï¼Œæ„å»ºäº§ç‰©ä¸ä¼šå‡ºç°åœ¨ docker images é‡Œï¼Œæ‰€ä»¥å°±ç›´æ¥æ¨é€äº†ã€‚</p><p>ç°åœ¨æˆ‘å°±æœ‰ä¸€ä»½ v23 çš„ docker base å¯ç”¨äº†ï¼Œå¾ˆå¼€å¿ƒã€‚</p><p>ç‚¹å‡»å‰å¾€ï¼š<br><a href="https://hub.docker.com/repository/docker/linuxdeepin/beige">https://hub.docker.com/repository/docker/linuxdeepin/beige</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘ä¸€ç›´åœ¨æ github çš„ ciï¼Œä¸ºäº†æ–¹ä¾¿å…¬å¸çš„å¼€å‘å¿«é€Ÿä¿®å¤å…¶ä»–å‘è¡Œç‰ˆä¸Šçš„æ„å»ºé—®é¢˜ï¼Œæˆ‘ç ”ç©¶äº†ä¸€ä¸‹ distrobox å¯åŠ¨å®¹å™¨æ¥ä½œä¸ºæœ¬åœ°éªŒè¯ç¯å¢ƒçš„å¯è¡Œæ€§ï¼Œç»“æœå‘ç°è¿˜ä¸é”™ï¼Œå°±é¡ºæ‰‹åšäº†å‡ ä¸ªé•œåƒã€‚&lt;/p&gt;
&lt;p&gt;v23 çš„ä»“åº“æ˜¯æ”¯æŒå¤šä¸ªæ¶æ„çš„ï¼Œæƒ³ç€é¡ºæ‰‹åšä¸€ä»½ v23 çš„é•œåƒæ</summary>
      
    
    
    
    <category term="Linux" scheme="https://blog.justforlxz.com/categories/Linux/"/>
    
    
    <category term="docker" scheme="https://blog.justforlxz.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>meet unity shader</title>
    <link href="https://blog.justforlxz.com/2022/07/21/meet-unity-shader/"/>
    <id>https://blog.justforlxz.com/2022/07/21/meet-unity-shader/</id>
    <published>2022-07-21T13:44:25.000Z</published>
    <updated>2024-04-15T05:09:54.896Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æˆ‘è¿˜åœ¨ä¸Šé«˜ä¸­çš„æ—¶å€™ï¼Œæˆ‘å°±å¼€å§‹å­¦äº†ä¸€äº› Unityï¼Œä¹Ÿå°è¯•åˆ¶ä½œäº†ä¸€äº›ç®€å•çš„æ¸¸æˆï¼Œé‚£æ—¶å€™æ›´å¤šæ˜¯å‡ºäºå¥½ç©ï¼Œåæ¥æ²‰è¿· Linuxï¼Œå°±é€æ¸æ·¡å¿˜äº†æ¸¸æˆå¼€å‘ã€‚</p><p>æœºç¼˜å·§åˆï¼Œæˆ‘ç°åœ¨å…¥æ‰‹äº†ä¸€å° M1 mbpï¼Œæ¥è§¦åˆ°äº† Apple å®¶çš„ Metalï¼Œåˆå¿«é€Ÿè¿‡äº†ä¸€ä¸‹ Vulkanï¼Œä¹Ÿå°è¯•åšäº†ä¸€äº›å…¥é—¨çº§çš„é¡¹ç›®ï¼Œæ›´å¹»æƒ³åˆ¶ä½œä¸€ä¸ªæ¸¸æˆå¼•æ“ï¼Œæ‰€ä»¥æœ€è¿‘æœ‰æ—¶é—´æˆ‘å°±åœ¨çœ‹ Games104 çš„è¯¾ç¨‹ï¼Œè¡¥å……ä¸€ä¸‹ç›¸å…³çŸ¥è¯†ï¼Œè®¡åˆ’è·Ÿå®Œ Games104ï¼Œå°±å»çœ‹ä¸€ä¸‹é—«ä»¤çªè€å¸ˆçš„ Games101ï¼Œä¸»æ”»ä¸€ä¸‹è®¡ç®—æœºå›¾å½¢å­¦ã€‚</p><p>æœ‰å¤©ä¸­åˆæˆ‘æ— æ„é—´çœ‹åˆ°äº† onevcat å¤§ä½¬å†™çš„ä¸€ç¯‡ä»‹ç» unity shader çš„æ–‡ç« ï¼Œå¹¶ä¸”è¿˜åˆ†äº«äº†ä¸€ç¯‡ä½¿ç”¨ shader æ¨¡æ‹Ÿç‰©ä½“è¡¨é¢çš„é›ªçš„æ•ˆæœï¼Œè®©æˆ‘ä¹Ÿæƒ³è·Ÿç€åšä¸€ä¸ªã€‚</p><img src="/2022/07/21/meet-unity-shader/p1.png" class="" title="æ•ˆæœå±•ç¤º"><h2 id="Unity-shader"><a href="#Unity-shader" class="headerlink" title="Unity shader"></a>Unity shader</h2><p>Unity shader å¹¶ä¸åƒå¹³å¸¸æˆ‘ä»¬è§çš„ OpenGLã€Vulkan å’Œ Metal çš„ shader æ–‡ä»¶ä¸€æ ·ï¼ŒUnity shader æ›´åƒæ˜¯é…ç½®æ–‡ä»¶ï¼Œå®ƒä½¿ç”¨ç‰¹å®šçš„ç»“æ„è¯­æ³•ä¿å­˜å„ç§ä¿¡æ¯ï¼Œå¹¶å’Œ Unity Editor ä¸­å…¶ä»–å¯¹è±¡äº¤äº’ã€‚</p><p>ä¸€ä¸ªåŸºç¡€çš„ Unity shader çš„ç»“æ„æ˜¯è¿™æ ·çš„:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Shader &quot;Custom/myshader&quot; &#123;</span><br><span class="line">    Properties &#123;&#125;</span><br><span class="line">    SubShader &#123;&#125;</span><br><span class="line">    Fallback &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªæ ‡å‡†çš„ Unity shader æ‹¥æœ‰å››ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ª Shader çš„å‘½åï¼Œä¸€ä¸ªå±æ€§å¯¹è±¡ï¼Œä¸€ä¸ª SubShader å¯¹è±¡ï¼Œä¸€ä¸ª Fallback å­—ç¬¦ä¸²ã€‚</p><p>å±æ€§å¯¹è±¡æ˜¯ Unity Editor å’Œ shader æ²Ÿé€šçš„æ¡¥æ¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Properties ä¸­å£°æ˜è¾“å…¥ï¼Œä»å¤–éƒ¨æ¥å—å‚æ•°ã€‚</p><p>SubShader å¯¹è±¡æ˜¯å¯ä»¥å¤šä¸ªé‡å¤çš„ï¼Œå½“ç¬¬ä¸€ä¸ª SubShader å¯¹è±¡ä¸­çš„ä»£ç æ— æ³•åœ¨å½“å‰çš„ GPU ä¸­è¿è¡Œæ—¶ï¼ŒUnity ä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª SubShader å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä»½ Shader æ–‡ä»¶ä¸­å¯¹ä¸åŒçš„ GPU å®ç°ä¸åŒçš„æ”¯æŒã€‚</p><p>Fallback å­—ç¬¦ä¸²åˆ™æ˜¯å¦‚æœ SubShader éƒ½æ— æ³•è¿è¡Œæ—¶ï¼Œé‡‡ç”¨çš„æœ€ç»ˆçš„æ¸²æŸ“æ–¹æ³•ã€‚</p><p>ä¸€ä¸ªç®€å•çš„ç†è§£å°±æ˜¯ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œç”»é¢æ•ˆæœæ˜¯ä¾æ¬¡é™ä½çš„ã€‚</p><h2 id="è‡ªå®šä¹‰å±æ€§"><a href="#è‡ªå®šä¹‰å±æ€§" class="headerlink" title="è‡ªå®šä¹‰å±æ€§"></a>è‡ªå®šä¹‰å±æ€§</h2><h2 id="SubShader"><a href="#SubShader" class="headerlink" title="SubShader"></a>SubShader</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SubShader &#123;</span><br><span class="line">    Tags &#123;&#125;</span><br><span class="line">    Pass &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Pass &#123;</span><br><span class="line">    CGPROGRAM</span><br><span class="line">    ENDCG</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="CGPROGRAM"><a href="#CGPROGRAM" class="headerlink" title="CGPROGRAM"></a>CGPROGRAM</h2><p>&#x2F;&#x2F; TODOï¼šCGPROGRAM æ˜¯å‘é€åˆ° GPU è¿è¡Œçš„ç¨‹åºï¼Œä¹Ÿæ˜¯ä¸€èˆ¬æ¦‚å¿µä¸­çš„ shaderã€‚</p><h2 id="è‡ªå®šä¹‰å…‰ç…§"><a href="#è‡ªå®šä¹‰å…‰ç…§" class="headerlink" title="è‡ªå®šä¹‰å…‰ç…§"></a>è‡ªå®šä¹‰å…‰ç…§</h2><h2 id="æ³•çº¿"><a href="#æ³•çº¿" class="headerlink" title="æ³•çº¿"></a>æ³•çº¿</h2><h2 id="Shader-ä»£ç "><a href="#Shader-ä»£ç " class="headerlink" title="Shader ä»£ç "></a>Shader ä»£ç </h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;_Object2World&#x27; with &#x27;unity_ObjectToWorld&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Custom/SnowShader&quot; &#123;</span><br><span class="line">    Properties &#123;</span><br><span class="line">        _MainTex (&quot;Base (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Bump (&quot;Bump&quot;, 2D) = &quot;bump&quot; &#123;&#125;</span><br><span class="line">        _Snow (&quot;Snow Level&quot;, Range(0,1) ) = 0</span><br><span class="line">        _SnowColor (&quot;Snow Color&quot;, Color) = (1.0,1.0,1.0,1.0)</span><br><span class="line">        _SnowDirection (&quot;Snow Direction&quot;, Vector) = (0,1,0)</span><br><span class="line">        _SnowDepth (&quot;Snow Depth&quot;, Range(0,0.3)) = 0.1</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader &#123;</span><br><span class="line">        Tags &#123; &quot;RenderType&quot;=&quot;Opaque&quot; &#125;</span><br><span class="line">        LOD 200</span><br><span class="line"></span><br><span class="line">        CGPROGRAM</span><br><span class="line">        #pragma surface surf CustomDiffuse vertex:vert</span><br><span class="line"></span><br><span class="line">        sampler2D _MainTex;</span><br><span class="line">        sampler2D _Bump;</span><br><span class="line">        float _Snow;</span><br><span class="line">        float4 _SnowColor;</span><br><span class="line">        float4 _SnowDirection;</span><br><span class="line">        float _SnowDepth;</span><br><span class="line"></span><br><span class="line">        struct Input &#123;</span><br><span class="line">            float2 uv_MainTex;</span><br><span class="line">            float2 uv_Bump;</span><br><span class="line">            float3 worldNormal;</span><br><span class="line">            INTERNAL_DATA</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        inline float4 LightingCustomDiffuse (SurfaceOutput s, fixed3 lightDir, fixed atten) &#123;</span><br><span class="line">            float difLight = dot (s.Normal, lightDir);</span><br><span class="line">            float hLambert = difLight * 0.5 + 0.5;</span><br><span class="line">            float4 col;</span><br><span class="line">            col.rgb = s.Albedo * _LightColor0.rgb * (hLambert * atten * 2);</span><br><span class="line">            col.a = s.Alpha;</span><br><span class="line">            return col;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void vert (inout appdata_full v) &#123;</span><br><span class="line">            float4 sn = mul(transpose(unity_ObjectToWorld) , _SnowDirection);</span><br><span class="line">            if(dot(v.normal, sn.xyz) &gt;= lerp(1,-1, (_Snow * 2) / 3)) &#123;</span><br><span class="line">                v.vertex.xyz += (sn.xyz + v.normal) * _SnowDepth * _Snow;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void surf (Input IN, inout SurfaceOutput o) &#123;</span><br><span class="line">            half4 c = tex2D (_MainTex, IN.uv_MainTex);</span><br><span class="line"></span><br><span class="line">            o.Normal = UnpackNormal(tex2D(_Bump, IN.uv_Bump));</span><br><span class="line"></span><br><span class="line">            if (dot(WorldNormalVector(IN, o.Normal), _SnowDirection.xyz) &gt; lerp(1,-1,_Snow)) &#123;</span><br><span class="line">                o.Albedo = _SnowColor.rgb;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                o.Albedo = c.rgb;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            o.Alpha = 1;</span><br><span class="line">        &#125;</span><br><span class="line">        ENDCG</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>ç›¸å…³æ–‡ç« </strong><br><a href="https://onevcat.com/2013/07/shader-tutorial-1/">https://onevcat.com/2013/07/shader-tutorial-1/</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨æˆ‘è¿˜åœ¨ä¸Šé«˜ä¸­çš„æ—¶å€™ï¼Œæˆ‘å°±å¼€å§‹å­¦äº†ä¸€äº› Unityï¼Œä¹Ÿå°è¯•åˆ¶ä½œäº†ä¸€äº›ç®€å•çš„æ¸¸æˆï¼Œé‚£æ—¶å€™æ›´å¤šæ˜¯å‡ºäºå¥½ç©ï¼Œåæ¥æ²‰è¿· Linuxï¼Œå°±é€æ¸æ·¡å¿˜äº†æ¸¸æˆå¼€å‘ã€‚&lt;/p&gt;
&lt;p&gt;æœºç¼˜å·§åˆï¼Œæˆ‘ç°åœ¨å…¥æ‰‹äº†ä¸€å° M1 mbpï¼Œæ¥è§¦åˆ°äº† Apple å®¶çš„ Metalï¼Œåˆå¿«é€Ÿè¿‡äº†ä¸€ä¸‹ Vulkanï¼Œ</summary>
      
    
    
    
    <category term="Game" scheme="https://blog.justforlxz.com/categories/Game/"/>
    
    
    <category term="Game" scheme="https://blog.justforlxz.com/tags/Game/"/>
    
    <category term="Unity" scheme="https://blog.justforlxz.com/tags/Unity/"/>
    
    <category term="Shader" scheme="https://blog.justforlxz.com/tags/Shader/"/>
    
  </entry>
  
</feed>
